class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static getDB(){this.restaurantDBPromise=idb.open("restaurants-db",1,function(upgradeDB){switch(upgradeDB.oldVersion){case 0:upgradeDB.createObjectStore("restaurants",{keyPath:"id"})}})}static status(response){return response.status>=200&&response.status<300?Promise.resolve(response):Promise.reject(new Error(`Request failed. Returned status of ${response.statusText}`))}static json(response){return response.json()}static fetchRestaurants(callback){fetch(DBHelper.DATABASE_URL).then(DBHelper.status).then(DBHelper.json).then(function(restaurants){DBHelper.restaurantDBPromise.then(function(db){if(db){var store=db.transaction("restaurants","readwrite").objectStore("restaurants");restaurants.forEach(function(restaurant){store.put(restaurant)})}}),callback(null,restaurants)}).catch(function(error){DBHelper.restaurantDBPromise.then(function(db){if(db)return db.transaction("restaurants").objectStore("restaurants").getAll().then(function(restaurants){callback(null,restaurants)})}).catch(function(){callback(error,null)})})}static fetchRestaurantById(id,callback){DBHelper.fetchRestaurants((error,restaurants)=>{if(error)callback(error,null);else{const restaurant=restaurants.find(r=>r.id==id);restaurant?callback(null,restaurant):callback("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(cuisine,callback){DBHelper.fetchRestaurants((error,restaurants)=>{if(error)callback(error,null);else{const results=restaurants.filter(r=>r.cuisine_type==cuisine);callback(null,results)}})}static fetchRestaurantByNeighborhood(neighborhood,callback){DBHelper.fetchRestaurants((error,restaurants)=>{if(error)callback(error,null);else{const results=restaurants.filter(r=>r.neighborhood==neighborhood);callback(null,results)}})}static fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood,callback){DBHelper.fetchRestaurants((error,restaurants)=>{if(error)callback(error,null);else{let results=restaurants;"all"!=cuisine&&(results=results.filter(r=>r.cuisine_type==cuisine)),"all"!=neighborhood&&(results=results.filter(r=>r.neighborhood==neighborhood)),callback(null,results)}})}static fetchNeighborhoods(callback){DBHelper.fetchRestaurants((error,restaurants)=>{if(error)callback(error,null);else{const neighborhoods=restaurants.map((v,i)=>restaurants[i].neighborhood),uniqueNeighborhoods=neighborhoods.filter((v,i)=>neighborhoods.indexOf(v)==i);callback(null,uniqueNeighborhoods)}})}static fetchCuisines(callback){DBHelper.fetchRestaurants((error,restaurants)=>{if(error)callback(error,null);else{const cuisines=restaurants.map((v,i)=>restaurants[i].cuisine_type),uniqueCuisines=cuisines.filter((v,i)=>cuisines.indexOf(v)==i);callback(null,uniqueCuisines)}})}static urlForRestaurant(restaurant){return`./restaurant.html?id=${restaurant.id}`}static imageUrlForRestaurant(restaurant){return`/img/${restaurant.photograph?restaurant.photograph+".webp":"No_image.svg"}`}static imageSrcSetAttrForRestaurant(restaurant){const fileName=restaurant.photograph;return fileName?`/img/${fileName}.webp 1x, /img/${fileName}@2x.webp 2x`:""}static mapMarkerForRestaurant(restaurant,map){return new google.maps.Marker({position:restaurant.latlng,title:restaurant.name,url:DBHelper.urlForRestaurant(restaurant),map,animation:google.maps.Animation.DROP})}}let restaurants,neighborhoods,cuisines;var map;!function(){function promisifyRequest(request){return new Promise(function(resolve,reject){request.onsuccess=function(){resolve(request.result)},request.onerror=function(){reject(request.error)}})}function promisifyRequestCall(obj,method,args){var request,p=new Promise(function(resolve,reject){promisifyRequest(request=obj[method].apply(obj,args)).then(resolve,reject)});return p.request=request,p}function proxyProperties(ProxyClass,targetProp,properties){properties.forEach(function(prop){Object.defineProperty(ProxyClass.prototype,prop,{get:function(){return this[targetProp][prop]},set:function(val){this[targetProp][prop]=val}})})}function proxyRequestMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){prop in Constructor.prototype&&(ProxyClass.prototype[prop]=function(){return promisifyRequestCall(this[targetProp],prop,arguments)})})}function proxyMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){prop in Constructor.prototype&&(ProxyClass.prototype[prop]=function(){return this[targetProp][prop].apply(this[targetProp],arguments)})})}function proxyCursorRequestMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){prop in Constructor.prototype&&(ProxyClass.prototype[prop]=function(){return obj=this[targetProp],(p=promisifyRequestCall(obj,prop,arguments)).then(function(value){if(value)return new Cursor(value,p.request)});var obj,p})})}function Index(index){this._index=index}function Cursor(cursor,request){this._cursor=cursor,this._request=request}function ObjectStore(store){this._store=store}function Transaction(idbTransaction){this._tx=idbTransaction,this.complete=new Promise(function(resolve,reject){idbTransaction.oncomplete=function(){resolve()},idbTransaction.onerror=function(){reject(idbTransaction.error)},idbTransaction.onabort=function(){reject(idbTransaction.error)}})}function UpgradeDB(db,oldVersion,transaction){this._db=db,this.oldVersion=oldVersion,this.transaction=new Transaction(transaction)}function DB(db){this._db=db}proxyProperties(Index,"_index",["name","keyPath","multiEntry","unique"]),proxyRequestMethods(Index,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),proxyCursorRequestMethods(Index,"_index",IDBIndex,["openCursor","openKeyCursor"]),proxyProperties(Cursor,"_cursor",["direction","key","primaryKey","value"]),proxyRequestMethods(Cursor,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(methodName){methodName in IDBCursor.prototype&&(Cursor.prototype[methodName]=function(){var cursor=this,args=arguments;return Promise.resolve().then(function(){return cursor._cursor[methodName].apply(cursor._cursor,args),promisifyRequest(cursor._request).then(function(value){if(value)return new Cursor(value,cursor._request)})})})}),ObjectStore.prototype.createIndex=function(){return new Index(this._store.createIndex.apply(this._store,arguments))},ObjectStore.prototype.index=function(){return new Index(this._store.index.apply(this._store,arguments))},proxyProperties(ObjectStore,"_store",["name","keyPath","indexNames","autoIncrement"]),proxyRequestMethods(ObjectStore,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),proxyCursorRequestMethods(ObjectStore,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),proxyMethods(ObjectStore,"_store",IDBObjectStore,["deleteIndex"]),Transaction.prototype.objectStore=function(){return new ObjectStore(this._tx.objectStore.apply(this._tx,arguments))},proxyProperties(Transaction,"_tx",["objectStoreNames","mode"]),proxyMethods(Transaction,"_tx",IDBTransaction,["abort"]),UpgradeDB.prototype.createObjectStore=function(){return new ObjectStore(this._db.createObjectStore.apply(this._db,arguments))},proxyProperties(UpgradeDB,"_db",["name","version","objectStoreNames"]),proxyMethods(UpgradeDB,"_db",IDBDatabase,["deleteObjectStore","close"]),DB.prototype.transaction=function(){return new Transaction(this._db.transaction.apply(this._db,arguments))},proxyProperties(DB,"_db",["name","version","objectStoreNames"]),proxyMethods(DB,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(funcName){[ObjectStore,Index].forEach(function(Constructor){funcName in Constructor.prototype&&(Constructor.prototype[funcName.replace("open","iterate")]=function(){var arr,args=(arr=arguments,Array.prototype.slice.call(arr)),callback=args[args.length-1],nativeObject=this._store||this._index,request=nativeObject[funcName].apply(nativeObject,args.slice(0,-1));request.onsuccess=function(){callback(request.result)}})})}),[Index,ObjectStore].forEach(function(Constructor){Constructor.prototype.getAll||(Constructor.prototype.getAll=function(query,count){var instance=this,items=[];return new Promise(function(resolve){instance.iterateCursor(query,function(cursor){cursor?(items.push(cursor.value),void 0===count||items.length!=count?cursor.continue():resolve(items)):resolve(items)})})})});var exp={open:function(name,version,upgradeCallback){var p=promisifyRequestCall(indexedDB,"open",[name,version]),request=p.request;return request.onupgradeneeded=function(event){upgradeCallback&&upgradeCallback(new UpgradeDB(request.result,event.oldVersion,request.transaction))},p.then(function(db){return new DB(db)})},delete:function(name){return promisifyRequestCall(indexedDB,"deleteDatabase",[name])}};"undefined"!=typeof module?(module.exports=exp,module.exports.default=module.exports):self.idb=exp}(),function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";var n=[],r=e.document,i=Object.getPrototypeOf,o=n.slice,a=n.concat,s=n.push,u=n.indexOf,l={},c=l.toString,f=l.hasOwnProperty,p=f.toString,d=p.call(Object),h={},g=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType},y=function(t){return null!=t&&t===t.window},v={type:!0,src:!0,noModule:!0};function m(e,t,n){var i,o=(t=t||r).createElement("script");if(o.text=e,n)for(i in v)n[i]&&(o[i]=n[i]);t.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[c.call(e)]||"object":typeof e}var w=function(e,t){return new w.fn.init(e,t)},T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function C(e){var t=!!e&&"length"in e&&e.length,n=x(e);return!g(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}w.fn=w.prototype={jquery:"3.3.1",constructor:w,length:0,toArray:function(){return o.call(this)},get:function(e){return null==e?o.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:n.sort,splice:n.splice},w.extend=w.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||g(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],a!==(r=e[t])&&(l&&r&&(w.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,o=n&&Array.isArray(n)?n:[]):o=n&&w.isPlainObject(n)?n:{},a[t]=w.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},w.extend({expando:"jQuery"+("3.3.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==c.call(e)||(t=i(e))&&("function"!=typeof(n=f.call(t,"constructor")&&t.constructor)||p.call(n)!==d))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e){m(e)},each:function(e,t){var n,r=0;if(C(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(C(Object(e))?w.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:u.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var i=[],o=0,a=e.length,s=!n;o<a;o++)!t(e[o],o)!==s&&i.push(e[o]);return i},map:function(e,t,n){var r,i,o=0,s=[];if(C(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&s.push(i);return a.apply([],s)},guid:1,support:h}),"function"==typeof Symbol&&(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});var E=function(e){var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,y,v,m,x,b="sizzle"+1*new Date,w=e.document,T=0,C=0,E=ae(),k=ae(),S=ae(),D=function(e,t){return e===t&&(f=!0),0},N={}.hasOwnProperty,A=[],j=A.pop,q=A.push,L=A.push,H=A.slice,O=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},P="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",R="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",I="\\["+M+"*("+R+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+R+"))|)"+M+"*\\]",W=":("+R+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+I+")*)|.*)\\)|)",$=new RegExp(M+"+","g"),B=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),F=new RegExp("^"+M+"*,"+M+"*"),_=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),z=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),X=new RegExp(W),U=new RegExp("^"+R+"$"),V={ID:new RegExp("^#("+R+")"),CLASS:new RegExp("^\\.("+R+")"),TAG:new RegExp("^("+R+"|[*])"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+W),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+P+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},G=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,K=/[+~]/,Z=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),ee=function(e,t,n){var r="0x"+t-65536;return r!=r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},te=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ne=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},re=function(){p()},ie=me(function(e){return!0===e.disabled&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{L.apply(A=H.call(w.childNodes),w.childNodes),A[w.childNodes.length].nodeType}catch(e){L={apply:A.length?function(e,t){q.apply(e,H.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function oe(e,t,r,i){var o,s,l,c,f,h,v,m=t&&t.ownerDocument,T=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==T&&9!==T&&11!==T)return r;if(!i&&((t?t.ownerDocument||t:w)!==d&&p(t),t=t||d,g)){if(11!==T&&(f=J.exec(e)))if(o=f[1]){if(9===T){if(!(l=t.getElementById(o)))return r;if(l.id===o)return r.push(l),r}else if(m&&(l=m.getElementById(o))&&x(t,l)&&l.id===o)return r.push(l),r}else{if(f[2])return L.apply(r,t.getElementsByTagName(e)),r;if((o=f[3])&&n.getElementsByClassName&&t.getElementsByClassName)return L.apply(r,t.getElementsByClassName(o)),r}if(n.qsa&&!S[e+" "]&&(!y||!y.test(e))){if(1!==T)m=t,v=e;else if("object"!==t.nodeName.toLowerCase()){for((c=t.getAttribute("id"))?c=c.replace(te,ne):t.setAttribute("id",c=b),s=(h=a(e)).length;s--;)h[s]="#"+c+" "+ve(h[s]);v=h.join(","),m=K.test(e)&&ge(t.parentNode)||t}if(v)try{return L.apply(r,m.querySelectorAll(v)),r}catch(e){}finally{c===b&&t.removeAttribute("id")}}}return u(e.replace(B,"$1"),t,r,i)}function ae(){var e=[];return function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}}function se(e){return e[b]=!0,e}function ue(e){var t=d.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function le(e,t){for(var n=e.split("|"),i=n.length;i--;)r.attrHandle[n[i]]=t}function ce(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function fe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function pe(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function de(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ie(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function he(e){return se(function(t){return t=+t,se(function(n,r){for(var i,o=e([],n.length,t),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function ge(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=oe.support={},o=oe.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},p=oe.setDocument=function(e){var t,i,a=e?e.ownerDocument||e:w;return a!==d&&9===a.nodeType&&a.documentElement?(h=(d=a).documentElement,g=!o(d),w!==d&&(i=d.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",re,!1):i.attachEvent&&i.attachEvent("onunload",re)),n.attributes=ue(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ue(function(e){return e.appendChild(d.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Q.test(d.getElementsByClassName),n.getById=ue(function(e){return h.appendChild(e).id=b,!d.getElementsByName||!d.getElementsByName(b).length}),n.getById?(r.filter.ID=function(e){var t=e.replace(Z,ee);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(Z,ee);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(i=t.getElementsByName(e),r=0;o=i[r++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},v=[],y=[],(n.qsa=Q.test(d.querySelectorAll))&&(ue(function(e){h.appendChild(e).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&y.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||y.push("\\["+M+"*(?:value|"+P+")"),e.querySelectorAll("[id~="+b+"-]").length||y.push("~="),e.querySelectorAll(":checked").length||y.push(":checked"),e.querySelectorAll("a#"+b+"+*").length||y.push(".#.+[+~]")}),ue(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=d.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&y.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&y.push(":enabled",":disabled"),h.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&y.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),y.push(",.*:")})),(n.matchesSelector=Q.test(m=h.matches||h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ue(function(e){n.disconnectedMatch=m.call(e,"*"),m.call(e,"[s!='']:x"),v.push("!=",W)}),y=y.length&&new RegExp(y.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(h.compareDocumentPosition),x=t||Q.test(h.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},D=t?function(e,t){if(e===t)return f=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===d||e.ownerDocument===w&&x(w,e)?-1:t===d||t.ownerDocument===w&&x(w,t)?1:c?O(c,e)-O(c,t):0:4&r?-1:1)}:function(e,t){if(e===t)return f=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e===d?-1:t===d?1:i?-1:o?1:c?O(c,e)-O(c,t):0;if(i===o)return ce(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;a[r]===s[r];)r++;return r?ce(a[r],s[r]):a[r]===w?-1:s[r]===w?1:0},d):d},oe.matches=function(e,t){return oe(e,null,null,t)},oe.matchesSelector=function(e,t){if((e.ownerDocument||e)!==d&&p(e),t=t.replace(z,"='$1']"),n.matchesSelector&&g&&!S[t+" "]&&(!v||!v.test(t))&&(!y||!y.test(t)))try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return oe(t,d,null,[e]).length>0},oe.contains=function(e,t){return(e.ownerDocument||e)!==d&&p(e),x(e,t)},oe.attr=function(e,t){(e.ownerDocument||e)!==d&&p(e);var i=r.attrHandle[t.toLowerCase()],o=i&&N.call(r.attrHandle,t.toLowerCase())?i(e,t,!g):void 0;return void 0!==o?o:n.attributes||!g?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},oe.escape=function(e){return(e+"").replace(te,ne)},oe.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},oe.uniqueSort=function(e){var t,r=[],i=0,o=0;if(f=!n.detectDuplicates,c=!n.sortStable&&e.slice(0),e.sort(D),f){for(;t=e[o++];)t===e[o]&&(i=r.push(o));for(;i--;)e.splice(r[i],1)}return c=null,e},i=oe.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)n+=i(t);return n},(r=oe.selectors={cacheLength:50,createPseudo:se,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Z,ee),e[3]=(e[3]||e[4]||e[5]||"").replace(Z,ee),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||oe.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&oe.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return V.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=a(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Z,ee).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&E(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=oe.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace($," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,f,p,d,h,g=o!==a?"nextSibling":"previousSibling",y=t.parentNode,v=s&&t.nodeName.toLowerCase(),m=!u&&!s,x=!1;if(y){if(o){for(;g;){for(p=t;p=p[g];)if(s?p.nodeName.toLowerCase()===v:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?y.firstChild:y.lastChild],a&&m){for(x=(d=(l=(c=(f=(p=y)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1])&&l[2],p=d&&y.childNodes[d];p=++d&&p&&p[g]||(x=d=0)||h.pop();)if(1===p.nodeType&&++x&&p===t){c[e]=[T,d,x];break}}else if(m&&(x=d=(l=(c=(f=(p=t)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1]),!1===x)for(;(p=++d&&p&&p[g]||(x=d=0)||h.pop())&&((s?p.nodeName.toLowerCase()!==v:1!==p.nodeType)||!++x||(m&&((c=(f=p[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]=[T,x]),p!==t)););return(x-=i)===r||x%r==0&&x/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||oe.error("unsupported pseudo: "+e);return i[b]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?se(function(e,n){for(var r,o=i(e,t),a=o.length;a--;)e[r=O(e,o[a])]=!(n[r]=o[a])}):function(e){return i(e,0,n)}):i}},pseudos:{not:se(function(e){var t=[],n=[],r=s(e.replace(B,"$1"));return r[b]?se(function(e,t,n,i){for(var o,a=r(e,null,i,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}}),has:se(function(e){return function(t){return oe(e,t).length>0}}),contains:se(function(e){return e=e.replace(Z,ee),function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:se(function(e){return U.test(e||"")||oe.error("unsupported lang: "+e),e=e.replace(Z,ee).toLowerCase(),function(t){var n;do{if(n=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:de(!1),disabled:de(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return Y.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:he(function(){return[0]}),last:he(function(e,t){return[t-1]}),eq:he(function(e,t,n){return[n<0?n+t:n]}),even:he(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:he(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:he(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:he(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=fe(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=pe(t);function ye(){}function ve(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function me(e,t,n){var r=t.dir,i=t.next,o=i||r,a=n&&"parentNode"===o,s=C++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||a)return e(t,n,i);return!1}:function(t,n,u){var l,c,f,p=[T,s];if(u){for(;t=t[r];)if((1===t.nodeType||a)&&e(t,n,u))return!0}else for(;t=t[r];)if(1===t.nodeType||a)if(c=(f=t[b]||(t[b]={}))[t.uniqueID]||(f[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((l=c[o])&&l[0]===T&&l[1]===s)return p[2]=l[2];if(c[o]=p,p[2]=e(t,n,u))return!0}return!1}}function xe(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function we(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Te(e,t,n,r,i,o){return r&&!r[b]&&(r=Te(r)),i&&!i[b]&&(i=Te(i,o)),se(function(o,a,s,u){var l,c,f,p=[],d=[],h=a.length,g=o||function(e,t,n){for(var r=0,i=t.length;r<i;r++)oe(e,t[r],n);return n}(t||"*",s.nodeType?[s]:s,[]),y=!e||!o&&t?g:we(g,p,e,s,u),v=n?i||(o?e:h||r)?[]:a:y;if(n&&n(y,v,s,u),r)for(l=we(v,d),r(l,[],s,u),c=l.length;c--;)(f=l[c])&&(v[d[c]]=!(y[d[c]]=f));if(o){if(i||e){if(i){for(l=[],c=v.length;c--;)(f=v[c])&&l.push(y[c]=f);i(null,v=[],l,u)}for(c=v.length;c--;)(f=v[c])&&(l=i?O(o,f):p[c])>-1&&(o[l]=!(a[l]=f))}}else v=we(v===a?v.splice(h,v.length):v),i?i(null,a,v,u):L.apply(a,v)})}function Ce(e){for(var t,n,i,o=e.length,a=r.relative[e[0].type],s=a||r.relative[" "],u=a?1:0,c=me(function(e){return e===t},s,!0),f=me(function(e){return O(t,e)>-1},s,!0),p=[function(e,n,r){var i=!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):f(e,n,r));return t=null,i}];u<o;u++)if(n=r.relative[e[u].type])p=[me(xe(p),n)];else{if((n=r.filter[e[u].type].apply(null,e[u].matches))[b]){for(i=++u;i<o&&!r.relative[e[i].type];i++);return Te(u>1&&xe(p),u>1&&ve(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(B,"$1"),n,u<i&&Ce(e.slice(u,i)),i<o&&Ce(e=e.slice(i)),i<o&&ve(e))}p.push(n)}return xe(p)}function Ee(e,t){var n=t.length>0,i=e.length>0,o=function(o,a,s,u,c){var f,h,y,v=0,m="0",x=o&&[],b=[],w=l,C=o||i&&r.find.TAG("*",c),E=T+=null==w?1:Math.random()||.1,k=C.length;for(c&&(l=a===d||a||c);m!==k&&null!=(f=C[m]);m++){if(i&&f){for(h=0,a||f.ownerDocument===d||(p(f),s=!g);y=e[h++];)if(y(f,a||d,s)){u.push(f);break}c&&(T=E)}n&&((f=!y&&f)&&v--,o&&x.push(f))}if(v+=m,n&&m!==v){for(h=0;y=t[h++];)y(x,b,a,s);if(o){if(v>0)for(;m--;)x[m]||b[m]||(b[m]=j.call(u));b=we(b)}L.apply(u,b),c&&!o&&b.length>0&&v+t.length>1&&oe.uniqueSort(u)}return c&&(T=E,l=w),x};return n?se(o):o}return ye.prototype=r.filters=r.pseudos,r.setFilters=new ye,a=oe.tokenize=function(e,t){var n,i,o,a,s,u,l,c=k[e+" "];if(c)return t?0:c.slice(0);for(s=e,u=[],l=r.preFilter;s;){for(a in n&&!(i=F.exec(s))||(i&&(s=s.slice(i[0].length)||s),u.push(o=[])),n=!1,(i=_.exec(s))&&(n=i.shift(),o.push({value:n,type:i[0].replace(B," ")}),s=s.slice(n.length)),r.filter)!(i=V[a].exec(s))||l[a]&&!(i=l[a](i))||(n=i.shift(),o.push({value:n,type:a,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?oe.error(e):k(e,u).slice(0)},s=oe.compile=function(e,t){var n,r=[],i=[],o=S[e+" "];if(!o){for(t||(t=a(e)),n=t.length;n--;)(o=Ce(t[n]))[b]?r.push(o):i.push(o);(o=S(e,Ee(i,r))).selector=e}return o},u=oe.select=function(e,t,n,i){var o,u,l,c,f,p="function"==typeof e&&e,d=!i&&a(e=p.selector||e);if(n=n||[],1===d.length){if((u=d[0]=d[0].slice(0)).length>2&&"ID"===(l=u[0]).type&&9===t.nodeType&&g&&r.relative[u[1].type]){if(!(t=(r.find.ID(l.matches[0].replace(Z,ee),t)||[])[0]))return n;p&&(t=t.parentNode),e=e.slice(u.shift().value.length)}for(o=V.needsContext.test(e)?0:u.length;o--&&(l=u[o],!r.relative[c=l.type]);)if((f=r.find[c])&&(i=f(l.matches[0].replace(Z,ee),K.test(u[0].type)&&ge(t.parentNode)||t))){if(u.splice(o,1),!(e=i.length&&ve(u)))return L.apply(n,i),n;break}}return(p||s(e,d))(i,t,!g,n,!t||K.test(e)&&ge(t.parentNode)||t),n},n.sortStable=b.split("").sort(D).join("")===b,n.detectDuplicates=!!f,p(),n.sortDetached=ue(function(e){return 1&e.compareDocumentPosition(d.createElement("fieldset"))}),ue(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||le("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ue(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||le("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ue(function(e){return null==e.getAttribute("disabled")})||le(P,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),oe}(e);w.find=E,w.expr=E.selectors,w.expr[":"]=w.expr.pseudos,w.uniqueSort=w.unique=E.uniqueSort,w.text=E.getText,w.isXMLDoc=E.isXML,w.contains=E.contains,w.escapeSelector=E.escape;var k=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&w(e).is(n))break;r.push(e)}return r},S=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},D=w.expr.match.needsContext;function N(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var A=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,t,n){return g(t)?w.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?w.grep(e,function(e){return e===t!==n}):"string"!=typeof t?w.grep(e,function(e){return u.call(t,e)>-1!==n}):w.filter(t,e,n)}w.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?w.find.matchesSelector(r,e)?[r]:[]:w.find.matches(e,w.grep(t,function(e){return 1===e.nodeType}))},w.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(w(e).filter(function(){for(t=0;t<r;t++)if(w.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)w.find(e,i[t],n);return r>1?w.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&D.test(e)?w(e):e||[],!1).length}});var q,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(w.fn.init=function(e,t,n){var i,o;if(!e)return this;if(n=n||q,"string"==typeof e){if(!(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:L.exec(e))||!i[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof w?t[0]:t,w.merge(this,w.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:r,!0)),A.test(i[1])&&w.isPlainObject(t))for(i in t)g(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return(o=r.getElementById(i[2]))&&(this[0]=o,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):g(e)?void 0!==n.ready?n.ready(e):e(w):w.makeArray(e,this)}).prototype=w.fn,q=w(r);var H=/^(?:parents|prev(?:Until|All))/,O={children:!0,contents:!0,next:!0,prev:!0};function P(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}w.fn.extend({has:function(e){var t=w(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(w.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&w(e);if(!D.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&w.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?w.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?u.call(w(e),this[0]):u.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(w.uniqueSort(w.merge(this.get(),w(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),w.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return k(e,"parentNode")},parentsUntil:function(e,t,n){return k(e,"parentNode",n)},next:function(e){return P(e,"nextSibling")},prev:function(e){return P(e,"previousSibling")},nextAll:function(e){return k(e,"nextSibling")},prevAll:function(e){return k(e,"previousSibling")},nextUntil:function(e,t,n){return k(e,"nextSibling",n)},prevUntil:function(e,t,n){return k(e,"previousSibling",n)},siblings:function(e){return S((e.parentNode||{}).firstChild,e)},children:function(e){return S(e.firstChild)},contents:function(e){return N(e,"iframe")?e.contentDocument:(N(e,"template")&&(e=e.content||e),w.merge([],e.childNodes))}},function(e,t){w.fn[e]=function(n,r){var i=w.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=w.filter(r,i)),this.length>1&&(O[e]||w.uniqueSort(i),H.test(e)&&i.reverse()),this.pushStack(i)}});var M=/[^\x20\t\r\n\f]+/g;function I(e){return e}function W(e){throw e}function $(e,t,n,r){var i;try{e&&g(i=e.promise)?i.call(e).done(t).fail(n):e&&g(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}w.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return w.each(e.match(M)||[],function(e,n){t[n]=!0}),t}(e):w.extend({},e);var t,n,r,i,o=[],a=[],s=-1,u=function(){for(i=i||e.once,r=t=!0;a.length;s=-1)for(n=a.shift();++s<o.length;)!1===o[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=o.length,n=!1);e.memory||(n=!1),t=!1,i&&(o=n?[]:"")},l={add:function(){return o&&(n&&!t&&(s=o.length-1,a.push(n)),function t(n){w.each(n,function(n,r){g(r)?e.unique&&l.has(r)||o.push(r):r&&r.length&&"string"!==x(r)&&t(r)})}(arguments),n&&!t&&u()),this},remove:function(){return w.each(arguments,function(e,t){for(var n;(n=w.inArray(t,o,n))>-1;)o.splice(n,1),n<=s&&s--}),this},has:function(e){return e?w.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return i=a=[],o=n="",this},disabled:function(){return!o},lock:function(){return i=a=[],n||t||(o=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],a.push(n),t||u()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},w.extend({Deferred:function(t){var n=[["notify","progress",w.Callbacks("memory"),w.Callbacks("memory"),2],["resolve","done",w.Callbacks("once memory"),w.Callbacks("once memory"),0,"resolved"],["reject","fail",w.Callbacks("once memory"),w.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return w.Deferred(function(t){w.each(n,function(n,r){var i=g(e[r[4]])&&e[r[4]];o[r[1]](function(){var e=i&&i.apply(this,arguments);e&&g(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(t,r,i){var o=0;function a(t,n,r,i){return function(){var s=this,u=arguments,l=function(){var e,l;if(!(t<o)){if((e=r.apply(s,u))===n.promise())throw new TypeError("Thenable self-resolution");l=e&&("object"==typeof e||"function"==typeof e)&&e.then,g(l)?i?l.call(e,a(o,n,I,i),a(o,n,W,i)):(o++,l.call(e,a(o,n,I,i),a(o,n,W,i),a(o,n,I,n.notifyWith))):(r!==I&&(s=void 0,u=[e]),(i||n.resolveWith)(s,u))}},c=i?l:function(){try{l()}catch(e){w.Deferred.exceptionHook&&w.Deferred.exceptionHook(e,c.stackTrace),t+1>=o&&(r!==W&&(s=void 0,u=[e]),n.rejectWith(s,u))}};t?c():(w.Deferred.getStackHook&&(c.stackTrace=w.Deferred.getStackHook()),e.setTimeout(c))}}return w.Deferred(function(e){n[0][3].add(a(0,e,g(i)?i:I,e.notifyWith)),n[1][3].add(a(0,e,g(t)?t:I)),n[2][3].add(a(0,e,g(r)?r:W))}).promise()},promise:function(e){return null!=e?w.extend(e,i):i}},o={};return w.each(n,function(e,t){var a=t[2],s=t[5];i[t[1]]=a.add,s&&a.add(function(){r=s},n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),a.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=a.fireWith}),i.promise(o),t&&t.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),i=o.call(arguments),a=w.Deferred(),s=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?o.call(arguments):n,--t||a.resolveWith(r,i)}};if(t<=1&&($(e,a.done(s(n)).resolve,a.reject,!t),"pending"===a.state()||g(i[n]&&i[n].then)))return a.then();for(;n--;)$(i[n],s(n),a.reject);return a.promise()}});var B=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;w.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&B.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},w.readyException=function(t){e.setTimeout(function(){throw t})};var F=w.Deferred();function _(){r.removeEventListener("DOMContentLoaded",_),e.removeEventListener("load",_),w.ready()}w.fn.ready=function(e){return F.then(e).catch(function(e){w.readyException(e)}),this},w.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--w.readyWait:w.isReady)||(w.isReady=!0,!0!==e&&--w.readyWait>0||F.resolveWith(r,[w]))}}),w.ready.then=F.then,"complete"===r.readyState||"loading"!==r.readyState&&!r.documentElement.doScroll?e.setTimeout(w.ready):(r.addEventListener("DOMContentLoaded",_),e.addEventListener("load",_));var z=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===x(n))for(s in i=!0,n)z(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,g(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(w(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},X=/^-ms-/,U=/-([a-z])/g;function V(e,t){return t.toUpperCase()}function G(e){return e.replace(X,"ms-").replace(U,V)}var Y=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function Q(){this.expando=w.expando+Q.uid++}Q.uid=1,Q.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Y(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[G(t)]=n;else for(r in t)i[G(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][G(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(G):(t=G(t))in r?[t]:t.match(M)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||w.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!w.isEmptyObject(t)}};var J=new Q,K=new Q,Z=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ee=/[A-Z]/g;function ne(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(ee,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Z.test(e)?JSON.parse(e):e)}(n)}catch(e){}K.set(e,t,n)}else n=void 0;return n}w.extend({hasData:function(e){return K.hasData(e)||J.hasData(e)},data:function(e,t,n){return K.access(e,t,n)},removeData:function(e,t){K.remove(e,t)},_data:function(e,t,n){return J.access(e,t,n)},_removeData:function(e,t){J.remove(e,t)}}),w.fn.extend({data:function(e,t){var n,r,i,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(i=K.get(o),1===o.nodeType&&!J.get(o,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&0===(r=a[n].name).indexOf("data-")&&(r=G(r.slice(5)),ne(o,r,i[r]));J.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each(function(){K.set(this,e)}):z(this,function(t){var n;if(o&&void 0===t){if(void 0!==(n=K.get(o,e)))return n;if(void 0!==(n=ne(o,e)))return n}else this.each(function(){K.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){K.remove(this,e)})}}),w.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=J.get(e,t),n&&(!r||Array.isArray(n)?r=J.access(e,t,w.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=w.queue(e,t),r=n.length,i=n.shift(),o=w._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){w.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return J.get(e,n)||J.access(e,n,{empty:w.Callbacks("once memory").add(function(){J.remove(e,[t+"queue",n])})})}}),w.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?w.queue(this[0],e):void 0===t?this:this.each(function(){var n=w.queue(this,e,t);w._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&w.dequeue(this,e)})},dequeue:function(e){return this.each(function(){w.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=w.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(n=J.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var re=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ie=new RegExp("^(?:([+-])=|)("+re+")([a-z%]*)$","i"),oe=["Top","Right","Bottom","Left"],ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&w.contains(e.ownerDocument,e)&&"none"===w.css(e,"display")},se=function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];for(o in i=n.apply(e,r||[]),t)e.style[o]=a[o];return i};function ue(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return w.css(e,t,"")},u=s(),l=n&&n[3]||(w.cssNumber[t]?"":"px"),c=(w.cssNumber[t]||"px"!==l&&+u)&&ie.exec(w.css(e,t));if(c&&c[3]!==l){for(u/=2,l=l||c[3],c=+u||1;a--;)w.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,w.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var le={};function ce(e){var t,n=e.ownerDocument,r=e.nodeName,i=le[r];return i||(t=n.body.appendChild(n.createElement(r)),i=w.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),le[r]=i,i)}function fe(e,t){for(var n,r,i=[],o=0,a=e.length;o<a;o++)(r=e[o]).style&&(n=r.style.display,t?("none"===n&&(i[o]=J.get(r,"display")||null,i[o]||(r.style.display="")),""===r.style.display&&ae(r)&&(i[o]=ce(r))):"none"!==n&&(i[o]="none",J.set(r,"display",n)));for(o=0;o<a;o++)null!=i[o]&&(e[o].style.display=i[o]);return e}w.fn.extend({show:function(){return fe(this,!0)},hide:function(){return fe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?w(this).show():w(this).hide()})}});var pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,he=/^$|^module$|\/(?:java|ecma)script/i,ge={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ye(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&N(e,t)?w.merge([e],n):n}function ve(e,t){for(var n=0,r=e.length;n<r;n++)J.set(e[n],"globalEval",!t||J.get(t[n],"globalEval"))}ge.optgroup=ge.option,ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td;var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===x(o))w.merge(p,o.nodeType?[o]:o);else if(me.test(o)){for(a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+w.htmlPrefilter(o)+u[2],c=u[0];c--;)a=a.lastChild;w.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));for(f.textContent="",d=0;o=p[d++];)if(r&&w.inArray(o,r)>-1)i&&i.push(o);else if(l=w.contains(o.ownerDocument,o),a=ye(f.appendChild(o),"script"),l&&ve(a),n)for(c=0;o=a[c++];)he.test(o.type||"")&&n.push(o);return f}!function(){var e=r.createDocumentFragment().appendChild(r.createElement("div")),t=r.createElement("input");t.setAttribute("type","radio"),t.setAttribute("checked","checked"),t.setAttribute("name","t"),e.appendChild(t),h.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",h.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var be=r.documentElement,we=/^key/,Te=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ce=/^([^.]*)(?:\.(.+)|)/;function Ee(){return!0}function ke(){return!1}function Se(){try{return r.activeElement}catch(e){}}function De(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)De(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=ke;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return w().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=w.guid++)),e.each(function(){w.event.add(this,t,i,r,n)})}w.event={global:{},add:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,y=J.get(e);if(y)for(n.handler&&(n=(o=n).handler,i=o.selector),i&&w.find.matchesSelector(be,i),n.guid||(n.guid=w.guid++),(u=y.events)||(u=y.events={}),(a=y.handle)||(a=y.handle=function(t){return void 0!==w&&w.event.triggered!==t.type?w.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(M)||[""]).length;l--;)d=g=(s=Ce.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=w.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=w.event.special[d]||{},c=w.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&w.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(e,r,h,a)||e.addEventListener&&e.addEventListener(d,a)),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),w.event.global[d]=!0)},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,y=J.hasData(e)&&J.get(e);if(y&&(u=y.events)){for(l=(t=(t||"").match(M)||[""]).length;l--;)if(d=g=(s=Ce.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){for(f=w.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;o--;)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,y.handle)||w.removeEvent(e,d,y.handle),delete u[d])}else for(d in u)w.event.remove(e,d+t[l],n,r,!0);w.isEmptyObject(u)&&J.remove(e,"handle events")}},dispatch:function(e){var n,r,i,o,a,s,t=w.event.fix(e),u=new Array(arguments.length),l=(J.get(this,"events")||{})[t.type]||[],c=w.event.special[t.type]||{};for(u[0]=t,n=1;n<arguments.length;n++)u[n]=arguments[n];if(t.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,t)){for(s=w.event.handlers.call(this,t,l),n=0;(o=s[n++])&&!t.isPropagationStopped();)for(t.currentTarget=o.elem,r=0;(a=o.handlers[r++])&&!t.isImmediatePropagationStopped();)t.rnamespace&&!t.rnamespace.test(a.namespace)||(t.handleObj=a,t.data=a.data,void 0!==(i=((w.event.special[a.origType]||{}).handle||a.handler).apply(o.elem,u))&&!1===(t.result=i)&&(t.preventDefault(),t.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,t),t.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?w(i,this).index(l)>-1:w.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(e,t){Object.defineProperty(w.Event.prototype,e,{enumerable:!0,configurable:!0,get:g(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[w.expando]?e:new w.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==Se()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===Se()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&N(this,"input"))return this.click(),!1},_default:function(e){return N(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},w.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},w.Event=function(e,t){if(!(this instanceof w.Event))return new w.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ee:ke,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&w.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[w.expando]=!0},w.Event.prototype={constructor:w.Event,isDefaultPrevented:ke,isPropagationStopped:ke,isImmediatePropagationStopped:ke,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ee,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ee,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ee,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},w.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&we.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Te.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},w.event.addProp),w.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){w.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=e.relatedTarget,o=e.handleObj;return i&&(i===this||w.contains(this,i))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),w.fn.extend({on:function(e,t,n,r){return De(this,e,t,n,r)},one:function(e,t,n,r){return De(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,w(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=ke),this.each(function(){w.event.remove(this,e,n,t)})}});var Ne=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Ae=/<script|<style|<link/i,je=/checked\s*(?:[^=]|=\s*.checked.)/i,qe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Le(e,t){return N(e,"table")&&N(11!==t.nodeType?t:t.firstChild,"tr")&&w(e).children("tbody")[0]||e}function He(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Oe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Pe(e,t){var n,r,i,o,a,s,u,l;if(1===t.nodeType){if(J.hasData(e)&&(o=J.access(e),a=J.set(t,o),l=o.events))for(i in delete a.handle,a.events={},l)for(n=0,r=l[i].length;n<r;n++)w.event.add(t,i,l[i][n]);K.hasData(e)&&(s=K.access(e),u=w.extend({},s),K.set(t,u))}}function Me(e,t){var n=t.nodeName.toLowerCase();"input"===n&&pe.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function Re(e,t,n,r){t=a.apply([],t);var i,o,s,u,l,c,f=0,p=e.length,d=p-1,y=t[0],v=g(y);if(v||p>1&&"string"==typeof y&&!h.checkClone&&je.test(y))return e.each(function(i){var o=e.eq(i);v&&(t[0]=y.call(this,i,o.html())),Re(o,t,n,r)});if(p&&(o=(i=xe(t,e[0].ownerDocument,!1,e,r)).firstChild,1===i.childNodes.length&&(i=o),o||r)){for(u=(s=w.map(ye(i,"script"),He)).length;f<p;f++)l=i,f!==d&&(l=w.clone(l,!0,!0),u&&w.merge(s,ye(l,"script"))),n.call(e[f],l,f);if(u)for(c=s[s.length-1].ownerDocument,w.map(s,Oe),f=0;f<u;f++)l=s[f],he.test(l.type||"")&&!J.access(l,"globalEval")&&w.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?w._evalUrl&&w._evalUrl(l.src):m(l.textContent.replace(qe,""),c,l))}return e}function Ie(e,t,n){for(var r,i=t?w.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||w.cleanData(ye(r)),r.parentNode&&(n&&w.contains(r.ownerDocument,r)&&ve(ye(r,"script")),r.parentNode.removeChild(r));return e}w.extend({htmlPrefilter:function(e){return e.replace(Ne,"<$1></$2>")},clone:function(e,t,n){var r,i,o,a,s=e.cloneNode(!0),u=w.contains(e.ownerDocument,e);if(!(h.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||w.isXMLDoc(e)))for(a=ye(s),r=0,i=(o=ye(e)).length;r<i;r++)Me(o[r],a[r]);if(t)if(n)for(o=o||ye(e),a=a||ye(s),r=0,i=o.length;r<i;r++)Pe(o[r],a[r]);else Pe(e,s);return(a=ye(s,"script")).length>0&&ve(a,!u&&ye(e,"script")),s},cleanData:function(e){for(var t,n,r,i=w.event.special,o=0;void 0!==(n=e[o]);o++)if(Y(n)){if(t=n[J.expando]){if(t.events)for(r in t.events)i[r]?w.event.remove(n,r):w.removeEvent(n,r,t.handle);n[J.expando]=void 0}n[K.expando]&&(n[K.expando]=void 0)}}}),w.fn.extend({detach:function(e){return Ie(this,e,!0)},remove:function(e){return Ie(this,e)},text:function(e){return z(this,function(e){return void 0===e?w.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Re(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Le(this,e).appendChild(e)})},prepend:function(){return Re(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Le(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Re(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Re(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(w.cleanData(ye(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return w.clone(this,e,t)})},html:function(e){return z(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ae.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=w.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(w.cleanData(ye(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return Re(this,arguments,function(t){var n=this.parentNode;w.inArray(this,e)<0&&(w.cleanData(ye(this)),n&&n.replaceChild(t,this))},e)}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){w.fn[e]=function(e){for(var n,r=[],i=w(e),o=i.length-1,a=0;a<=o;a++)n=a===o?this:this.clone(!0),w(i[a])[t](n),s.apply(r,n.get());return this.pushStack(r)}});var We=new RegExp("^("+re+")(?!px)[a-z%]+$","i"),$e=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Be=new RegExp(oe.join("|"),"i");function Fe(e,t,n){var r,i,o,a,s=e.style;return(n=n||$e(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||w.contains(e.ownerDocument,e)||(a=w.style(e,t)),!h.pixelBoxStyles()&&We.test(a)&&Be.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function _e(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function t(){if(c){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",be.appendChild(l).appendChild(c);var t=e.getComputedStyle(c);i="1%"!==t.top,u=12===n(t.marginLeft),c.style.right="60%",s=36===n(t.right),o=36===n(t.width),c.style.position="absolute",a=36===c.offsetWidth||"absolute",be.removeChild(l),c=null}}function n(e){return Math.round(parseFloat(e))}var i,o,a,s,u,l=r.createElement("div"),c=r.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",h.clearCloneStyle="content-box"===c.style.backgroundClip,w.extend(h,{boxSizingReliable:function(){return t(),o},pixelBoxStyles:function(){return t(),s},pixelPosition:function(){return t(),i},reliableMarginLeft:function(){return t(),u},scrollboxSize:function(){return t(),a}}))}();var ze=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ue={position:"absolute",visibility:"hidden",display:"block"},Ve={letterSpacing:"0",fontWeight:"400"},Ge=["Webkit","Moz","ms"],Ye=r.createElement("div").style;function Je(e){var t=w.cssProps[e];return t||(t=w.cssProps[e]=function(e){if(e in Ye)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=Ge.length;n--;)if((e=Ge[n]+t)in Ye)return e}(e)||e),t}function Ke(e,t,n){var r=ie.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Ze(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=w.css(e,n+oe[a],!0,i)),r?("content"===n&&(u-=w.css(e,"padding"+oe[a],!0,i)),"margin"!==n&&(u-=w.css(e,"border"+oe[a]+"Width",!0,i))):(u+=w.css(e,"padding"+oe[a],!0,i),"padding"!==n?u+=w.css(e,"border"+oe[a]+"Width",!0,i):s+=w.css(e,"border"+oe[a]+"Width",!0,i));return!r&&o>=0&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))),u}function et(e,t,n){var r=$e(e),i=Fe(e,t,r),o="border-box"===w.css(e,"boxSizing",!1,r),a=o;if(We.test(i)){if(!n)return i;i="auto"}return a=a&&(h.boxSizingReliable()||i===e.style[t]),("auto"===i||!parseFloat(i)&&"inline"===w.css(e,"display",!1,r))&&(i=e["offset"+t[0].toUpperCase()+t.slice(1)],a=!0),(i=parseFloat(i)||0)+Ze(e,t,n||(o?"border":"content"),a,r,i)+"px"}function tt(e,t,n,r,i){return new tt.prototype.init(e,t,n,r,i)}w.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Fe(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=G(t),u=Xe.test(t),l=e.style;if(u||(t=Je(s)),a=w.cssHooks[t]||w.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"==(o=typeof n)&&(i=ie.exec(n))&&i[1]&&(n=ue(e,t,i),o="number"),null!=n&&n==n&&("number"===o&&(n+=i&&i[3]||(w.cssNumber[s]?"":"px")),h.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=G(t);return Xe.test(t)||(t=Je(s)),(a=w.cssHooks[t]||w.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Fe(e,t,r)),"normal"===i&&t in Ve&&(i=Ve[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),w.each(["height","width"],function(e,t){w.cssHooks[t]={get:function(e,n,r){if(n)return!ze.test(w.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?et(e,t,r):se(e,Ue,function(){return et(e,t,r)})},set:function(e,n,r){var i,o=$e(e),a="border-box"===w.css(e,"boxSizing",!1,o),s=r&&Ze(e,t,r,a,o);return a&&h.scrollboxSize()===o.position&&(s-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-Ze(e,t,"border",!1,o)-.5)),s&&(i=ie.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=w.css(e,t)),Ke(0,n,s)}}}),w.cssHooks.marginLeft=_e(h.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Fe(e,"marginLeft"))||e.getBoundingClientRect().left-se(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),w.each({margin:"",padding:"",border:"Width"},function(e,t){w.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+oe[r]+t]=o[r]||o[r-2]||o[0];return i}},"margin"!==e&&(w.cssHooks[e+t].set=Ke)}),w.fn.extend({css:function(e,t){return z(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=$e(e),i=t.length;a<i;a++)o[t[a]]=w.css(e,t[a],!1,r);return o}return void 0!==n?w.style(e,t,n):w.css(e,t)},e,t,arguments.length>1)}}),w.Tween=tt,tt.prototype={constructor:tt,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||w.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(w.cssNumber[n]?"":"px")},cur:function(){var e=tt.propHooks[this.prop];return e&&e.get?e.get(this):tt.propHooks._default.get(this)},run:function(e){var t,n=tt.propHooks[this.prop];return this.options.duration?this.pos=t=w.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):tt.propHooks._default.set(this),this}},tt.prototype.init.prototype=tt.prototype,tt.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=w.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){w.fx.step[e.prop]?w.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[w.cssProps[e.prop]]&&!w.cssHooks[e.prop]?e.elem[e.prop]=e.now:w.style(e.elem,e.prop,e.now+e.unit)}}},tt.propHooks.scrollTop=tt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},w.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},w.fx=tt.prototype.init,w.fx.step={};var nt,rt,it=/^(?:toggle|show|hide)$/,ot=/queueHooks$/;function at(){rt&&(!1===r.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(at):e.setTimeout(at,w.fx.interval),w.fx.tick())}function st(){return e.setTimeout(function(){nt=void 0}),nt=Date.now()}function ut(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=oe[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function lt(e,t,n){for(var r,i=(pt.tweeners[t]||[]).concat(pt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function pt(e,t,n){var r,i,o=0,a=pt.prefilters.length,s=w.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=nt||st(),n=Math.max(0,l.startTime+l.duration-t),r=1-(n/l.duration||0),o=0,a=l.tweens.length;o<a;o++)l.tweens[o].run(r);return s.notifyWith(e,[l,r,n]),r<1&&a?n:(a||s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:w.extend({},t),opts:w.extend(!0,{specialEasing:{},easing:w.easing._default},n),originalProperties:t,originalOptions:n,startTime:nt||st(),duration:n.duration,tweens:[],createTween:function(t,n){var r=w.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)l.tweens[n].run(1);return t?(s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l,t])):s.rejectWith(e,[l,t]),this}}),c=l.props;for(function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=G(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=w.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);o<a;o++)if(r=pt.prefilters[o].call(l,e,c,l.opts))return g(r.stop)&&(w._queueHooks(l.elem,l.opts.queue).stop=r.stop.bind(r)),r;return w.map(c,lt,l),g(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),w.fx.timer(w.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l}w.Animation=w.extend(pt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ue(n.elem,e,ie.exec(t),n),n}]},tweener:function(e,t){g(e)?(t=e,e=["*"]):e=e.match(M);for(var n,r=0,i=e.length;r<i;r++)n=e[r],pt.tweeners[n]=pt.tweeners[n]||[],pt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),y=J.get(e,"fxshow");for(r in n.queue||(null==(a=w._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,w.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],it.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!y||void 0===y[r])continue;g=!0}d[r]=y&&y[r]||w.style(e,r)}if((u=!w.isEmptyObject(t))||!w.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=y&&y.display)&&(l=J.get(e,"display")),"none"===(c=w.css(e,"display"))&&(l?c=l:(fe([e],!0),l=e.style.display||l,c=w.css(e,"display"),fe([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===w.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(y?"hidden"in y&&(g=y.hidden):y=J.access(e,"fxshow",{display:l}),o&&(y.hidden=!g),g&&fe([e],!0),p.done(function(){for(r in g||fe([e]),J.remove(e,"fxshow"),d)w.style(e,r,d[r])})),u=lt(g?y[r]:0,r,p),r in y||(y[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?pt.prefilters.unshift(e):pt.prefilters.push(e)}}),w.speed=function(e,t,n){var r=e&&"object"==typeof e?w.extend({},e):{complete:n||!n&&t||g(e)&&e,duration:e,easing:n&&t||t&&!g(t)&&t};return w.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in w.fx.speeds?r.duration=w.fx.speeds[r.duration]:r.duration=w.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){g(r.old)&&r.old.call(this),r.queue&&w.dequeue(this,r.queue)},r},w.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=w.isEmptyObject(e),o=w.speed(t,n,r),a=function(){var t=pt(this,w.extend({},e),o);(i||J.get(this,"finish"))&&t.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=w.timers,a=J.get(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&ot.test(i)&&r(a[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||w.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=J.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=w.timers,a=r?r.length:0;for(n.finish=!0,w.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),w.each(["toggle","show","hide"],function(e,t){var n=w.fn[t];w.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ut(t,!0),e,r,i)}}),w.each({slideDown:ut("show"),slideUp:ut("hide"),slideToggle:ut("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){w.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),w.timers=[],w.fx.tick=function(){var e,t=0,n=w.timers;for(nt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||w.fx.stop(),nt=void 0},w.fx.timer=function(e){w.timers.push(e),w.fx.start()},w.fx.interval=13,w.fx.start=function(){rt||(rt=!0,at())},w.fx.stop=function(){rt=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fn.delay=function(t,n){return t=w.fx&&w.fx.speeds[t]||t,n=n||"fx",this.queue(n,function(n,r){var i=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(i)}})},function(){var e=r.createElement("input"),t=r.createElement("select").appendChild(r.createElement("option"));e.type="checkbox",h.checkOn=""!==e.value,h.optSelected=t.selected,(e=r.createElement("input")).value="t",e.type="radio",h.radioValue="t"===e.value}();var dt,ht=w.expr.attrHandle;w.fn.extend({attr:function(e,t){return z(this,w.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){w.removeAttr(this,e)})}}),w.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?w.prop(e,t,n):(1===o&&w.isXMLDoc(e)||(i=w.attrHooks[t.toLowerCase()]||(w.expr.match.bool.test(t)?dt:void 0)),void 0!==n?null===n?void w.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=w.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!h.radioValue&&"radio"===t&&N(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(M);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),dt={set:function(e,t,n){return!1===t?w.removeAttr(e,n):e.setAttribute(n,n),n}},w.each(w.expr.match.bool.source.match(/\w+/g),function(e,t){var n=ht[t]||w.find.attr;ht[t]=function(e,t,r){var i,o,a=t.toLowerCase();return r||(o=ht[a],ht[a]=i,i=null!=n(e,t,r)?a:null,ht[a]=o),i}});var gt=/^(?:input|select|textarea|button)$/i,yt=/^(?:a|area)$/i;function vt(e){return(e.match(M)||[]).join(" ")}function mt(e){return e.getAttribute&&e.getAttribute("class")||""}function xt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(M)||[]}w.fn.extend({prop:function(e,t){return z(this,w.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[w.propFix[e]||e]})}}),w.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&w.isXMLDoc(e)||(t=w.propFix[t]||t,i=w.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=w.find.attr(e,"tabindex");return t?parseInt(t,10):gt.test(e.nodeName)||yt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),h.optSelected||(w.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){w.propFix[this.toLowerCase()]=this}),w.fn.extend({addClass:function(e){var t,n,r,i,o,a,s,u=0;if(g(e))return this.each(function(t){w(this).addClass(e.call(this,t,mt(this)))});if((t=xt(e)).length)for(;n=this[u++];)if(i=mt(n),r=1===n.nodeType&&" "+vt(i)+" "){for(a=0;o=t[a++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=vt(r))&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,i,o,a,s,u=0;if(g(e))return this.each(function(t){w(this).removeClass(e.call(this,t,mt(this)))});if(!arguments.length)return this.attr("class","");if((t=xt(e)).length)for(;n=this[u++];)if(i=mt(n),r=1===n.nodeType&&" "+vt(i)+" "){for(a=0;o=t[a++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");i!==(s=vt(r))&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=typeof e,r="string"===n||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):g(e)?this.each(function(n){w(this).toggleClass(e.call(this,n,mt(this),t),t)}):this.each(function(){var t,i,o,a;if(r)for(i=0,o=w(this),a=xt(e);t=a[i++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else void 0!==e&&"boolean"!==n||((t=mt(this))&&J.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":J.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+vt(mt(n))+" ").indexOf(t)>-1)return!0;return!1}});var bt=/\r/g;w.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=g(e),this.each(function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,w(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=w.map(i,function(e){return null==e?"":e+""})),(t=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))})):i?(t=w.valHooks[i.type]||w.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:"string"==typeof(n=i.value)?n.replace(bt,""):null==n?"":n:void 0}}),w.extend({valHooks:{option:{get:function(e){var t=w.find.attr(e,"value");return null!=t?t:vt(w.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!N(n.parentNode,"optgroup"))){if(t=w(n).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,o=w.makeArray(t),a=i.length;a--;)((r=i[a]).selected=w.inArray(w.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),w.each(["radio","checkbox"],function(){w.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=w.inArray(w(e).val(),t)>-1}},h.checkOn||(w.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),h.focusin="onfocusin"in e;var wt=/^(?:focusinfocus|focusoutblur)$/,Tt=function(e){e.stopPropagation()};w.extend(w.event,{trigger:function(t,n,i,o){var a,s,u,l,c,p,d,h,v=[i||r],m=f.call(t,"type")?t.type:t,x=f.call(t,"namespace")?t.namespace.split("."):[];if(s=h=u=i=i||r,3!==i.nodeType&&8!==i.nodeType&&!wt.test(m+w.event.triggered)&&(m.indexOf(".")>-1&&(m=(x=m.split(".")).shift(),x.sort()),c=m.indexOf(":")<0&&"on"+m,(t=t[w.expando]?t:new w.Event(m,"object"==typeof t&&t)).isTrigger=o?2:3,t.namespace=x.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+x.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),n=null==n?[t]:w.makeArray(n,[t]),d=w.event.special[m]||{},o||!d.trigger||!1!==d.trigger.apply(i,n))){if(!o&&!d.noBubble&&!y(i)){for(l=d.delegateType||m,wt.test(l+m)||(s=s.parentNode);s;s=s.parentNode)v.push(s),u=s;u===(i.ownerDocument||r)&&v.push(u.defaultView||u.parentWindow||e)}for(a=0;(s=v[a++])&&!t.isPropagationStopped();)h=s,t.type=a>1?l:d.bindType||m,(p=(J.get(s,"events")||{})[t.type]&&J.get(s,"handle"))&&p.apply(s,n),(p=c&&s[c])&&p.apply&&Y(s)&&(t.result=p.apply(s,n),!1===t.result&&t.preventDefault());return t.type=m,o||t.isDefaultPrevented()||d._default&&!1!==d._default.apply(v.pop(),n)||!Y(i)||c&&g(i[m])&&!y(i)&&((u=i[c])&&(i[c]=null),w.event.triggered=m,t.isPropagationStopped()&&h.addEventListener(m,Tt),i[m](),t.isPropagationStopped()&&h.removeEventListener(m,Tt),w.event.triggered=void 0,u&&(i[c]=u)),t.result}},simulate:function(e,t,n){var r=w.extend(new w.Event,n,{type:e,isSimulated:!0});w.event.trigger(r,null,t)}}),w.fn.extend({trigger:function(e,t){return this.each(function(){w.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return w.event.trigger(e,t,n,!0)}}),h.focusin||w.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){w.event.simulate(t,e.target,w.event.fix(e))};w.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=J.access(r,t);i||r.addEventListener(e,n,!0),J.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=J.access(r,t)-1;i?J.access(r,t,i):(r.removeEventListener(e,n,!0),J.remove(r,t))}}});var Ct=e.location,Et=Date.now(),kt=/\?/;w.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||w.error("Invalid XML: "+t),n};var St=/\[\]$/,Dt=/\r?\n/g,Nt=/^(?:submit|button|image|reset|file)$/i,At=/^(?:input|select|textarea|keygen)/i;function jt(e,t,n,r){var i;if(Array.isArray(t))w.each(t,function(t,i){n||St.test(e)?r(e,i):jt(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==x(t))r(e,t);else for(i in t)jt(e+"["+i+"]",t[i],n,r)}w.param=function(e,t){var n,r=[],i=function(e,t){var n=g(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(Array.isArray(e)||e.jquery&&!w.isPlainObject(e))w.each(e,function(){i(this.name,this.value)});else for(n in e)jt(n,e[n],t,i);return r.join("&")},w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=w.prop(this,"elements");return e?w.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!w(this).is(":disabled")&&At.test(this.nodeName)&&!Nt.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=w(this).val();return null==n?null:Array.isArray(n)?w.map(n,function(e){return{name:t.name,value:e.replace(Dt,"\r\n")}}):{name:t.name,value:n.replace(Dt,"\r\n")}}).get()}});var qt=/%20/g,Lt=/#.*$/,Ht=/([?&])_=[^&]*/,Ot=/^(.*?):[ \t]*([^\r\n]*)$/gm,Mt=/^(?:GET|HEAD)$/,Rt=/^\/\//,It={},Wt={},$t="*/".concat("*"),Bt=r.createElement("a");function Ft(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(M)||[];if(g(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function _t(e,t,n,r){var i={},o=e===Wt;function a(s){var u;return i[s]=!0,w.each(e[s]||[],function(e,s){var l=s(t,n,r);return"string"!=typeof l||o||i[l]?o?!(u=l):void 0:(t.dataTypes.unshift(l),a(l),!1)}),u}return a(t.dataTypes[0])||!i["*"]&&a("*")}function zt(e,t){var n,r,i=w.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&w.extend(!0,e,r),e}Bt.href=Ct.href,w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ct.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$t,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?zt(zt(e,w.ajaxSettings),t):zt(w.ajaxSettings,e)},ajaxPrefilter:Ft(It),ajaxTransport:Ft(Wt),ajax:function(t,n){"object"==typeof t&&(n=t,t=void 0),n=n||{};var i,o,a,s,u,l,c,f,p,d,h=w.ajaxSetup({},n),g=h.context||h,y=h.context&&(g.nodeType||g.jquery)?w(g):w.event,v=w.Deferred(),m=w.Callbacks("once memory"),x=h.statusCode||{},b={},T={},C="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(c){if(!s)for(s={};t=Ot.exec(a);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return c?a:null},setRequestHeader:function(e,t){return null==c&&(e=T[e.toLowerCase()]=T[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==c&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)E.always(e[E.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||C;return i&&i.abort(t),k(0,t),this}};if(v.promise(E),h.url=((t||h.url||Ct.href)+"").replace(Rt,Ct.protocol+"//"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=(h.dataType||"*").toLowerCase().match(M)||[""],null==h.crossDomain){l=r.createElement("a");try{l.href=h.url,l.href=l.href,h.crossDomain=Bt.protocol+"//"+Bt.host!=l.protocol+"//"+l.host}catch(e){h.crossDomain=!0}}if(h.data&&h.processData&&"string"!=typeof h.data&&(h.data=w.param(h.data,h.traditional)),_t(It,h,n,E),c)return E;for(p in(f=w.event&&h.global)&&0==w.active++&&w.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Mt.test(h.type),o=h.url.replace(Lt,""),h.hasContent?h.data&&h.processData&&0===(h.contentType||"").indexOf("application/x-www-form-urlencoded")&&(h.data=h.data.replace(qt,"+")):(d=h.url.slice(o.length),h.data&&(h.processData||"string"==typeof h.data)&&(o+=(kt.test(o)?"&":"?")+h.data,delete h.data),!1===h.cache&&(o=o.replace(Ht,"$1"),d=(kt.test(o)?"&":"?")+"_="+Et+++d),h.url=o+d),h.ifModified&&(w.lastModified[o]&&E.setRequestHeader("If-Modified-Since",w.lastModified[o]),w.etag[o]&&E.setRequestHeader("If-None-Match",w.etag[o])),(h.data&&h.hasContent&&!1!==h.contentType||n.contentType)&&E.setRequestHeader("Content-Type",h.contentType),E.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+$t+"; q=0.01":""):h.accepts["*"]),h.headers)E.setRequestHeader(p,h.headers[p]);if(h.beforeSend&&(!1===h.beforeSend.call(g,E,h)||c))return E.abort();if(C="abort",m.add(h.complete),E.done(h.success),E.fail(h.error),i=_t(Wt,h,n,E)){if(E.readyState=1,f&&y.trigger("ajaxSend",[E,h]),c)return E;h.async&&h.timeout>0&&(u=e.setTimeout(function(){E.abort("timeout")},h.timeout));try{c=!1,i.send(b,k)}catch(e){if(c)throw e;k(-1,e)}}else k(-1,"No Transport");function k(t,n,r,s){var l,p,d,b,T,C=n;c||(c=!0,u&&e.clearTimeout(u),i=void 0,a=s||"",E.readyState=t>0?4:0,l=t>=200&&t<300||304===t,r&&(b=function(e,t,n){for(var r,i,o,a,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(h,E,r)),b=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(h,b,E,l),l?(h.ifModified&&((T=E.getResponseHeader("Last-Modified"))&&(w.lastModified[o]=T),(T=E.getResponseHeader("etag"))&&(w.etag[o]=T)),204===t||"HEAD"===h.type?C="nocontent":304===t?C="notmodified":(C=b.state,p=b.data,l=!(d=b.error))):(d=C,!t&&C||(C="error",t<0&&(t=0))),E.status=t,E.statusText=(n||C)+"",l?v.resolveWith(g,[p,C,E]):v.rejectWith(g,[E,C,d]),E.statusCode(x),x=void 0,f&&y.trigger(l?"ajaxSuccess":"ajaxError",[E,h,l?p:d]),m.fireWith(g,[E,C]),f&&(y.trigger("ajaxComplete",[E,h]),--w.active||w.event.trigger("ajaxStop")))}return E},getJSON:function(e,t,n){return w.get(e,t,n,"json")},getScript:function(e,t){return w.get(e,void 0,t,"script")}}),w.each(["get","post"],function(e,t){w[t]=function(e,n,r,i){return g(n)&&(i=i||r,r=n,n=void 0),w.ajax(w.extend({url:e,type:t,dataType:i,data:n,success:r},w.isPlainObject(e)&&e))}}),w._evalUrl=function(e){return w.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},w.fn.extend({wrapAll:function(e){var t;return this[0]&&(g(e)&&(e=e.call(this[0])),t=w(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return g(e)?this.each(function(t){w(this).wrapInner(e.call(this,t))}):this.each(function(){var t=w(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=g(e);return this.each(function(n){w(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){w(this).replaceWith(this.childNodes)}),this}}),w.expr.pseudos.hidden=function(e){return!w.expr.pseudos.visible(e)},w.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},w.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Vt={0:200,1223:204},Gt=w.ajaxSettings.xhr();h.cors=!!Gt&&"withCredentials"in Gt,h.ajax=Gt=!!Gt,w.ajaxTransport(function(t){var n,r;if(h.cors||Gt&&!t.crossDomain)return{send:function(i,o){var a,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)s[a]=t.xhrFields[a];for(a in t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),i)s.setRequestHeader(a,i[a]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o(Vt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=s.ontimeout=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),w.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return w.globalEval(e),e}}}),w.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),w.ajaxTransport("script",function(e){var t,n;if(e.crossDomain)return{send:function(i,o){t=w("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&o("error"===e.type?404:200,e.type)}),r.head.appendChild(t[0])},abort:function(){n&&n()}}});var Yt=[],Qt=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Yt.pop()||w.expando+"_"+Et++;return this[e]=!0,e}}),w.ajaxPrefilter("json jsonp",function(t,n,r){var i,o,a,s=!1!==t.jsonp&&(Qt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Qt.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return i=t.jsonpCallback=g(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Qt,"$1"+i):!1!==t.jsonp&&(t.url+=(kt.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return a||w.error(i+" was not called"),a[0]},t.dataTypes[0]="json",o=e[i],e[i]=function(){a=arguments},r.always(function(){void 0===o?w(e).removeProp(i):e[i]=o,t[i]&&(t.jsonpCallback=n.jsonpCallback,Yt.push(i)),a&&g(o)&&o(a[0]),a=o=void 0}),"script"}),h.createHTMLDocument=function(){var e=r.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),w.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(h.createHTMLDocument?((i=(t=r.implementation.createHTMLDocument("")).createElement("base")).href=r.location.href,t.head.appendChild(i)):t=r),o=A.exec(e),a=!n&&[],o?[t.createElement(o[1])]:(o=xe([e],t,a),a&&a.length&&w(a).remove(),w.merge([],o.childNodes)));var i,o,a},w.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return s>-1&&(r=vt(e.slice(s)),e=e.slice(0,s)),g(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),a.length>0&&w.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?w("<div>").append(w.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){w.fn[t]=function(e){return this.on(t,e)}}),w.expr.pseudos.animated=function(e){return w.grep(w.timers,function(t){return e===t.elem}).length},w.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,c=w.css(e,"position"),f=w(e),p={};"static"===c&&(e.style.position="relative"),s=f.offset(),o=w.css(e,"top"),u=w.css(e,"left"),("absolute"===c||"fixed"===c)&&(o+u).indexOf("auto")>-1?(a=(r=f.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),g(t)&&(t=t.call(e,n,w.extend({},s))),null!=t.top&&(p.top=t.top-s.top+a),null!=t.left&&(p.left=t.left-s.left+i),"using"in t?t.using.call(e,p):f.css(p)}},w.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){w.offset.setOffset(this,e,t)});var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===w.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===w.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=w(e).offset()).top+=w.css(e,"borderTopWidth",!0),i.left+=w.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-w.css(r,"marginTop",!0),left:t.left-i.left-w.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===w.css(e,"position");)e=e.offsetParent;return e||be})}}),w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;w.fn[e]=function(r){return z(this,function(e,r,i){var o;if(y(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===i)return o?o[t]:e[r];o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i},e,r,arguments.length)}}),w.each(["top","left"],function(e,t){w.cssHooks[t]=_e(h.pixelPosition,function(e,n){if(n)return n=Fe(e,t),We.test(n)?w(e).position()[t]+"px":n})}),w.each({Height:"height",Width:"width"},function(e,t){w.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){w.fn[r]=function(i,o){var a=arguments.length&&(n||"boolean"!=typeof i),s=n||(!0===i||!0===o?"margin":"border");return z(this,function(t,n,i){var o;return y(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)},t,a?i:void 0,a)}})}),w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){w.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),w.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),w.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),g(e))return r=o.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(o.call(arguments)))}).guid=e.guid=e.guid||w.guid++,i},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=N,w.isFunction=g,w.isWindow=y,w.camelCase=G,w.type=x,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return w});var Jt=e.jQuery,Kt=e.$;return w.noConflict=function(t){return e.$===w&&(e.$=Kt),t&&e.jQuery===w&&(e.jQuery=Jt),w},t||(e.jQuery=e.$=w),w});var markers=[];document.addEventListener("DOMContentLoaded",event=>{DBHelper.getDB(),fetchNeighborhoods(),fetchCuisines()}),window.addEventListener("load",event=>{registerServiceWorker(),centreDetailsButton(),$gMapsIframe=$("#map-container").find("iframe"),$gMapsIframe&&$gMapsIframe.attr("title","Google Maps iframe")}),registerServiceWorker=(()=>{navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(function(){console.log("Service Worker registered!")}).catch(function(){console.log("Registration of the Service Worker failed")})}),centreDetailsButton=(()=>{const buttons=document.getElementById("restaurants-list").getElementsByTagName("a");for(var i=0;i<buttons.length;i++)buttons[i].style.left="calc(50% - "+buttons[i].clientWidth+"px / 2)"}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((error,neighborhoods)=>{error?console.error(error):(self.neighborhoods=neighborhoods,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((neighborhoods=self.neighborhoods)=>{const select=document.getElementById("neighborhoods-select");neighborhoods.forEach(neighborhood=>{const option=document.createElement("option");option.setAttribute("role","option"),option.innerHTML=neighborhood,option.value=neighborhood,select.append(option)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((error,cuisines)=>{error?console.error(error):(self.cuisines=cuisines,fillCuisinesHTML())})}),fillCuisinesHTML=((cuisines=self.cuisines)=>{const select=document.getElementById("cuisines-select");cuisines.forEach(cuisine=>{const option=document.createElement("option");option.innerHTML=cuisine,option.value=cuisine,select.append(option)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1,mapTypeId:"hybrid"}),updateRestaurants()}),updateRestaurants=(()=>{const cSelect=document.getElementById("cuisines-select"),nSelect=document.getElementById("neighborhoods-select"),cIndex=cSelect.selectedIndex,nIndex=nSelect.selectedIndex,cuisine=cSelect[cIndex].value,neighborhood=nSelect[nIndex].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood,(error,restaurants)=>{error?console.error(error):(resetRestaurants(restaurants),fillRestaurantsHTML())})}),resetRestaurants=(restaurants=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(m=>m.setMap(null)),self.markers=[],self.restaurants=restaurants}),fillRestaurantsHTML=((restaurants=self.restaurants)=>{const ul=document.getElementById("restaurants-list");restaurants.forEach(restaurant=>{ul.append(createRestaurantHTML(restaurant))}),addMarkersToMap()}),createRestaurantHTML=(restaurant=>{const li=document.createElement("li"),figure=document.createElement("figure"),figCaption=document.createElement("figcaption"),image=document.createElement("img");figure.className="restaurant-img",image.alt="Restaurant: "+restaurant.name,image.src=DBHelper.imageUrlForRestaurant(restaurant),image.srcset=DBHelper.imageSrcSetAttrForRestaurant(restaurant),figure.append(image),figure.append(figCaption),li.append(figure);const name=document.createElement("h2");name.innerHTML=restaurant.name,figCaption.append(name);const neighborhood=document.createElement("p");neighborhood.innerHTML=restaurant.neighborhood,figCaption.append(neighborhood);const address=document.createElement("p");address.innerHTML=restaurant.address,figCaption.append(address);const more=document.createElement("a");return more.innerHTML="View Details",more.href=DBHelper.urlForRestaurant(restaurant),figCaption.append(more),li}),addMarkersToMap=((restaurants=self.restaurants)=>{restaurants.forEach(restaurant=>{const marker=DBHelper.mapMarkerForRestaurant(restaurant,self.map);google.maps.event.addListener(marker,"click",()=>{window.location.href=marker.url}),self.markers.push(marker)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwiaWRiLmpzIiwianF1ZXJ5LTMuMy4xLm1pbi5qcyIsIm1haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbk9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNVBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzk3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhbGxfbWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXG4vKiBqc2hpbnQgZXN2ZXJzaW9uOiA2ICovXG5jbGFzcyBEQkhlbHBlciB7XG5cbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XG4gICAgY29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XG4gIH1cblxuICAvKipcclxuICAgKiAgU3RvcmUgdGhlIHByb21pc2Ugb2YgdGhlIGRhdGFiYXNlXHJcbiAgICpcclxuICAgKi9cbiAgc3RhdGljIGdldERCKCkge1xuICAgIHRoaXMucmVzdGF1cmFudERCUHJvbWlzZSA9IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEsIGZ1bmN0aW9uICh1cGdyYWRlREIpIHtcbiAgICAgIHN3aXRjaCAodXBncmFkZURCLm9sZFZlcnNpb24pIHtcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICAgIHZhciBrZXlWYWxTdG9yZSA9IHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7XG4gICAgICAgICAgICBrZXlQYXRoOiAnaWQnXG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcclxuICAgKiBQcm9jZXNzIHRoZSByZXNwb25zZSBvZiB0aGUgZmV0Y2ggcmVxdWVzdFxyXG4gICAqL1xuICBzdGF0aWMgc3RhdHVzKHJlc3BvbnNlKSB7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA+PSAyMDAgJiYgcmVzcG9uc2Uuc3RhdHVzIDwgMzAwKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3BvbnNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxyXG4gICAqIFBhcnNlIHRoZSByZWNlaXZlZCBKU09OIGRhdGFcclxuICAgKi9cbiAgc3RhdGljIGpzb24ocmVzcG9uc2UpIHtcbiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICB9XG5cbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xuICAgIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTCkudGhlbihEQkhlbHBlci5zdGF0dXMpLnRoZW4oREJIZWxwZXIuanNvbikudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudHMpIHtcbiAgICAgIERCSGVscGVyLnJlc3RhdXJhbnREQlByb21pc2UudGhlbihmdW5jdGlvbiAoZGIpIHtcbiAgICAgICAgaWYgKCFkYikgcmV0dXJuO1xuXG4gICAgICAgIHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgdmFyIHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XG4gICAgICAgIHJlc3RhdXJhbnRzLmZvckVhY2goZnVuY3Rpb24gKHJlc3RhdXJhbnQpIHtcbiAgICAgICAgICBzdG9yZS5wdXQocmVzdGF1cmFudCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAvLyBXaGVuIGZldGNoIGZhaWxzLCB0cnkgdG8gZ2V0IHRoZSBkYXRhIGZyb20gdGhlIGRhdGFiYXNlXG4gICAgICBEQkhlbHBlci5yZXN0YXVyYW50REJQcm9taXNlLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICAgIGlmICghZGIpIHJldHVybjtcblxuICAgICAgICB2YXIgaW5kZXggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnKS5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcblxuICAgICAgICByZXR1cm4gaW5kZXguZ2V0QWxsKCkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudHMpIHtcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XG4gICAgICAgIH0pO1xuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICovXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpO1xuICAgICAgICBpZiAocmVzdGF1cmFudCkge1xuICAgICAgICAgIC8vIEdvdCB0aGUgcmVzdGF1cmFudFxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXG4gICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7XG4gICAgICAgICAgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7XG4gICAgICAgICAgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpO1xuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICByZXR1cm4gYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gO1xuICB9XG5cbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgIC8vIFRPRE8gYWRkIGNoZWNrIGZvciBTYWZhcmksIEZpcmVmb3gsIElFLCByZWdhcmRpbmcgd2VicFxuICAgIHJldHVybiBgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaCA/IHJlc3RhdXJhbnQucGhvdG9ncmFwaCArICcud2VicCcgOiAnTm9faW1hZ2Uuc3ZnJ31gO1xuICB9XG5cbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBzcmNzZXRcclxuICAgKi9cbiAgc3RhdGljIGltYWdlU3JjU2V0QXR0ckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgIGNvbnN0IGZpbGVOYW1lID0gcmVzdGF1cmFudC5waG90b2dyYXBoO1xuICAgIHJldHVybiBmaWxlTmFtZSA/IGAvaW1nLyR7ZmlsZU5hbWV9LndlYnAgMXgsIC9pbWcvJHtmaWxlTmFtZX1AMngud2VicCAyeGAgOiAnJztcbiAgfVxuXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxuICAgICAgbWFwOiBtYXAsXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXG4gICAgfSk7XG4gICAgcmV0dXJuIG1hcmtlcjtcbiAgfVxufSIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcblxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFsnbmFtZScsICdrZXlQYXRoJywgJ211bHRpRW50cnknLCAndW5pcXVlJ10pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgWydnZXQnLCAnZ2V0S2V5JywgJ2dldEFsbCcsICdnZXRBbGxLZXlzJywgJ2NvdW50J10pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXSk7XG5cbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgWydkaXJlY3Rpb24nLCAna2V5JywgJ3ByaW1hcnlLZXknLCAndmFsdWUnXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbJ3VwZGF0ZScsICdkZWxldGUnXSk7XG5cbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZE5hbWUpIHtcbiAgICBpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XG4gIH1cblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFsnbmFtZScsICdrZXlQYXRoJywgJ2luZGV4TmFtZXMnLCAnYXV0b0luY3JlbWVudCddKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInLCAnZ2V0JywgJ2dldEFsbCcsICdnZXRLZXknLCAnZ2V0QWxsS2V5cycsICdjb3VudCddKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10pO1xuXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbJ2RlbGV0ZUluZGV4J10pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgWydvYmplY3RTdG9yZU5hbWVzJywgJ21vZGUnXSk7XG5cbiAgcHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFsnYWJvcnQnXSk7XG5cbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFsnbmFtZScsICd2ZXJzaW9uJywgJ29iamVjdFN0b3JlTmFtZXMnXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbJ2RlbGV0ZU9iamVjdFN0b3JlJywgJ2Nsb3NlJ10pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbJ25hbWUnLCAndmVyc2lvbicsICdvYmplY3RTdG9yZU5hbWVzJ10pO1xuXG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbJ2Nsb3NlJ10pO1xuXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uIChmdW5jTmFtZSkge1xuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24gKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcbiAgW0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbiAoQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbiAocXVlcnksIGNvdW50KSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbiAoY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uIChuYW1lLCB2ZXJzaW9uLCB1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcblxuICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnZGVsZXRlRGF0YWJhc2UnLCBbbmFtZV0pO1xuICAgIH1cbiAgfTtcblxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcbiAgICBtb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gbW9kdWxlLmV4cG9ydHM7XG4gIH0gZWxzZSB7XG4gICAgc2VsZi5pZGIgPSBleHA7XG4gIH1cbn0pKCk7IiwiLyohIGpRdWVyeSB2My4zLjEgfCAoYykgSlMgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzIHwganF1ZXJ5Lm9yZy9saWNlbnNlICovXG4hZnVuY3Rpb24gKGUsIHQpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG4gIFwib2JqZWN0XCIgPT0gdHlwZW9mIG1vZHVsZSAmJiBcIm9iamVjdFwiID09IHR5cGVvZiBtb2R1bGUuZXhwb3J0cyA/IG1vZHVsZS5leHBvcnRzID0gZS5kb2N1bWVudCA/IHQoZSwgITApIDogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoIWUuZG9jdW1lbnQpIHRocm93IG5ldyBFcnJvcihcImpRdWVyeSByZXF1aXJlcyBhIHdpbmRvdyB3aXRoIGEgZG9jdW1lbnRcIik7cmV0dXJuIHQoZSk7XG4gIH0gOiB0KGUpO1xufShcInVuZGVmaW5lZFwiICE9IHR5cGVvZiB3aW5kb3cgPyB3aW5kb3cgOiB0aGlzLCBmdW5jdGlvbiAoZSwgdCkge1xuICBcInVzZSBzdHJpY3RcIjtcbiAgdmFyIG4gPSBbXSxcbiAgICAgIHIgPSBlLmRvY3VtZW50LFxuICAgICAgaSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZixcbiAgICAgIG8gPSBuLnNsaWNlLFxuICAgICAgYSA9IG4uY29uY2F0LFxuICAgICAgcyA9IG4ucHVzaCxcbiAgICAgIHUgPSBuLmluZGV4T2YsXG4gICAgICBsID0ge30sXG4gICAgICBjID0gbC50b1N0cmluZyxcbiAgICAgIGYgPSBsLmhhc093blByb3BlcnR5LFxuICAgICAgcCA9IGYudG9TdHJpbmcsXG4gICAgICBkID0gcC5jYWxsKE9iamVjdCksXG4gICAgICBoID0ge30sXG4gICAgICBnID0gZnVuY3Rpb24gZSh0KSB7XG4gICAgcmV0dXJuIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgdCAmJiBcIm51bWJlclwiICE9IHR5cGVvZiB0Lm5vZGVUeXBlO1xuICB9LFxuICAgICAgeSA9IGZ1bmN0aW9uIGUodCkge1xuICAgIHJldHVybiBudWxsICE9IHQgJiYgdCA9PT0gdC53aW5kb3c7XG4gIH0sXG4gICAgICB2ID0geyB0eXBlOiAhMCwgc3JjOiAhMCwgbm9Nb2R1bGU6ICEwIH07ZnVuY3Rpb24gbShlLCB0LCBuKSB7XG4gICAgdmFyIGksXG4gICAgICAgIG8gPSAodCA9IHQgfHwgcikuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtpZiAoby50ZXh0ID0gZSwgbikgZm9yIChpIGluIHYpIG5baV0gJiYgKG9baV0gPSBuW2ldKTt0LmhlYWQuYXBwZW5kQ2hpbGQobykucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvKTtcbiAgfWZ1bmN0aW9uIHgoZSkge1xuICAgIHJldHVybiBudWxsID09IGUgPyBlICsgXCJcIiA6IFwib2JqZWN0XCIgPT0gdHlwZW9mIGUgfHwgXCJmdW5jdGlvblwiID09IHR5cGVvZiBlID8gbFtjLmNhbGwoZSldIHx8IFwib2JqZWN0XCIgOiB0eXBlb2YgZTtcbiAgfXZhciBiID0gXCIzLjMuMVwiLFxuICAgICAgdyA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgcmV0dXJuIG5ldyB3LmZuLmluaXQoZSwgdCk7XG4gIH0sXG4gICAgICBUID0gL15bXFxzXFx1RkVGRlxceEEwXSt8W1xcc1xcdUZFRkZcXHhBMF0rJC9nO3cuZm4gPSB3LnByb3RvdHlwZSA9IHsganF1ZXJ5OiBcIjMuMy4xXCIsIGNvbnN0cnVjdG9yOiB3LCBsZW5ndGg6IDAsIHRvQXJyYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBvLmNhbGwodGhpcyk7XG4gICAgfSwgZ2V0OiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIG51bGwgPT0gZSA/IG8uY2FsbCh0aGlzKSA6IGUgPCAwID8gdGhpc1tlICsgdGhpcy5sZW5ndGhdIDogdGhpc1tlXTtcbiAgICB9LCBwdXNoU3RhY2s6IGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgdCA9IHcubWVyZ2UodGhpcy5jb25zdHJ1Y3RvcigpLCBlKTtyZXR1cm4gdC5wcmV2T2JqZWN0ID0gdGhpcywgdDtcbiAgICB9LCBlYWNoOiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIHcuZWFjaCh0aGlzLCBlKTtcbiAgICB9LCBtYXA6IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2sody5tYXAodGhpcywgZnVuY3Rpb24gKHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIGUuY2FsbCh0LCBuLCB0KTtcbiAgICAgIH0pKTtcbiAgICB9LCBzbGljZTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKG8uYXBwbHkodGhpcywgYXJndW1lbnRzKSk7XG4gICAgfSwgZmlyc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmVxKDApO1xuICAgIH0sIGxhc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmVxKC0xKTtcbiAgICB9LCBlcTogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciB0ID0gdGhpcy5sZW5ndGgsXG4gICAgICAgICAgbiA9ICtlICsgKGUgPCAwID8gdCA6IDApO3JldHVybiB0aGlzLnB1c2hTdGFjayhuID49IDAgJiYgbiA8IHQgPyBbdGhpc1tuXV0gOiBbXSk7XG4gICAgfSwgZW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcmV2T2JqZWN0IHx8IHRoaXMuY29uc3RydWN0b3IoKTtcbiAgICB9LCBwdXNoOiBzLCBzb3J0OiBuLnNvcnQsIHNwbGljZTogbi5zcGxpY2UgfSwgdy5leHRlbmQgPSB3LmZuLmV4dGVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZSxcbiAgICAgICAgdCxcbiAgICAgICAgbixcbiAgICAgICAgcixcbiAgICAgICAgaSxcbiAgICAgICAgbyxcbiAgICAgICAgYSA9IGFyZ3VtZW50c1swXSB8fCB7fSxcbiAgICAgICAgcyA9IDEsXG4gICAgICAgIHUgPSBhcmd1bWVudHMubGVuZ3RoLFxuICAgICAgICBsID0gITE7Zm9yIChcImJvb2xlYW5cIiA9PSB0eXBlb2YgYSAmJiAobCA9IGEsIGEgPSBhcmd1bWVudHNbc10gfHwge30sIHMrKyksIFwib2JqZWN0XCIgPT0gdHlwZW9mIGEgfHwgZyhhKSB8fCAoYSA9IHt9KSwgcyA9PT0gdSAmJiAoYSA9IHRoaXMsIHMtLSk7IHMgPCB1OyBzKyspIGlmIChudWxsICE9IChlID0gYXJndW1lbnRzW3NdKSkgZm9yICh0IGluIGUpIG4gPSBhW3RdLCBhICE9PSAociA9IGVbdF0pICYmIChsICYmIHIgJiYgKHcuaXNQbGFpbk9iamVjdChyKSB8fCAoaSA9IEFycmF5LmlzQXJyYXkocikpKSA/IChpID8gKGkgPSAhMSwgbyA9IG4gJiYgQXJyYXkuaXNBcnJheShuKSA/IG4gOiBbXSkgOiBvID0gbiAmJiB3LmlzUGxhaW5PYmplY3QobikgPyBuIDoge30sIGFbdF0gPSB3LmV4dGVuZChsLCBvLCByKSkgOiB2b2lkIDAgIT09IHIgJiYgKGFbdF0gPSByKSk7cmV0dXJuIGE7XG4gIH0sIHcuZXh0ZW5kKHsgZXhwYW5kbzogXCJqUXVlcnlcIiArIChcIjMuMy4xXCIgKyBNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cXEQvZywgXCJcIiksIGlzUmVhZHk6ICEwLCBlcnJvcjogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihlKTtcbiAgICB9LCBub29wOiBmdW5jdGlvbiAoKSB7fSwgaXNQbGFpbk9iamVjdDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciB0LCBuO3JldHVybiAhKCFlIHx8IFwiW29iamVjdCBPYmplY3RdXCIgIT09IGMuY2FsbChlKSkgJiYgKCEodCA9IGkoZSkpIHx8IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgKG4gPSBmLmNhbGwodCwgXCJjb25zdHJ1Y3RvclwiKSAmJiB0LmNvbnN0cnVjdG9yKSAmJiBwLmNhbGwobikgPT09IGQpO1xuICAgIH0sIGlzRW1wdHlPYmplY3Q6IGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgdDtmb3IgKHQgaW4gZSkgcmV0dXJuICExO3JldHVybiAhMDtcbiAgICB9LCBnbG9iYWxFdmFsOiBmdW5jdGlvbiAoZSkge1xuICAgICAgbShlKTtcbiAgICB9LCBlYWNoOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgdmFyIG4sXG4gICAgICAgICAgciA9IDA7aWYgKEMoZSkpIHtcbiAgICAgICAgZm9yIChuID0gZS5sZW5ndGg7IHIgPCBuOyByKyspIGlmICghMSA9PT0gdC5jYWxsKGVbcl0sIHIsIGVbcl0pKSBicmVhaztcbiAgICAgIH0gZWxzZSBmb3IgKHIgaW4gZSkgaWYgKCExID09PSB0LmNhbGwoZVtyXSwgciwgZVtyXSkpIGJyZWFrO3JldHVybiBlO1xuICAgIH0sIHRyaW06IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gbnVsbCA9PSBlID8gXCJcIiA6IChlICsgXCJcIikucmVwbGFjZShULCBcIlwiKTtcbiAgICB9LCBtYWtlQXJyYXk6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICB2YXIgbiA9IHQgfHwgW107cmV0dXJuIG51bGwgIT0gZSAmJiAoQyhPYmplY3QoZSkpID8gdy5tZXJnZShuLCBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gW2VdIDogZSkgOiBzLmNhbGwobiwgZSkpLCBuO1xuICAgIH0sIGluQXJyYXk6IGZ1bmN0aW9uIChlLCB0LCBuKSB7XG4gICAgICByZXR1cm4gbnVsbCA9PSB0ID8gLTEgOiB1LmNhbGwodCwgZSwgbik7XG4gICAgfSwgbWVyZ2U6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICBmb3IgKHZhciBuID0gK3QubGVuZ3RoLCByID0gMCwgaSA9IGUubGVuZ3RoOyByIDwgbjsgcisrKSBlW2krK10gPSB0W3JdO3JldHVybiBlLmxlbmd0aCA9IGksIGU7XG4gICAgfSwgZ3JlcDogZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICAgIGZvciAodmFyIHIsIGkgPSBbXSwgbyA9IDAsIGEgPSBlLmxlbmd0aCwgcyA9ICFuOyBvIDwgYTsgbysrKSAociA9ICF0KGVbb10sIG8pKSAhPT0gcyAmJiBpLnB1c2goZVtvXSk7cmV0dXJuIGk7XG4gICAgfSwgbWFwOiBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgdmFyIHIsXG4gICAgICAgICAgaSxcbiAgICAgICAgICBvID0gMCxcbiAgICAgICAgICBzID0gW107aWYgKEMoZSkpIGZvciAociA9IGUubGVuZ3RoOyBvIDwgcjsgbysrKSBudWxsICE9IChpID0gdChlW29dLCBvLCBuKSkgJiYgcy5wdXNoKGkpO2Vsc2UgZm9yIChvIGluIGUpIG51bGwgIT0gKGkgPSB0KGVbb10sIG8sIG4pKSAmJiBzLnB1c2goaSk7cmV0dXJuIGEuYXBwbHkoW10sIHMpO1xuICAgIH0sIGd1aWQ6IDEsIHN1cHBvcnQ6IGggfSksIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmICh3LmZuW1N5bWJvbC5pdGVyYXRvcl0gPSBuW1N5bWJvbC5pdGVyYXRvcl0pLCB3LmVhY2goXCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0IEVycm9yIFN5bWJvbFwiLnNwbGl0KFwiIFwiKSwgZnVuY3Rpb24gKGUsIHQpIHtcbiAgICBsW1wiW29iamVjdCBcIiArIHQgKyBcIl1cIl0gPSB0LnRvTG93ZXJDYXNlKCk7XG4gIH0pO2Z1bmN0aW9uIEMoZSkge1xuICAgIHZhciB0ID0gISFlICYmIFwibGVuZ3RoXCIgaW4gZSAmJiBlLmxlbmd0aCxcbiAgICAgICAgbiA9IHgoZSk7cmV0dXJuICFnKGUpICYmICF5KGUpICYmIChcImFycmF5XCIgPT09IG4gfHwgMCA9PT0gdCB8fCBcIm51bWJlclwiID09IHR5cGVvZiB0ICYmIHQgPiAwICYmIHQgLSAxIGluIGUpO1xuICB9dmFyIEUgPSBmdW5jdGlvbiAoZSkge1xuICAgIHZhciB0LFxuICAgICAgICBuLFxuICAgICAgICByLFxuICAgICAgICBpLFxuICAgICAgICBvLFxuICAgICAgICBhLFxuICAgICAgICBzLFxuICAgICAgICB1LFxuICAgICAgICBsLFxuICAgICAgICBjLFxuICAgICAgICBmLFxuICAgICAgICBwLFxuICAgICAgICBkLFxuICAgICAgICBoLFxuICAgICAgICBnLFxuICAgICAgICB5LFxuICAgICAgICB2LFxuICAgICAgICBtLFxuICAgICAgICB4LFxuICAgICAgICBiID0gXCJzaXp6bGVcIiArIDEgKiBuZXcgRGF0ZSgpLFxuICAgICAgICB3ID0gZS5kb2N1bWVudCxcbiAgICAgICAgVCA9IDAsXG4gICAgICAgIEMgPSAwLFxuICAgICAgICBFID0gYWUoKSxcbiAgICAgICAgayA9IGFlKCksXG4gICAgICAgIFMgPSBhZSgpLFxuICAgICAgICBEID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIHJldHVybiBlID09PSB0ICYmIChmID0gITApLCAwO1xuICAgIH0sXG4gICAgICAgIE4gPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgICAgICAgQSA9IFtdLFxuICAgICAgICBqID0gQS5wb3AsXG4gICAgICAgIHEgPSBBLnB1c2gsXG4gICAgICAgIEwgPSBBLnB1c2gsXG4gICAgICAgIEggPSBBLnNsaWNlLFxuICAgICAgICBPID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIGZvciAodmFyIG4gPSAwLCByID0gZS5sZW5ndGg7IG4gPCByOyBuKyspIGlmIChlW25dID09PSB0KSByZXR1cm4gbjtyZXR1cm4gLTE7XG4gICAgfSxcbiAgICAgICAgUCA9IFwiY2hlY2tlZHxzZWxlY3RlZHxhc3luY3xhdXRvZm9jdXN8YXV0b3BsYXl8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGlzbWFwfGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWRcIixcbiAgICAgICAgTSA9IFwiW1xcXFx4MjBcXFxcdFxcXFxyXFxcXG5cXFxcZl1cIixcbiAgICAgICAgUiA9IFwiKD86XFxcXFxcXFwufFtcXFxcdy1dfFteXFwwLVxcXFx4YTBdKStcIixcbiAgICAgICAgSSA9IFwiXFxcXFtcIiArIE0gKyBcIiooXCIgKyBSICsgXCIpKD86XCIgKyBNICsgXCIqKFsqXiR8IX5dPz0pXCIgKyBNICsgXCIqKD86JygoPzpcXFxcXFxcXC58W15cXFxcXFxcXCddKSopJ3xcXFwiKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcXFxcIl0pKilcXFwifChcIiArIFIgKyBcIikpfClcIiArIE0gKyBcIipcXFxcXVwiLFxuICAgICAgICBXID0gXCI6KFwiICsgUiArIFwiKSg/OlxcXFwoKCgnKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcJ10pKiknfFxcXCIoKD86XFxcXFxcXFwufFteXFxcXFxcXFxcXFwiXSkqKVxcXCIpfCgoPzpcXFxcXFxcXC58W15cXFxcXFxcXCgpW1xcXFxdXXxcIiArIEkgKyBcIikqKXwuKilcXFxcKXwpXCIsXG4gICAgICAgICQgPSBuZXcgUmVnRXhwKE0gKyBcIitcIiwgXCJnXCIpLFxuICAgICAgICBCID0gbmV3IFJlZ0V4cChcIl5cIiArIE0gKyBcIit8KCg/Ol58W15cXFxcXFxcXF0pKD86XFxcXFxcXFwuKSopXCIgKyBNICsgXCIrJFwiLCBcImdcIiksXG4gICAgICAgIEYgPSBuZXcgUmVnRXhwKFwiXlwiICsgTSArIFwiKixcIiArIE0gKyBcIipcIiksXG4gICAgICAgIF8gPSBuZXcgUmVnRXhwKFwiXlwiICsgTSArIFwiKihbPit+XXxcIiArIE0gKyBcIilcIiArIE0gKyBcIipcIiksXG4gICAgICAgIHogPSBuZXcgUmVnRXhwKFwiPVwiICsgTSArIFwiKihbXlxcXFxdJ1xcXCJdKj8pXCIgKyBNICsgXCIqXFxcXF1cIiwgXCJnXCIpLFxuICAgICAgICBYID0gbmV3IFJlZ0V4cChXKSxcbiAgICAgICAgVSA9IG5ldyBSZWdFeHAoXCJeXCIgKyBSICsgXCIkXCIpLFxuICAgICAgICBWID0geyBJRDogbmV3IFJlZ0V4cChcIl4jKFwiICsgUiArIFwiKVwiKSwgQ0xBU1M6IG5ldyBSZWdFeHAoXCJeXFxcXC4oXCIgKyBSICsgXCIpXCIpLCBUQUc6IG5ldyBSZWdFeHAoXCJeKFwiICsgUiArIFwifFsqXSlcIiksIEFUVFI6IG5ldyBSZWdFeHAoXCJeXCIgKyBJKSwgUFNFVURPOiBuZXcgUmVnRXhwKFwiXlwiICsgVyksIENISUxEOiBuZXcgUmVnRXhwKFwiXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XFxcXChcIiArIE0gKyBcIiooZXZlbnxvZGR8KChbKy1dfCkoXFxcXGQqKW58KVwiICsgTSArIFwiKig/OihbKy1dfClcIiArIE0gKyBcIiooXFxcXGQrKXwpKVwiICsgTSArIFwiKlxcXFwpfClcIiwgXCJpXCIpLCBib29sOiBuZXcgUmVnRXhwKFwiXig/OlwiICsgUCArIFwiKSRcIiwgXCJpXCIpLCBuZWVkc0NvbnRleHQ6IG5ldyBSZWdFeHAoXCJeXCIgKyBNICsgXCIqWz4rfl18OihldmVufG9kZHxlcXxndHxsdHxudGh8Zmlyc3R8bGFzdCkoPzpcXFxcKFwiICsgTSArIFwiKigoPzotXFxcXGQpP1xcXFxkKilcIiArIE0gKyBcIipcXFxcKXwpKD89W14tXXwkKVwiLCBcImlcIikgfSxcbiAgICAgICAgRyA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksXG4gICAgICAgIFkgPSAvXmhcXGQkL2ksXG4gICAgICAgIFEgPSAvXltee10rXFx7XFxzKlxcW25hdGl2ZSBcXHcvLFxuICAgICAgICBKID0gL14oPzojKFtcXHctXSspfChcXHcrKXxcXC4oW1xcdy1dKykpJC8sXG4gICAgICAgIEsgPSAvWyt+XS8sXG4gICAgICAgIFogPSBuZXcgUmVnRXhwKFwiXFxcXFxcXFwoW1xcXFxkYS1mXXsxLDZ9XCIgKyBNICsgXCI/fChcIiArIE0gKyBcIil8LilcIiwgXCJpZ1wiKSxcbiAgICAgICAgZWUgPSBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgdmFyIHIgPSBcIjB4XCIgKyB0IC0gNjU1MzY7cmV0dXJuIHIgIT09IHIgfHwgbiA/IHQgOiByIDwgMCA/IFN0cmluZy5mcm9tQ2hhckNvZGUociArIDY1NTM2KSA6IFN0cmluZy5mcm9tQ2hhckNvZGUociA+PiAxMCB8IDU1Mjk2LCAxMDIzICYgciB8IDU2MzIwKTtcbiAgICB9LFxuICAgICAgICB0ZSA9IC8oW1xcMC1cXHgxZlxceDdmXXxeLT9cXGQpfF4tJHxbXlxcMC1cXHgxZlxceDdmLVxcdUZGRkZcXHctXS9nLFxuICAgICAgICBuZSA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICByZXR1cm4gdCA/IFwiXFwwXCIgPT09IGUgPyBcIlxcdWZmZmRcIiA6IGUuc2xpY2UoMCwgLTEpICsgXCJcXFxcXCIgKyBlLmNoYXJDb2RlQXQoZS5sZW5ndGggLSAxKS50b1N0cmluZygxNikgKyBcIiBcIiA6IFwiXFxcXFwiICsgZTtcbiAgICB9LFxuICAgICAgICByZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHAoKTtcbiAgICB9LFxuICAgICAgICBpZSA9IG1lKGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gITAgPT09IGUuZGlzYWJsZWQgJiYgKFwiZm9ybVwiIGluIGUgfHwgXCJsYWJlbFwiIGluIGUpO1xuICAgIH0sIHsgZGlyOiBcInBhcmVudE5vZGVcIiwgbmV4dDogXCJsZWdlbmRcIiB9KTt0cnkge1xuICAgICAgTC5hcHBseShBID0gSC5jYWxsKHcuY2hpbGROb2RlcyksIHcuY2hpbGROb2RlcyksIEFbdy5jaGlsZE5vZGVzLmxlbmd0aF0ubm9kZVR5cGU7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgTCA9IHsgYXBwbHk6IEEubGVuZ3RoID8gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgICBxLmFwcGx5KGUsIEguY2FsbCh0KSk7XG4gICAgICAgIH0gOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICAgIHZhciBuID0gZS5sZW5ndGgsXG4gICAgICAgICAgICAgIHIgPSAwO3doaWxlIChlW24rK10gPSB0W3IrK10pO2UubGVuZ3RoID0gbiAtIDE7XG4gICAgICAgIH0gfTtcbiAgICB9ZnVuY3Rpb24gb2UoZSwgdCwgciwgaSkge1xuICAgICAgdmFyIG8sXG4gICAgICAgICAgcyxcbiAgICAgICAgICBsLFxuICAgICAgICAgIGMsXG4gICAgICAgICAgZixcbiAgICAgICAgICBoLFxuICAgICAgICAgIHYsXG4gICAgICAgICAgbSA9IHQgJiYgdC5vd25lckRvY3VtZW50LFxuICAgICAgICAgIFQgPSB0ID8gdC5ub2RlVHlwZSA6IDk7aWYgKHIgPSByIHx8IFtdLCBcInN0cmluZ1wiICE9IHR5cGVvZiBlIHx8ICFlIHx8IDEgIT09IFQgJiYgOSAhPT0gVCAmJiAxMSAhPT0gVCkgcmV0dXJuIHI7aWYgKCFpICYmICgodCA/IHQub3duZXJEb2N1bWVudCB8fCB0IDogdykgIT09IGQgJiYgcCh0KSwgdCA9IHQgfHwgZCwgZykpIHtcbiAgICAgICAgaWYgKDExICE9PSBUICYmIChmID0gSi5leGVjKGUpKSkgaWYgKG8gPSBmWzFdKSB7XG4gICAgICAgICAgaWYgKDkgPT09IFQpIHtcbiAgICAgICAgICAgIGlmICghKGwgPSB0LmdldEVsZW1lbnRCeUlkKG8pKSkgcmV0dXJuIHI7aWYgKGwuaWQgPT09IG8pIHJldHVybiByLnB1c2gobCksIHI7XG4gICAgICAgICAgfSBlbHNlIGlmIChtICYmIChsID0gbS5nZXRFbGVtZW50QnlJZChvKSkgJiYgeCh0LCBsKSAmJiBsLmlkID09PSBvKSByZXR1cm4gci5wdXNoKGwpLCByO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChmWzJdKSByZXR1cm4gTC5hcHBseShyLCB0LmdldEVsZW1lbnRzQnlUYWdOYW1lKGUpKSwgcjtpZiAoKG8gPSBmWzNdKSAmJiBuLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgJiYgdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSByZXR1cm4gTC5hcHBseShyLCB0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUobykpLCByO1xuICAgICAgICB9aWYgKG4ucXNhICYmICFTW2UgKyBcIiBcIl0gJiYgKCF5IHx8ICF5LnRlc3QoZSkpKSB7XG4gICAgICAgICAgaWYgKDEgIT09IFQpIG0gPSB0LCB2ID0gZTtlbHNlIGlmIChcIm9iamVjdFwiICE9PSB0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgIChjID0gdC5nZXRBdHRyaWJ1dGUoXCJpZFwiKSkgPyBjID0gYy5yZXBsYWNlKHRlLCBuZSkgOiB0LnNldEF0dHJpYnV0ZShcImlkXCIsIGMgPSBiKSwgcyA9IChoID0gYShlKSkubGVuZ3RoO3doaWxlIChzLS0pIGhbc10gPSBcIiNcIiArIGMgKyBcIiBcIiArIHZlKGhbc10pO3YgPSBoLmpvaW4oXCIsXCIpLCBtID0gSy50ZXN0KGUpICYmIGdlKHQucGFyZW50Tm9kZSkgfHwgdDtcbiAgICAgICAgICB9aWYgKHYpIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gTC5hcHBseShyLCBtLnF1ZXJ5U2VsZWN0b3JBbGwodikpLCByO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9IGZpbmFsbHkge1xuICAgICAgICAgICAgYyA9PT0gYiAmJiB0LnJlbW92ZUF0dHJpYnV0ZShcImlkXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfXJldHVybiB1KGUucmVwbGFjZShCLCBcIiQxXCIpLCB0LCByLCBpKTtcbiAgICB9ZnVuY3Rpb24gYWUoKSB7XG4gICAgICB2YXIgZSA9IFtdO2Z1bmN0aW9uIHQobiwgaSkge1xuICAgICAgICByZXR1cm4gZS5wdXNoKG4gKyBcIiBcIikgPiByLmNhY2hlTGVuZ3RoICYmIGRlbGV0ZSB0W2Uuc2hpZnQoKV0sIHRbbiArIFwiIFwiXSA9IGk7XG4gICAgICB9cmV0dXJuIHQ7XG4gICAgfWZ1bmN0aW9uIHNlKGUpIHtcbiAgICAgIHJldHVybiBlW2JdID0gITAsIGU7XG4gICAgfWZ1bmN0aW9uIHVlKGUpIHtcbiAgICAgIHZhciB0ID0gZC5jcmVhdGVFbGVtZW50KFwiZmllbGRzZXRcIik7dHJ5IHtcbiAgICAgICAgcmV0dXJuICEhZSh0KTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgdC5wYXJlbnROb2RlICYmIHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0KSwgdCA9IG51bGw7XG4gICAgICB9XG4gICAgfWZ1bmN0aW9uIGxlKGUsIHQpIHtcbiAgICAgIHZhciBuID0gZS5zcGxpdChcInxcIiksXG4gICAgICAgICAgaSA9IG4ubGVuZ3RoO3doaWxlIChpLS0pIHIuYXR0ckhhbmRsZVtuW2ldXSA9IHQ7XG4gICAgfWZ1bmN0aW9uIGNlKGUsIHQpIHtcbiAgICAgIHZhciBuID0gdCAmJiBlLFxuICAgICAgICAgIHIgPSBuICYmIDEgPT09IGUubm9kZVR5cGUgJiYgMSA9PT0gdC5ub2RlVHlwZSAmJiBlLnNvdXJjZUluZGV4IC0gdC5zb3VyY2VJbmRleDtpZiAocikgcmV0dXJuIHI7aWYgKG4pIHdoaWxlIChuID0gbi5uZXh0U2libGluZykgaWYgKG4gPT09IHQpIHJldHVybiAtMTtyZXR1cm4gZSA/IDEgOiAtMTtcbiAgICB9ZnVuY3Rpb24gZmUoZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHJldHVybiBcImlucHV0XCIgPT09IHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAmJiB0LnR5cGUgPT09IGU7XG4gICAgICB9O1xuICAgIH1mdW5jdGlvbiBwZShlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgdmFyIG4gPSB0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuIChcImlucHV0XCIgPT09IG4gfHwgXCJidXR0b25cIiA9PT0gbikgJiYgdC50eXBlID09PSBlO1xuICAgICAgfTtcbiAgICB9ZnVuY3Rpb24gZGUoZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHJldHVybiBcImZvcm1cIiBpbiB0ID8gdC5wYXJlbnROb2RlICYmICExID09PSB0LmRpc2FibGVkID8gXCJsYWJlbFwiIGluIHQgPyBcImxhYmVsXCIgaW4gdC5wYXJlbnROb2RlID8gdC5wYXJlbnROb2RlLmRpc2FibGVkID09PSBlIDogdC5kaXNhYmxlZCA9PT0gZSA6IHQuaXNEaXNhYmxlZCA9PT0gZSB8fCB0LmlzRGlzYWJsZWQgIT09ICFlICYmIGllKHQpID09PSBlIDogdC5kaXNhYmxlZCA9PT0gZSA6IFwibGFiZWxcIiBpbiB0ICYmIHQuZGlzYWJsZWQgPT09IGU7XG4gICAgICB9O1xuICAgIH1mdW5jdGlvbiBoZShlKSB7XG4gICAgICByZXR1cm4gc2UoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgcmV0dXJuIHQgPSArdCwgc2UoZnVuY3Rpb24gKG4sIHIpIHtcbiAgICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgICAgbyA9IGUoW10sIG4ubGVuZ3RoLCB0KSxcbiAgICAgICAgICAgICAgYSA9IG8ubGVuZ3RoO3doaWxlIChhLS0pIG5baSA9IG9bYV1dICYmIChuW2ldID0gIShyW2ldID0gbltpXSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1mdW5jdGlvbiBnZShlKSB7XG4gICAgICByZXR1cm4gZSAmJiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBlLmdldEVsZW1lbnRzQnlUYWdOYW1lICYmIGU7XG4gICAgfW4gPSBvZS5zdXBwb3J0ID0ge30sIG8gPSBvZS5pc1hNTCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgdCA9IGUgJiYgKGUub3duZXJEb2N1bWVudCB8fCBlKS5kb2N1bWVudEVsZW1lbnQ7cmV0dXJuICEhdCAmJiBcIkhUTUxcIiAhPT0gdC5ub2RlTmFtZTtcbiAgICB9LCBwID0gb2Uuc2V0RG9jdW1lbnQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHQsXG4gICAgICAgICAgaSxcbiAgICAgICAgICBhID0gZSA/IGUub3duZXJEb2N1bWVudCB8fCBlIDogdztyZXR1cm4gYSAhPT0gZCAmJiA5ID09PSBhLm5vZGVUeXBlICYmIGEuZG9jdW1lbnRFbGVtZW50ID8gKGQgPSBhLCBoID0gZC5kb2N1bWVudEVsZW1lbnQsIGcgPSAhbyhkKSwgdyAhPT0gZCAmJiAoaSA9IGQuZGVmYXVsdFZpZXcpICYmIGkudG9wICE9PSBpICYmIChpLmFkZEV2ZW50TGlzdGVuZXIgPyBpLmFkZEV2ZW50TGlzdGVuZXIoXCJ1bmxvYWRcIiwgcmUsICExKSA6IGkuYXR0YWNoRXZlbnQgJiYgaS5hdHRhY2hFdmVudChcIm9udW5sb2FkXCIsIHJlKSksIG4uYXR0cmlidXRlcyA9IHVlKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBlLmNsYXNzTmFtZSA9IFwiaVwiLCAhZS5nZXRBdHRyaWJ1dGUoXCJjbGFzc05hbWVcIik7XG4gICAgICB9KSwgbi5nZXRFbGVtZW50c0J5VGFnTmFtZSA9IHVlKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBlLmFwcGVuZENoaWxkKGQuY3JlYXRlQ29tbWVudChcIlwiKSksICFlLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKS5sZW5ndGg7XG4gICAgICB9KSwgbi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lID0gUS50ZXN0KGQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSksIG4uZ2V0QnlJZCA9IHVlKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBoLmFwcGVuZENoaWxkKGUpLmlkID0gYiwgIWQuZ2V0RWxlbWVudHNCeU5hbWUgfHwgIWQuZ2V0RWxlbWVudHNCeU5hbWUoYikubGVuZ3RoO1xuICAgICAgfSksIG4uZ2V0QnlJZCA/IChyLmZpbHRlci5JRCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciB0ID0gZS5yZXBsYWNlKFosIGVlKTtyZXR1cm4gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICByZXR1cm4gZS5nZXRBdHRyaWJ1dGUoXCJpZFwiKSA9PT0gdDtcbiAgICAgICAgfTtcbiAgICAgIH0sIHIuZmluZC5JRCA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIGlmIChcInVuZGVmaW5lZFwiICE9IHR5cGVvZiB0LmdldEVsZW1lbnRCeUlkICYmIGcpIHtcbiAgICAgICAgICB2YXIgbiA9IHQuZ2V0RWxlbWVudEJ5SWQoZSk7cmV0dXJuIG4gPyBbbl0gOiBbXTtcbiAgICAgICAgfVxuICAgICAgfSkgOiAoci5maWx0ZXIuSUQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdCA9IGUucmVwbGFjZShaLCBlZSk7cmV0dXJuIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgdmFyIG4gPSBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBlLmdldEF0dHJpYnV0ZU5vZGUgJiYgZS5nZXRBdHRyaWJ1dGVOb2RlKFwiaWRcIik7cmV0dXJuIG4gJiYgbi52YWx1ZSA9PT0gdDtcbiAgICAgICAgfTtcbiAgICAgIH0sIHIuZmluZC5JRCA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIGlmIChcInVuZGVmaW5lZFwiICE9IHR5cGVvZiB0LmdldEVsZW1lbnRCeUlkICYmIGcpIHtcbiAgICAgICAgICB2YXIgbixcbiAgICAgICAgICAgICAgcixcbiAgICAgICAgICAgICAgaSxcbiAgICAgICAgICAgICAgbyA9IHQuZ2V0RWxlbWVudEJ5SWQoZSk7aWYgKG8pIHtcbiAgICAgICAgICAgIGlmICgobiA9IG8uZ2V0QXR0cmlidXRlTm9kZShcImlkXCIpKSAmJiBuLnZhbHVlID09PSBlKSByZXR1cm4gW29dO2kgPSB0LmdldEVsZW1lbnRzQnlOYW1lKGUpLCByID0gMDt3aGlsZSAobyA9IGlbcisrXSkgaWYgKChuID0gby5nZXRBdHRyaWJ1dGVOb2RlKFwiaWRcIikpICYmIG4udmFsdWUgPT09IGUpIHJldHVybiBbb107XG4gICAgICAgICAgfXJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgfSksIHIuZmluZC5UQUcgPSBuLmdldEVsZW1lbnRzQnlUYWdOYW1lID8gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPyB0LmdldEVsZW1lbnRzQnlUYWdOYW1lKGUpIDogbi5xc2EgPyB0LnF1ZXJ5U2VsZWN0b3JBbGwoZSkgOiB2b2lkIDA7XG4gICAgICB9IDogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgdmFyIG4sXG4gICAgICAgICAgICByID0gW10sXG4gICAgICAgICAgICBpID0gMCxcbiAgICAgICAgICAgIG8gPSB0LmdldEVsZW1lbnRzQnlUYWdOYW1lKGUpO2lmIChcIipcIiA9PT0gZSkge1xuICAgICAgICAgIHdoaWxlIChuID0gb1tpKytdKSAxID09PSBuLm5vZGVUeXBlICYmIHIucHVzaChuKTtyZXR1cm4gcjtcbiAgICAgICAgfXJldHVybiBvO1xuICAgICAgfSwgci5maW5kLkNMQVNTID0gbi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICYmIGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIGlmIChcInVuZGVmaW5lZFwiICE9IHR5cGVvZiB0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgJiYgZykgcmV0dXJuIHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShlKTtcbiAgICAgIH0sIHYgPSBbXSwgeSA9IFtdLCAobi5xc2EgPSBRLnRlc3QoZC5xdWVyeVNlbGVjdG9yQWxsKSkgJiYgKHVlKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGguYXBwZW5kQ2hpbGQoZSkuaW5uZXJIVE1MID0gXCI8YSBpZD0nXCIgKyBiICsgXCInPjwvYT48c2VsZWN0IGlkPSdcIiArIGIgKyBcIi1cXHJcXFxcJyBtc2FsbG93Y2FwdHVyZT0nJz48b3B0aW9uIHNlbGVjdGVkPScnPjwvb3B0aW9uPjwvc2VsZWN0PlwiLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoXCJbbXNhbGxvd2NhcHR1cmVePScnXVwiKS5sZW5ndGggJiYgeS5wdXNoKFwiWypeJF09XCIgKyBNICsgXCIqKD86Jyd8XFxcIlxcXCIpXCIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoXCJbc2VsZWN0ZWRdXCIpLmxlbmd0aCB8fCB5LnB1c2goXCJcXFxcW1wiICsgTSArIFwiKig/OnZhbHVlfFwiICsgUCArIFwiKVwiKSwgZS5xdWVyeVNlbGVjdG9yQWxsKFwiW2lkfj1cIiArIGIgKyBcIi1dXCIpLmxlbmd0aCB8fCB5LnB1c2goXCJ+PVwiKSwgZS5xdWVyeVNlbGVjdG9yQWxsKFwiOmNoZWNrZWRcIikubGVuZ3RoIHx8IHkucHVzaChcIjpjaGVja2VkXCIpLCBlLnF1ZXJ5U2VsZWN0b3JBbGwoXCJhI1wiICsgYiArIFwiKypcIikubGVuZ3RoIHx8IHkucHVzaChcIi4jLitbK35dXCIpO1xuICAgICAgfSksIHVlKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUuaW5uZXJIVE1MID0gXCI8YSBocmVmPScnIGRpc2FibGVkPSdkaXNhYmxlZCc+PC9hPjxzZWxlY3QgZGlzYWJsZWQ9J2Rpc2FibGVkJz48b3B0aW9uLz48L3NlbGVjdD5cIjt2YXIgdCA9IGQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO3Quc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImhpZGRlblwiKSwgZS5hcHBlbmRDaGlsZCh0KS5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIFwiRFwiKSwgZS5xdWVyeVNlbGVjdG9yQWxsKFwiW25hbWU9ZF1cIikubGVuZ3RoICYmIHkucHVzaChcIm5hbWVcIiArIE0gKyBcIipbKl4kfCF+XT89XCIpLCAyICE9PSBlLnF1ZXJ5U2VsZWN0b3JBbGwoXCI6ZW5hYmxlZFwiKS5sZW5ndGggJiYgeS5wdXNoKFwiOmVuYWJsZWRcIiwgXCI6ZGlzYWJsZWRcIiksIGguYXBwZW5kQ2hpbGQoZSkuZGlzYWJsZWQgPSAhMCwgMiAhPT0gZS5xdWVyeVNlbGVjdG9yQWxsKFwiOmRpc2FibGVkXCIpLmxlbmd0aCAmJiB5LnB1c2goXCI6ZW5hYmxlZFwiLCBcIjpkaXNhYmxlZFwiKSwgZS5xdWVyeVNlbGVjdG9yQWxsKFwiKiw6eFwiKSwgeS5wdXNoKFwiLC4qOlwiKTtcbiAgICAgIH0pKSwgKG4ubWF0Y2hlc1NlbGVjdG9yID0gUS50ZXN0KG0gPSBoLm1hdGNoZXMgfHwgaC53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHwgaC5tb3pNYXRjaGVzU2VsZWN0b3IgfHwgaC5vTWF0Y2hlc1NlbGVjdG9yIHx8IGgubXNNYXRjaGVzU2VsZWN0b3IpKSAmJiB1ZShmdW5jdGlvbiAoZSkge1xuICAgICAgICBuLmRpc2Nvbm5lY3RlZE1hdGNoID0gbS5jYWxsKGUsIFwiKlwiKSwgbS5jYWxsKGUsIFwiW3MhPScnXTp4XCIpLCB2LnB1c2goXCIhPVwiLCBXKTtcbiAgICAgIH0pLCB5ID0geS5sZW5ndGggJiYgbmV3IFJlZ0V4cCh5LmpvaW4oXCJ8XCIpKSwgdiA9IHYubGVuZ3RoICYmIG5ldyBSZWdFeHAodi5qb2luKFwifFwiKSksIHQgPSBRLnRlc3QoaC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiksIHggPSB0IHx8IFEudGVzdChoLmNvbnRhaW5zKSA/IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIHZhciBuID0gOSA9PT0gZS5ub2RlVHlwZSA/IGUuZG9jdW1lbnRFbGVtZW50IDogZSxcbiAgICAgICAgICAgIHIgPSB0ICYmIHQucGFyZW50Tm9kZTtyZXR1cm4gZSA9PT0gciB8fCAhKCFyIHx8IDEgIT09IHIubm9kZVR5cGUgfHwgIShuLmNvbnRhaW5zID8gbi5jb250YWlucyhyKSA6IGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24gJiYgMTYgJiBlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKHIpKSk7XG4gICAgICB9IDogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgaWYgKHQpIHdoaWxlICh0ID0gdC5wYXJlbnROb2RlKSBpZiAodCA9PT0gZSkgcmV0dXJuICEwO3JldHVybiAhMTtcbiAgICAgIH0sIEQgPSB0ID8gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgaWYgKGUgPT09IHQpIHJldHVybiBmID0gITAsIDA7dmFyIHIgPSAhZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAtICF0LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uO3JldHVybiByIHx8ICgxICYgKHIgPSAoZS5vd25lckRvY3VtZW50IHx8IGUpID09PSAodC5vd25lckRvY3VtZW50IHx8IHQpID8gZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbih0KSA6IDEpIHx8ICFuLnNvcnREZXRhY2hlZCAmJiB0LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGUpID09PSByID8gZSA9PT0gZCB8fCBlLm93bmVyRG9jdW1lbnQgPT09IHcgJiYgeCh3LCBlKSA/IC0xIDogdCA9PT0gZCB8fCB0Lm93bmVyRG9jdW1lbnQgPT09IHcgJiYgeCh3LCB0KSA/IDEgOiBjID8gTyhjLCBlKSAtIE8oYywgdCkgOiAwIDogNCAmIHIgPyAtMSA6IDEpO1xuICAgICAgfSA6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIGlmIChlID09PSB0KSByZXR1cm4gZiA9ICEwLCAwO3ZhciBuLFxuICAgICAgICAgICAgciA9IDAsXG4gICAgICAgICAgICBpID0gZS5wYXJlbnROb2RlLFxuICAgICAgICAgICAgbyA9IHQucGFyZW50Tm9kZSxcbiAgICAgICAgICAgIGEgPSBbZV0sXG4gICAgICAgICAgICBzID0gW3RdO2lmICghaSB8fCAhbykgcmV0dXJuIGUgPT09IGQgPyAtMSA6IHQgPT09IGQgPyAxIDogaSA/IC0xIDogbyA/IDEgOiBjID8gTyhjLCBlKSAtIE8oYywgdCkgOiAwO2lmIChpID09PSBvKSByZXR1cm4gY2UoZSwgdCk7biA9IGU7d2hpbGUgKG4gPSBuLnBhcmVudE5vZGUpIGEudW5zaGlmdChuKTtuID0gdDt3aGlsZSAobiA9IG4ucGFyZW50Tm9kZSkgcy51bnNoaWZ0KG4pO3doaWxlIChhW3JdID09PSBzW3JdKSByKys7cmV0dXJuIHIgPyBjZShhW3JdLCBzW3JdKSA6IGFbcl0gPT09IHcgPyAtMSA6IHNbcl0gPT09IHcgPyAxIDogMDtcbiAgICAgIH0sIGQpIDogZDtcbiAgICB9LCBvZS5tYXRjaGVzID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIHJldHVybiBvZShlLCBudWxsLCBudWxsLCB0KTtcbiAgICB9LCBvZS5tYXRjaGVzU2VsZWN0b3IgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgaWYgKChlLm93bmVyRG9jdW1lbnQgfHwgZSkgIT09IGQgJiYgcChlKSwgdCA9IHQucmVwbGFjZSh6LCBcIj0nJDEnXVwiKSwgbi5tYXRjaGVzU2VsZWN0b3IgJiYgZyAmJiAhU1t0ICsgXCIgXCJdICYmICghdiB8fCAhdi50ZXN0KHQpKSAmJiAoIXkgfHwgIXkudGVzdCh0KSkpIHRyeSB7XG4gICAgICAgIHZhciByID0gbS5jYWxsKGUsIHQpO2lmIChyIHx8IG4uZGlzY29ubmVjdGVkTWF0Y2ggfHwgZS5kb2N1bWVudCAmJiAxMSAhPT0gZS5kb2N1bWVudC5ub2RlVHlwZSkgcmV0dXJuIHI7XG4gICAgICB9IGNhdGNoIChlKSB7fXJldHVybiBvZSh0LCBkLCBudWxsLCBbZV0pLmxlbmd0aCA+IDA7XG4gICAgfSwgb2UuY29udGFpbnMgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgcmV0dXJuIChlLm93bmVyRG9jdW1lbnQgfHwgZSkgIT09IGQgJiYgcChlKSwgeChlLCB0KTtcbiAgICB9LCBvZS5hdHRyID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIChlLm93bmVyRG9jdW1lbnQgfHwgZSkgIT09IGQgJiYgcChlKTt2YXIgaSA9IHIuYXR0ckhhbmRsZVt0LnRvTG93ZXJDYXNlKCldLFxuICAgICAgICAgIG8gPSBpICYmIE4uY2FsbChyLmF0dHJIYW5kbGUsIHQudG9Mb3dlckNhc2UoKSkgPyBpKGUsIHQsICFnKSA6IHZvaWQgMDtyZXR1cm4gdm9pZCAwICE9PSBvID8gbyA6IG4uYXR0cmlidXRlcyB8fCAhZyA/IGUuZ2V0QXR0cmlidXRlKHQpIDogKG8gPSBlLmdldEF0dHJpYnV0ZU5vZGUodCkpICYmIG8uc3BlY2lmaWVkID8gby52YWx1ZSA6IG51bGw7XG4gICAgfSwgb2UuZXNjYXBlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiAoZSArIFwiXCIpLnJlcGxhY2UodGUsIG5lKTtcbiAgICB9LCBvZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiBcIiArIGUpO1xuICAgIH0sIG9lLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHQsXG4gICAgICAgICAgciA9IFtdLFxuICAgICAgICAgIGkgPSAwLFxuICAgICAgICAgIG8gPSAwO2lmIChmID0gIW4uZGV0ZWN0RHVwbGljYXRlcywgYyA9ICFuLnNvcnRTdGFibGUgJiYgZS5zbGljZSgwKSwgZS5zb3J0KEQpLCBmKSB7XG4gICAgICAgIHdoaWxlICh0ID0gZVtvKytdKSB0ID09PSBlW29dICYmIChpID0gci5wdXNoKG8pKTt3aGlsZSAoaS0tKSBlLnNwbGljZShyW2ldLCAxKTtcbiAgICAgIH1yZXR1cm4gYyA9IG51bGwsIGU7XG4gICAgfSwgaSA9IG9lLmdldFRleHQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHQsXG4gICAgICAgICAgbiA9IFwiXCIsXG4gICAgICAgICAgciA9IDAsXG4gICAgICAgICAgbyA9IGUubm9kZVR5cGU7aWYgKG8pIHtcbiAgICAgICAgaWYgKDEgPT09IG8gfHwgOSA9PT0gbyB8fCAxMSA9PT0gbykge1xuICAgICAgICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBlLnRleHRDb250ZW50KSByZXR1cm4gZS50ZXh0Q29udGVudDtmb3IgKGUgPSBlLmZpcnN0Q2hpbGQ7IGU7IGUgPSBlLm5leHRTaWJsaW5nKSBuICs9IGkoZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoMyA9PT0gbyB8fCA0ID09PSBvKSByZXR1cm4gZS5ub2RlVmFsdWU7XG4gICAgICB9IGVsc2Ugd2hpbGUgKHQgPSBlW3IrK10pIG4gKz0gaSh0KTtyZXR1cm4gbjtcbiAgICB9LCAociA9IG9lLnNlbGVjdG9ycyA9IHsgY2FjaGVMZW5ndGg6IDUwLCBjcmVhdGVQc2V1ZG86IHNlLCBtYXRjaDogViwgYXR0ckhhbmRsZToge30sIGZpbmQ6IHt9LCByZWxhdGl2ZTogeyBcIj5cIjogeyBkaXI6IFwicGFyZW50Tm9kZVwiLCBmaXJzdDogITAgfSwgXCIgXCI6IHsgZGlyOiBcInBhcmVudE5vZGVcIiB9LCBcIitcIjogeyBkaXI6IFwicHJldmlvdXNTaWJsaW5nXCIsIGZpcnN0OiAhMCB9LCBcIn5cIjogeyBkaXI6IFwicHJldmlvdXNTaWJsaW5nXCIgfSB9LCBwcmVGaWx0ZXI6IHsgQVRUUjogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICByZXR1cm4gZVsxXSA9IGVbMV0ucmVwbGFjZShaLCBlZSksIGVbM10gPSAoZVszXSB8fCBlWzRdIHx8IGVbNV0gfHwgXCJcIikucmVwbGFjZShaLCBlZSksIFwifj1cIiA9PT0gZVsyXSAmJiAoZVszXSA9IFwiIFwiICsgZVszXSArIFwiIFwiKSwgZS5zbGljZSgwLCA0KTtcbiAgICAgICAgfSwgQ0hJTEQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgcmV0dXJuIGVbMV0gPSBlWzFdLnRvTG93ZXJDYXNlKCksIFwibnRoXCIgPT09IGVbMV0uc2xpY2UoMCwgMykgPyAoZVszXSB8fCBvZS5lcnJvcihlWzBdKSwgZVs0XSA9ICsoZVs0XSA/IGVbNV0gKyAoZVs2XSB8fCAxKSA6IDIgKiAoXCJldmVuXCIgPT09IGVbM10gfHwgXCJvZGRcIiA9PT0gZVszXSkpLCBlWzVdID0gKyhlWzddICsgZVs4XSB8fCBcIm9kZFwiID09PSBlWzNdKSkgOiBlWzNdICYmIG9lLmVycm9yKGVbMF0pLCBlO1xuICAgICAgICB9LCBQU0VVRE86IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgdmFyIHQsXG4gICAgICAgICAgICAgIG4gPSAhZVs2XSAmJiBlWzJdO3JldHVybiBWLkNISUxELnRlc3QoZVswXSkgPyBudWxsIDogKGVbM10gPyBlWzJdID0gZVs0XSB8fCBlWzVdIHx8IFwiXCIgOiBuICYmIFgudGVzdChuKSAmJiAodCA9IGEobiwgITApKSAmJiAodCA9IG4uaW5kZXhPZihcIilcIiwgbi5sZW5ndGggLSB0KSAtIG4ubGVuZ3RoKSAmJiAoZVswXSA9IGVbMF0uc2xpY2UoMCwgdCksIGVbMl0gPSBuLnNsaWNlKDAsIHQpKSwgZS5zbGljZSgwLCAzKSk7XG4gICAgICAgIH0gfSwgZmlsdGVyOiB7IFRBRzogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICB2YXIgdCA9IGUucmVwbGFjZShaLCBlZSkudG9Mb3dlckNhc2UoKTtyZXR1cm4gXCIqXCIgPT09IGUgPyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gITA7XG4gICAgICAgICAgfSA6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZS5ub2RlTmFtZSAmJiBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHQ7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSwgQ0xBU1M6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgdmFyIHQgPSBFW2UgKyBcIiBcIl07cmV0dXJuIHQgfHwgKHQgPSBuZXcgUmVnRXhwKFwiKF58XCIgKyBNICsgXCIpXCIgKyBlICsgXCIoXCIgKyBNICsgXCJ8JClcIikpICYmIEUoZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0LnRlc3QoXCJzdHJpbmdcIiA9PSB0eXBlb2YgZS5jbGFzc05hbWUgJiYgZS5jbGFzc05hbWUgfHwgXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgZS5nZXRBdHRyaWJ1dGUgJiYgZS5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKSB8fCBcIlwiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSwgQVRUUjogZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgIHZhciBpID0gb2UuYXR0cihyLCBlKTtyZXR1cm4gbnVsbCA9PSBpID8gXCIhPVwiID09PSB0IDogIXQgfHwgKGkgKz0gXCJcIiwgXCI9XCIgPT09IHQgPyBpID09PSBuIDogXCIhPVwiID09PSB0ID8gaSAhPT0gbiA6IFwiXj1cIiA9PT0gdCA/IG4gJiYgMCA9PT0gaS5pbmRleE9mKG4pIDogXCIqPVwiID09PSB0ID8gbiAmJiBpLmluZGV4T2YobikgPiAtMSA6IFwiJD1cIiA9PT0gdCA/IG4gJiYgaS5zbGljZSgtbi5sZW5ndGgpID09PSBuIDogXCJ+PVwiID09PSB0ID8gKFwiIFwiICsgaS5yZXBsYWNlKCQsIFwiIFwiKSArIFwiIFwiKS5pbmRleE9mKG4pID4gLTEgOiBcInw9XCIgPT09IHQgJiYgKGkgPT09IG4gfHwgaS5zbGljZSgwLCBuLmxlbmd0aCArIDEpID09PSBuICsgXCItXCIpKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9LCBDSElMRDogZnVuY3Rpb24gKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgICB2YXIgbyA9IFwibnRoXCIgIT09IGUuc2xpY2UoMCwgMyksXG4gICAgICAgICAgICAgIGEgPSBcImxhc3RcIiAhPT0gZS5zbGljZSgtNCksXG4gICAgICAgICAgICAgIHMgPSBcIm9mLXR5cGVcIiA9PT0gdDtyZXR1cm4gMSA9PT0gciAmJiAwID09PSBpID8gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJldHVybiAhIWUucGFyZW50Tm9kZTtcbiAgICAgICAgICB9IDogZnVuY3Rpb24gKHQsIG4sIHUpIHtcbiAgICAgICAgICAgIHZhciBsLFxuICAgICAgICAgICAgICAgIGMsXG4gICAgICAgICAgICAgICAgZixcbiAgICAgICAgICAgICAgICBwLFxuICAgICAgICAgICAgICAgIGQsXG4gICAgICAgICAgICAgICAgaCxcbiAgICAgICAgICAgICAgICBnID0gbyAhPT0gYSA/IFwibmV4dFNpYmxpbmdcIiA6IFwicHJldmlvdXNTaWJsaW5nXCIsXG4gICAgICAgICAgICAgICAgeSA9IHQucGFyZW50Tm9kZSxcbiAgICAgICAgICAgICAgICB2ID0gcyAmJiB0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgbSA9ICF1ICYmICFzLFxuICAgICAgICAgICAgICAgIHggPSAhMTtpZiAoeSkge1xuICAgICAgICAgICAgICBpZiAobykge1xuICAgICAgICAgICAgICAgIHdoaWxlIChnKSB7XG4gICAgICAgICAgICAgICAgICBwID0gdDt3aGlsZSAocCA9IHBbZ10pIGlmIChzID8gcC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSB2IDogMSA9PT0gcC5ub2RlVHlwZSkgcmV0dXJuICExO2ggPSBnID0gXCJvbmx5XCIgPT09IGUgJiYgIWggJiYgXCJuZXh0U2libGluZ1wiO1xuICAgICAgICAgICAgICAgIH1yZXR1cm4gITA7XG4gICAgICAgICAgICAgIH1pZiAoaCA9IFthID8geS5maXJzdENoaWxkIDogeS5sYXN0Q2hpbGRdLCBhICYmIG0pIHtcbiAgICAgICAgICAgICAgICB4ID0gKGQgPSAobCA9IChjID0gKGYgPSAocCA9IHkpW2JdIHx8IChwW2JdID0ge30pKVtwLnVuaXF1ZUlEXSB8fCAoZltwLnVuaXF1ZUlEXSA9IHt9KSlbZV0gfHwgW10pWzBdID09PSBUICYmIGxbMV0pICYmIGxbMl0sIHAgPSBkICYmIHkuY2hpbGROb2Rlc1tkXTt3aGlsZSAocCA9ICsrZCAmJiBwICYmIHBbZ10gfHwgKHggPSBkID0gMCkgfHwgaC5wb3AoKSkgaWYgKDEgPT09IHAubm9kZVR5cGUgJiYgKyt4ICYmIHAgPT09IHQpIHtcbiAgICAgICAgICAgICAgICAgIGNbZV0gPSBbVCwgZCwgeF07YnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKG0gJiYgKHggPSBkID0gKGwgPSAoYyA9IChmID0gKHAgPSB0KVtiXSB8fCAocFtiXSA9IHt9KSlbcC51bmlxdWVJRF0gfHwgKGZbcC51bmlxdWVJRF0gPSB7fSkpW2VdIHx8IFtdKVswXSA9PT0gVCAmJiBsWzFdKSwgITEgPT09IHgpIHdoaWxlIChwID0gKytkICYmIHAgJiYgcFtnXSB8fCAoeCA9IGQgPSAwKSB8fCBoLnBvcCgpKSBpZiAoKHMgPyBwLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHYgOiAxID09PSBwLm5vZGVUeXBlKSAmJiArK3ggJiYgKG0gJiYgKChjID0gKGYgPSBwW2JdIHx8IChwW2JdID0ge30pKVtwLnVuaXF1ZUlEXSB8fCAoZltwLnVuaXF1ZUlEXSA9IHt9KSlbZV0gPSBbVCwgeF0pLCBwID09PSB0KSkgYnJlYWs7cmV0dXJuICh4IC09IGkpID09PSByIHx8IHggJSByID09IDAgJiYgeCAvIHIgPj0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9LCBQU0VVRE86IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgICAgdmFyIG4sXG4gICAgICAgICAgICAgIGkgPSByLnBzZXVkb3NbZV0gfHwgci5zZXRGaWx0ZXJzW2UudG9Mb3dlckNhc2UoKV0gfHwgb2UuZXJyb3IoXCJ1bnN1cHBvcnRlZCBwc2V1ZG86IFwiICsgZSk7cmV0dXJuIGlbYl0gPyBpKHQpIDogaS5sZW5ndGggPiAxID8gKG4gPSBbZSwgZSwgXCJcIiwgdF0sIHIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eShlLnRvTG93ZXJDYXNlKCkpID8gc2UoZnVuY3Rpb24gKGUsIG4pIHtcbiAgICAgICAgICAgIHZhciByLFxuICAgICAgICAgICAgICAgIG8gPSBpKGUsIHQpLFxuICAgICAgICAgICAgICAgIGEgPSBvLmxlbmd0aDt3aGlsZSAoYS0tKSBlW3IgPSBPKGUsIG9bYV0pXSA9ICEobltyXSA9IG9bYV0pO1xuICAgICAgICAgIH0pIDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBpKGUsIDAsIG4pO1xuICAgICAgICAgIH0pIDogaTtcbiAgICAgICAgfSB9LCBwc2V1ZG9zOiB7IG5vdDogc2UoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICB2YXIgdCA9IFtdLFxuICAgICAgICAgICAgICBuID0gW10sXG4gICAgICAgICAgICAgIHIgPSBzKGUucmVwbGFjZShCLCBcIiQxXCIpKTtyZXR1cm4gcltiXSA/IHNlKGZ1bmN0aW9uIChlLCB0LCBuLCBpKSB7XG4gICAgICAgICAgICB2YXIgbyxcbiAgICAgICAgICAgICAgICBhID0gcihlLCBudWxsLCBpLCBbXSksXG4gICAgICAgICAgICAgICAgcyA9IGUubGVuZ3RoO3doaWxlIChzLS0pIChvID0gYVtzXSkgJiYgKGVbc10gPSAhKHRbc10gPSBvKSk7XG4gICAgICAgICAgfSkgOiBmdW5jdGlvbiAoZSwgaSwgbykge1xuICAgICAgICAgICAgcmV0dXJuIHRbMF0gPSBlLCByKHQsIG51bGwsIG8sIG4pLCB0WzBdID0gbnVsbCwgIW4ucG9wKCk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSksIGhhczogc2UoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiBvZShlLCB0KS5sZW5ndGggPiAwO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pLCBjb250YWluczogc2UoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICByZXR1cm4gZSA9IGUucmVwbGFjZShaLCBlZSksIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gKHQudGV4dENvbnRlbnQgfHwgdC5pbm5lclRleHQgfHwgaSh0KSkuaW5kZXhPZihlKSA+IC0xO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pLCBsYW5nOiBzZShmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHJldHVybiBVLnRlc3QoZSB8fCBcIlwiKSB8fCBvZS5lcnJvcihcInVuc3VwcG9ydGVkIGxhbmc6IFwiICsgZSksIGUgPSBlLnJlcGxhY2UoWiwgZWUpLnRvTG93ZXJDYXNlKCksIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICB2YXIgbjtkbyB7XG4gICAgICAgICAgICAgIGlmIChuID0gZyA/IHQubGFuZyA6IHQuZ2V0QXR0cmlidXRlKFwieG1sOmxhbmdcIikgfHwgdC5nZXRBdHRyaWJ1dGUoXCJsYW5nXCIpKSByZXR1cm4gKG4gPSBuLnRvTG93ZXJDYXNlKCkpID09PSBlIHx8IDAgPT09IG4uaW5kZXhPZihlICsgXCItXCIpO1xuICAgICAgICAgICAgfSB3aGlsZSAoKHQgPSB0LnBhcmVudE5vZGUpICYmIDEgPT09IHQubm9kZVR5cGUpO3JldHVybiAhMTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KSwgdGFyZ2V0OiBmdW5jdGlvbiAodCkge1xuICAgICAgICAgIHZhciBuID0gZS5sb2NhdGlvbiAmJiBlLmxvY2F0aW9uLmhhc2g7cmV0dXJuIG4gJiYgbi5zbGljZSgxKSA9PT0gdC5pZDtcbiAgICAgICAgfSwgcm9vdDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICByZXR1cm4gZSA9PT0gaDtcbiAgICAgICAgfSwgZm9jdXM6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgcmV0dXJuIGUgPT09IGQuYWN0aXZlRWxlbWVudCAmJiAoIWQuaGFzRm9jdXMgfHwgZC5oYXNGb2N1cygpKSAmJiAhIShlLnR5cGUgfHwgZS5ocmVmIHx8IH5lLnRhYkluZGV4KTtcbiAgICAgICAgfSwgZW5hYmxlZDogZGUoITEpLCBkaXNhYmxlZDogZGUoITApLCBjaGVja2VkOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHZhciB0ID0gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiBcImlucHV0XCIgPT09IHQgJiYgISFlLmNoZWNrZWQgfHwgXCJvcHRpb25cIiA9PT0gdCAmJiAhIWUuc2VsZWN0ZWQ7XG4gICAgICAgIH0sIHNlbGVjdGVkOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHJldHVybiBlLnBhcmVudE5vZGUgJiYgZS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgsICEwID09PSBlLnNlbGVjdGVkO1xuICAgICAgICB9LCBlbXB0eTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBmb3IgKGUgPSBlLmZpcnN0Q2hpbGQ7IGU7IGUgPSBlLm5leHRTaWJsaW5nKSBpZiAoZS5ub2RlVHlwZSA8IDYpIHJldHVybiAhMTtyZXR1cm4gITA7XG4gICAgICAgIH0sIHBhcmVudDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICByZXR1cm4gIXIucHNldWRvcy5lbXB0eShlKTtcbiAgICAgICAgfSwgaGVhZGVyOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHJldHVybiBZLnRlc3QoZS5ub2RlTmFtZSk7XG4gICAgICAgIH0sIGlucHV0OiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHJldHVybiBHLnRlc3QoZS5ub2RlTmFtZSk7XG4gICAgICAgIH0sIGJ1dHRvbjogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICB2YXIgdCA9IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4gXCJpbnB1dFwiID09PSB0ICYmIFwiYnV0dG9uXCIgPT09IGUudHlwZSB8fCBcImJ1dHRvblwiID09PSB0O1xuICAgICAgICB9LCB0ZXh0OiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHZhciB0O3JldHVybiBcImlucHV0XCIgPT09IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAmJiBcInRleHRcIiA9PT0gZS50eXBlICYmIChudWxsID09ICh0ID0gZS5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpKSB8fCBcInRleHRcIiA9PT0gdC50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgfSwgZmlyc3Q6IGhlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gWzBdO1xuICAgICAgICB9KSwgbGFzdDogaGUoZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgICByZXR1cm4gW3QgLSAxXTtcbiAgICAgICAgfSksIGVxOiBoZShmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgICAgIHJldHVybiBbbiA8IDAgPyBuICsgdCA6IG5dO1xuICAgICAgICB9KSwgZXZlbjogaGUoZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IHQ7IG4gKz0gMikgZS5wdXNoKG4pO3JldHVybiBlO1xuICAgICAgICB9KSwgb2RkOiBoZShmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICAgIGZvciAodmFyIG4gPSAxOyBuIDwgdDsgbiArPSAyKSBlLnB1c2gobik7cmV0dXJuIGU7XG4gICAgICAgIH0pLCBsdDogaGUoZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICAgICAgICBmb3IgKHZhciByID0gbiA8IDAgPyBuICsgdCA6IG47IC0tciA+PSAwOykgZS5wdXNoKHIpO3JldHVybiBlO1xuICAgICAgICB9KSwgZ3Q6IGhlKGZ1bmN0aW9uIChlLCB0LCBuKSB7XG4gICAgICAgICAgZm9yICh2YXIgciA9IG4gPCAwID8gbiArIHQgOiBuOyArK3IgPCB0OykgZS5wdXNoKHIpO3JldHVybiBlO1xuICAgICAgICB9KSB9IH0pLnBzZXVkb3MubnRoID0gci5wc2V1ZG9zLmVxO2ZvciAodCBpbiB7IHJhZGlvOiAhMCwgY2hlY2tib3g6ICEwLCBmaWxlOiAhMCwgcGFzc3dvcmQ6ICEwLCBpbWFnZTogITAgfSkgci5wc2V1ZG9zW3RdID0gZmUodCk7Zm9yICh0IGluIHsgc3VibWl0OiAhMCwgcmVzZXQ6ICEwIH0pIHIucHNldWRvc1t0XSA9IHBlKHQpO2Z1bmN0aW9uIHllKCkge315ZS5wcm90b3R5cGUgPSByLmZpbHRlcnMgPSByLnBzZXVkb3MsIHIuc2V0RmlsdGVycyA9IG5ldyB5ZSgpLCBhID0gb2UudG9rZW5pemUgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgdmFyIG4sXG4gICAgICAgICAgaSxcbiAgICAgICAgICBvLFxuICAgICAgICAgIGEsXG4gICAgICAgICAgcyxcbiAgICAgICAgICB1LFxuICAgICAgICAgIGwsXG4gICAgICAgICAgYyA9IGtbZSArIFwiIFwiXTtpZiAoYykgcmV0dXJuIHQgPyAwIDogYy5zbGljZSgwKTtzID0gZSwgdSA9IFtdLCBsID0gci5wcmVGaWx0ZXI7d2hpbGUgKHMpIHtcbiAgICAgICAgbiAmJiAhKGkgPSBGLmV4ZWMocykpIHx8IChpICYmIChzID0gcy5zbGljZShpWzBdLmxlbmd0aCkgfHwgcyksIHUucHVzaChvID0gW10pKSwgbiA9ICExLCAoaSA9IF8uZXhlYyhzKSkgJiYgKG4gPSBpLnNoaWZ0KCksIG8ucHVzaCh7IHZhbHVlOiBuLCB0eXBlOiBpWzBdLnJlcGxhY2UoQiwgXCIgXCIpIH0pLCBzID0gcy5zbGljZShuLmxlbmd0aCkpO2ZvciAoYSBpbiByLmZpbHRlcikgIShpID0gVlthXS5leGVjKHMpKSB8fCBsW2FdICYmICEoaSA9IGxbYV0oaSkpIHx8IChuID0gaS5zaGlmdCgpLCBvLnB1c2goeyB2YWx1ZTogbiwgdHlwZTogYSwgbWF0Y2hlczogaSB9KSwgcyA9IHMuc2xpY2Uobi5sZW5ndGgpKTtpZiAoIW4pIGJyZWFrO1xuICAgICAgfXJldHVybiB0ID8gcy5sZW5ndGggOiBzID8gb2UuZXJyb3IoZSkgOiBrKGUsIHUpLnNsaWNlKDApO1xuICAgIH07ZnVuY3Rpb24gdmUoZSkge1xuICAgICAgZm9yICh2YXIgdCA9IDAsIG4gPSBlLmxlbmd0aCwgciA9IFwiXCI7IHQgPCBuOyB0KyspIHIgKz0gZVt0XS52YWx1ZTtyZXR1cm4gcjtcbiAgICB9ZnVuY3Rpb24gbWUoZSwgdCwgbikge1xuICAgICAgdmFyIHIgPSB0LmRpcixcbiAgICAgICAgICBpID0gdC5uZXh0LFxuICAgICAgICAgIG8gPSBpIHx8IHIsXG4gICAgICAgICAgYSA9IG4gJiYgXCJwYXJlbnROb2RlXCIgPT09IG8sXG4gICAgICAgICAgcyA9IEMrKztyZXR1cm4gdC5maXJzdCA/IGZ1bmN0aW9uICh0LCBuLCBpKSB7XG4gICAgICAgIHdoaWxlICh0ID0gdFtyXSkgaWYgKDEgPT09IHQubm9kZVR5cGUgfHwgYSkgcmV0dXJuIGUodCwgbiwgaSk7cmV0dXJuICExO1xuICAgICAgfSA6IGZ1bmN0aW9uICh0LCBuLCB1KSB7XG4gICAgICAgIHZhciBsLFxuICAgICAgICAgICAgYyxcbiAgICAgICAgICAgIGYsXG4gICAgICAgICAgICBwID0gW1QsIHNdO2lmICh1KSB7XG4gICAgICAgICAgd2hpbGUgKHQgPSB0W3JdKSBpZiAoKDEgPT09IHQubm9kZVR5cGUgfHwgYSkgJiYgZSh0LCBuLCB1KSkgcmV0dXJuICEwO1xuICAgICAgICB9IGVsc2Ugd2hpbGUgKHQgPSB0W3JdKSBpZiAoMSA9PT0gdC5ub2RlVHlwZSB8fCBhKSBpZiAoZiA9IHRbYl0gfHwgKHRbYl0gPSB7fSksIGMgPSBmW3QudW5pcXVlSURdIHx8IChmW3QudW5pcXVlSURdID0ge30pLCBpICYmIGkgPT09IHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkgdCA9IHRbcl0gfHwgdDtlbHNlIHtcbiAgICAgICAgICBpZiAoKGwgPSBjW29dKSAmJiBsWzBdID09PSBUICYmIGxbMV0gPT09IHMpIHJldHVybiBwWzJdID0gbFsyXTtpZiAoY1tvXSA9IHAsIHBbMl0gPSBlKHQsIG4sIHUpKSByZXR1cm4gITA7XG4gICAgICAgIH1yZXR1cm4gITE7XG4gICAgICB9O1xuICAgIH1mdW5jdGlvbiB4ZShlKSB7XG4gICAgICByZXR1cm4gZS5sZW5ndGggPiAxID8gZnVuY3Rpb24gKHQsIG4sIHIpIHtcbiAgICAgICAgdmFyIGkgPSBlLmxlbmd0aDt3aGlsZSAoaS0tKSBpZiAoIWVbaV0odCwgbiwgcikpIHJldHVybiAhMTtyZXR1cm4gITA7XG4gICAgICB9IDogZVswXTtcbiAgICB9ZnVuY3Rpb24gYmUoZSwgdCwgbikge1xuICAgICAgZm9yICh2YXIgciA9IDAsIGkgPSB0Lmxlbmd0aDsgciA8IGk7IHIrKykgb2UoZSwgdFtyXSwgbik7cmV0dXJuIG47XG4gICAgfWZ1bmN0aW9uIHdlKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgIGZvciAodmFyIG8sIGEgPSBbXSwgcyA9IDAsIHUgPSBlLmxlbmd0aCwgbCA9IG51bGwgIT0gdDsgcyA8IHU7IHMrKykgKG8gPSBlW3NdKSAmJiAobiAmJiAhbihvLCByLCBpKSB8fCAoYS5wdXNoKG8pLCBsICYmIHQucHVzaChzKSkpO3JldHVybiBhO1xuICAgIH1mdW5jdGlvbiBUZShlLCB0LCBuLCByLCBpLCBvKSB7XG4gICAgICByZXR1cm4gciAmJiAhcltiXSAmJiAociA9IFRlKHIpKSwgaSAmJiAhaVtiXSAmJiAoaSA9IFRlKGksIG8pKSwgc2UoZnVuY3Rpb24gKG8sIGEsIHMsIHUpIHtcbiAgICAgICAgdmFyIGwsXG4gICAgICAgICAgICBjLFxuICAgICAgICAgICAgZixcbiAgICAgICAgICAgIHAgPSBbXSxcbiAgICAgICAgICAgIGQgPSBbXSxcbiAgICAgICAgICAgIGggPSBhLmxlbmd0aCxcbiAgICAgICAgICAgIGcgPSBvIHx8IGJlKHQgfHwgXCIqXCIsIHMubm9kZVR5cGUgPyBbc10gOiBzLCBbXSksXG4gICAgICAgICAgICB5ID0gIWUgfHwgIW8gJiYgdCA/IGcgOiB3ZShnLCBwLCBlLCBzLCB1KSxcbiAgICAgICAgICAgIHYgPSBuID8gaSB8fCAobyA/IGUgOiBoIHx8IHIpID8gW10gOiBhIDogeTtpZiAobiAmJiBuKHksIHYsIHMsIHUpLCByKSB7XG4gICAgICAgICAgbCA9IHdlKHYsIGQpLCByKGwsIFtdLCBzLCB1KSwgYyA9IGwubGVuZ3RoO3doaWxlIChjLS0pIChmID0gbFtjXSkgJiYgKHZbZFtjXV0gPSAhKHlbZFtjXV0gPSBmKSk7XG4gICAgICAgIH1pZiAobykge1xuICAgICAgICAgIGlmIChpIHx8IGUpIHtcbiAgICAgICAgICAgIGlmIChpKSB7XG4gICAgICAgICAgICAgIGwgPSBbXSwgYyA9IHYubGVuZ3RoO3doaWxlIChjLS0pIChmID0gdltjXSkgJiYgbC5wdXNoKHlbY10gPSBmKTtpKG51bGwsIHYgPSBbXSwgbCwgdSk7XG4gICAgICAgICAgICB9YyA9IHYubGVuZ3RoO3doaWxlIChjLS0pIChmID0gdltjXSkgJiYgKGwgPSBpID8gTyhvLCBmKSA6IHBbY10pID4gLTEgJiYgKG9bbF0gPSAhKGFbbF0gPSBmKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgdiA9IHdlKHYgPT09IGEgPyB2LnNwbGljZShoLCB2Lmxlbmd0aCkgOiB2KSwgaSA/IGkobnVsbCwgYSwgdiwgdSkgOiBMLmFwcGx5KGEsIHYpO1xuICAgICAgfSk7XG4gICAgfWZ1bmN0aW9uIENlKGUpIHtcbiAgICAgIGZvciAodmFyIHQsIG4sIGksIG8gPSBlLmxlbmd0aCwgYSA9IHIucmVsYXRpdmVbZVswXS50eXBlXSwgcyA9IGEgfHwgci5yZWxhdGl2ZVtcIiBcIl0sIHUgPSBhID8gMSA6IDAsIGMgPSBtZShmdW5jdGlvbiAoZSkge1xuICAgICAgICByZXR1cm4gZSA9PT0gdDtcbiAgICAgIH0sIHMsICEwKSwgZiA9IG1lKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBPKHQsIGUpID4gLTE7XG4gICAgICB9LCBzLCAhMCksIHAgPSBbZnVuY3Rpb24gKGUsIG4sIHIpIHtcbiAgICAgICAgdmFyIGkgPSAhYSAmJiAociB8fCBuICE9PSBsKSB8fCAoKHQgPSBuKS5ub2RlVHlwZSA/IGMoZSwgbiwgcikgOiBmKGUsIG4sIHIpKTtyZXR1cm4gdCA9IG51bGwsIGk7XG4gICAgICB9XTsgdSA8IG87IHUrKykgaWYgKG4gPSByLnJlbGF0aXZlW2VbdV0udHlwZV0pIHAgPSBbbWUoeGUocCksIG4pXTtlbHNlIHtcbiAgICAgICAgaWYgKChuID0gci5maWx0ZXJbZVt1XS50eXBlXS5hcHBseShudWxsLCBlW3VdLm1hdGNoZXMpKVtiXSkge1xuICAgICAgICAgIGZvciAoaSA9ICsrdTsgaSA8IG87IGkrKykgaWYgKHIucmVsYXRpdmVbZVtpXS50eXBlXSkgYnJlYWs7cmV0dXJuIFRlKHUgPiAxICYmIHhlKHApLCB1ID4gMSAmJiB2ZShlLnNsaWNlKDAsIHUgLSAxKS5jb25jYXQoeyB2YWx1ZTogXCIgXCIgPT09IGVbdSAtIDJdLnR5cGUgPyBcIipcIiA6IFwiXCIgfSkpLnJlcGxhY2UoQiwgXCIkMVwiKSwgbiwgdSA8IGkgJiYgQ2UoZS5zbGljZSh1LCBpKSksIGkgPCBvICYmIENlKGUgPSBlLnNsaWNlKGkpKSwgaSA8IG8gJiYgdmUoZSkpO1xuICAgICAgICB9cC5wdXNoKG4pO1xuICAgICAgfXJldHVybiB4ZShwKTtcbiAgICB9ZnVuY3Rpb24gRWUoZSwgdCkge1xuICAgICAgdmFyIG4gPSB0Lmxlbmd0aCA+IDAsXG4gICAgICAgICAgaSA9IGUubGVuZ3RoID4gMCxcbiAgICAgICAgICBvID0gZnVuY3Rpb24gKG8sIGEsIHMsIHUsIGMpIHtcbiAgICAgICAgdmFyIGYsXG4gICAgICAgICAgICBoLFxuICAgICAgICAgICAgeSxcbiAgICAgICAgICAgIHYgPSAwLFxuICAgICAgICAgICAgbSA9IFwiMFwiLFxuICAgICAgICAgICAgeCA9IG8gJiYgW10sXG4gICAgICAgICAgICBiID0gW10sXG4gICAgICAgICAgICB3ID0gbCxcbiAgICAgICAgICAgIEMgPSBvIHx8IGkgJiYgci5maW5kLlRBRyhcIipcIiwgYyksXG4gICAgICAgICAgICBFID0gVCArPSBudWxsID09IHcgPyAxIDogTWF0aC5yYW5kb20oKSB8fCAuMSxcbiAgICAgICAgICAgIGsgPSBDLmxlbmd0aDtmb3IgKGMgJiYgKGwgPSBhID09PSBkIHx8IGEgfHwgYyk7IG0gIT09IGsgJiYgbnVsbCAhPSAoZiA9IENbbV0pOyBtKyspIHtcbiAgICAgICAgICBpZiAoaSAmJiBmKSB7XG4gICAgICAgICAgICBoID0gMCwgYSB8fCBmLm93bmVyRG9jdW1lbnQgPT09IGQgfHwgKHAoZiksIHMgPSAhZyk7d2hpbGUgKHkgPSBlW2grK10pIGlmICh5KGYsIGEgfHwgZCwgcykpIHtcbiAgICAgICAgICAgICAgdS5wdXNoKGYpO2JyZWFrO1xuICAgICAgICAgICAgfWMgJiYgKFQgPSBFKTtcbiAgICAgICAgICB9biAmJiAoKGYgPSAheSAmJiBmKSAmJiB2LS0sIG8gJiYgeC5wdXNoKGYpKTtcbiAgICAgICAgfWlmICh2ICs9IG0sIG4gJiYgbSAhPT0gdikge1xuICAgICAgICAgIGggPSAwO3doaWxlICh5ID0gdFtoKytdKSB5KHgsIGIsIGEsIHMpO2lmIChvKSB7XG4gICAgICAgICAgICBpZiAodiA+IDApIHdoaWxlIChtLS0pIHhbbV0gfHwgYlttXSB8fCAoYlttXSA9IGouY2FsbCh1KSk7YiA9IHdlKGIpO1xuICAgICAgICAgIH1MLmFwcGx5KHUsIGIpLCBjICYmICFvICYmIGIubGVuZ3RoID4gMCAmJiB2ICsgdC5sZW5ndGggPiAxICYmIG9lLnVuaXF1ZVNvcnQodSk7XG4gICAgICAgIH1yZXR1cm4gYyAmJiAoVCA9IEUsIGwgPSB3KSwgeDtcbiAgICAgIH07cmV0dXJuIG4gPyBzZShvKSA6IG87XG4gICAgfXJldHVybiBzID0gb2UuY29tcGlsZSA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICB2YXIgbixcbiAgICAgICAgICByID0gW10sXG4gICAgICAgICAgaSA9IFtdLFxuICAgICAgICAgIG8gPSBTW2UgKyBcIiBcIl07aWYgKCFvKSB7XG4gICAgICAgIHQgfHwgKHQgPSBhKGUpKSwgbiA9IHQubGVuZ3RoO3doaWxlIChuLS0pIChvID0gQ2UodFtuXSkpW2JdID8gci5wdXNoKG8pIDogaS5wdXNoKG8pOyhvID0gUyhlLCBFZShpLCByKSkpLnNlbGVjdG9yID0gZTtcbiAgICAgIH1yZXR1cm4gbztcbiAgICB9LCB1ID0gb2Uuc2VsZWN0ID0gZnVuY3Rpb24gKGUsIHQsIG4sIGkpIHtcbiAgICAgIHZhciBvLFxuICAgICAgICAgIHUsXG4gICAgICAgICAgbCxcbiAgICAgICAgICBjLFxuICAgICAgICAgIGYsXG4gICAgICAgICAgcCA9IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZSAmJiBlLFxuICAgICAgICAgIGQgPSAhaSAmJiBhKGUgPSBwLnNlbGVjdG9yIHx8IGUpO2lmIChuID0gbiB8fCBbXSwgMSA9PT0gZC5sZW5ndGgpIHtcbiAgICAgICAgaWYgKCh1ID0gZFswXSA9IGRbMF0uc2xpY2UoMCkpLmxlbmd0aCA+IDIgJiYgXCJJRFwiID09PSAobCA9IHVbMF0pLnR5cGUgJiYgOSA9PT0gdC5ub2RlVHlwZSAmJiBnICYmIHIucmVsYXRpdmVbdVsxXS50eXBlXSkge1xuICAgICAgICAgIGlmICghKHQgPSAoci5maW5kLklEKGwubWF0Y2hlc1swXS5yZXBsYWNlKFosIGVlKSwgdCkgfHwgW10pWzBdKSkgcmV0dXJuIG47cCAmJiAodCA9IHQucGFyZW50Tm9kZSksIGUgPSBlLnNsaWNlKHUuc2hpZnQoKS52YWx1ZS5sZW5ndGgpO1xuICAgICAgICB9byA9IFYubmVlZHNDb250ZXh0LnRlc3QoZSkgPyAwIDogdS5sZW5ndGg7d2hpbGUgKG8tLSkge1xuICAgICAgICAgIGlmIChsID0gdVtvXSwgci5yZWxhdGl2ZVtjID0gbC50eXBlXSkgYnJlYWs7aWYgKChmID0gci5maW5kW2NdKSAmJiAoaSA9IGYobC5tYXRjaGVzWzBdLnJlcGxhY2UoWiwgZWUpLCBLLnRlc3QodVswXS50eXBlKSAmJiBnZSh0LnBhcmVudE5vZGUpIHx8IHQpKSkge1xuICAgICAgICAgICAgaWYgKHUuc3BsaWNlKG8sIDEpLCAhKGUgPSBpLmxlbmd0aCAmJiB2ZSh1KSkpIHJldHVybiBMLmFwcGx5KG4sIGkpLCBuO2JyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfXJldHVybiAocCB8fCBzKGUsIGQpKShpLCB0LCAhZywgbiwgIXQgfHwgSy50ZXN0KGUpICYmIGdlKHQucGFyZW50Tm9kZSkgfHwgdCksIG47XG4gICAgfSwgbi5zb3J0U3RhYmxlID0gYi5zcGxpdChcIlwiKS5zb3J0KEQpLmpvaW4oXCJcIikgPT09IGIsIG4uZGV0ZWN0RHVwbGljYXRlcyA9ICEhZiwgcCgpLCBuLnNvcnREZXRhY2hlZCA9IHVlKGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gMSAmIGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24oZC5jcmVhdGVFbGVtZW50KFwiZmllbGRzZXRcIikpO1xuICAgIH0pLCB1ZShmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIGUuaW5uZXJIVE1MID0gXCI8YSBocmVmPScjJz48L2E+XCIsIFwiI1wiID09PSBlLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKTtcbiAgICB9KSB8fCBsZShcInR5cGV8aHJlZnxoZWlnaHR8d2lkdGhcIiwgZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICAgIGlmICghbikgcmV0dXJuIGUuZ2V0QXR0cmlidXRlKHQsIFwidHlwZVwiID09PSB0LnRvTG93ZXJDYXNlKCkgPyAxIDogMik7XG4gICAgfSksIG4uYXR0cmlidXRlcyAmJiB1ZShmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIGUuaW5uZXJIVE1MID0gXCI8aW5wdXQvPlwiLCBlLmZpcnN0Q2hpbGQuc2V0QXR0cmlidXRlKFwidmFsdWVcIiwgXCJcIiksIFwiXCIgPT09IGUuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoXCJ2YWx1ZVwiKTtcbiAgICB9KSB8fCBsZShcInZhbHVlXCIsIGZ1bmN0aW9uIChlLCB0LCBuKSB7XG4gICAgICBpZiAoIW4gJiYgXCJpbnB1dFwiID09PSBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpIHJldHVybiBlLmRlZmF1bHRWYWx1ZTtcbiAgICB9KSwgdWUoZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBudWxsID09IGUuZ2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgfSkgfHwgbGUoUCwgZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICAgIHZhciByO2lmICghbikgcmV0dXJuICEwID09PSBlW3RdID8gdC50b0xvd2VyQ2FzZSgpIDogKHIgPSBlLmdldEF0dHJpYnV0ZU5vZGUodCkpICYmIHIuc3BlY2lmaWVkID8gci52YWx1ZSA6IG51bGw7XG4gICAgfSksIG9lO1xuICB9KGUpO3cuZmluZCA9IEUsIHcuZXhwciA9IEUuc2VsZWN0b3JzLCB3LmV4cHJbXCI6XCJdID0gdy5leHByLnBzZXVkb3MsIHcudW5pcXVlU29ydCA9IHcudW5pcXVlID0gRS51bmlxdWVTb3J0LCB3LnRleHQgPSBFLmdldFRleHQsIHcuaXNYTUxEb2MgPSBFLmlzWE1MLCB3LmNvbnRhaW5zID0gRS5jb250YWlucywgdy5lc2NhcGVTZWxlY3RvciA9IEUuZXNjYXBlO3ZhciBrID0gZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICB2YXIgciA9IFtdLFxuICAgICAgICBpID0gdm9pZCAwICE9PSBuO3doaWxlICgoZSA9IGVbdF0pICYmIDkgIT09IGUubm9kZVR5cGUpIGlmICgxID09PSBlLm5vZGVUeXBlKSB7XG4gICAgICBpZiAoaSAmJiB3KGUpLmlzKG4pKSBicmVhaztyLnB1c2goZSk7XG4gICAgfXJldHVybiByO1xuICB9LFxuICAgICAgUyA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgZm9yICh2YXIgbiA9IFtdOyBlOyBlID0gZS5uZXh0U2libGluZykgMSA9PT0gZS5ub2RlVHlwZSAmJiBlICE9PSB0ICYmIG4ucHVzaChlKTtyZXR1cm4gbjtcbiAgfSxcbiAgICAgIEQgPSB3LmV4cHIubWF0Y2gubmVlZHNDb250ZXh0O2Z1bmN0aW9uIE4oZSwgdCkge1xuICAgIHJldHVybiBlLm5vZGVOYW1lICYmIGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gdC50b0xvd2VyQ2FzZSgpO1xuICB9dmFyIEEgPSAvXjwoW2Etel1bXlxcL1xcMD46XFx4MjBcXHRcXHJcXG5cXGZdKilbXFx4MjBcXHRcXHJcXG5cXGZdKlxcLz8+KD86PFxcL1xcMT58KSQvaTtmdW5jdGlvbiBqKGUsIHQsIG4pIHtcbiAgICByZXR1cm4gZyh0KSA/IHcuZ3JlcChlLCBmdW5jdGlvbiAoZSwgcikge1xuICAgICAgcmV0dXJuICEhdC5jYWxsKGUsIHIsIGUpICE9PSBuO1xuICAgIH0pIDogdC5ub2RlVHlwZSA/IHcuZ3JlcChlLCBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIGUgPT09IHQgIT09IG47XG4gICAgfSkgOiBcInN0cmluZ1wiICE9IHR5cGVvZiB0ID8gdy5ncmVwKGUsIGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gdS5jYWxsKHQsIGUpID4gLTEgIT09IG47XG4gICAgfSkgOiB3LmZpbHRlcih0LCBlLCBuKTtcbiAgfXcuZmlsdGVyID0gZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICB2YXIgciA9IHRbMF07cmV0dXJuIG4gJiYgKGUgPSBcIjpub3QoXCIgKyBlICsgXCIpXCIpLCAxID09PSB0Lmxlbmd0aCAmJiAxID09PSByLm5vZGVUeXBlID8gdy5maW5kLm1hdGNoZXNTZWxlY3RvcihyLCBlKSA/IFtyXSA6IFtdIDogdy5maW5kLm1hdGNoZXMoZSwgdy5ncmVwKHQsIGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gMSA9PT0gZS5ub2RlVHlwZTtcbiAgICB9KSk7XG4gIH0sIHcuZm4uZXh0ZW5kKHsgZmluZDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciB0LFxuICAgICAgICAgIG4sXG4gICAgICAgICAgciA9IHRoaXMubGVuZ3RoLFxuICAgICAgICAgIGkgPSB0aGlzO2lmIChcInN0cmluZ1wiICE9IHR5cGVvZiBlKSByZXR1cm4gdGhpcy5wdXNoU3RhY2sodyhlKS5maWx0ZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHQgPSAwOyB0IDwgcjsgdCsrKSBpZiAody5jb250YWlucyhpW3RdLCB0aGlzKSkgcmV0dXJuICEwO1xuICAgICAgfSkpO2ZvciAobiA9IHRoaXMucHVzaFN0YWNrKFtdKSwgdCA9IDA7IHQgPCByOyB0KyspIHcuZmluZChlLCBpW3RdLCBuKTtyZXR1cm4gciA+IDEgPyB3LnVuaXF1ZVNvcnQobikgOiBuO1xuICAgIH0sIGZpbHRlcjogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayhqKHRoaXMsIGUgfHwgW10sICExKSk7XG4gICAgfSwgbm90OiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKGoodGhpcywgZSB8fCBbXSwgITApKTtcbiAgICB9LCBpczogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiAhIWoodGhpcywgXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSAmJiBELnRlc3QoZSkgPyB3KGUpIDogZSB8fCBbXSwgITEpLmxlbmd0aDtcbiAgICB9IH0pO3ZhciBxLFxuICAgICAgTCA9IC9eKD86XFxzKig8W1xcd1xcV10rPilbXj5dKnwjKFtcXHctXSspKSQvOyh3LmZuLmluaXQgPSBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgIHZhciBpLCBvO2lmICghZSkgcmV0dXJuIHRoaXM7aWYgKG4gPSBuIHx8IHEsIFwic3RyaW5nXCIgPT0gdHlwZW9mIGUpIHtcbiAgICAgIGlmICghKGkgPSBcIjxcIiA9PT0gZVswXSAmJiBcIj5cIiA9PT0gZVtlLmxlbmd0aCAtIDFdICYmIGUubGVuZ3RoID49IDMgPyBbbnVsbCwgZSwgbnVsbF0gOiBMLmV4ZWMoZSkpIHx8ICFpWzFdICYmIHQpIHJldHVybiAhdCB8fCB0LmpxdWVyeSA/ICh0IHx8IG4pLmZpbmQoZSkgOiB0aGlzLmNvbnN0cnVjdG9yKHQpLmZpbmQoZSk7aWYgKGlbMV0pIHtcbiAgICAgICAgaWYgKHQgPSB0IGluc3RhbmNlb2YgdyA/IHRbMF0gOiB0LCB3Lm1lcmdlKHRoaXMsIHcucGFyc2VIVE1MKGlbMV0sIHQgJiYgdC5ub2RlVHlwZSA/IHQub3duZXJEb2N1bWVudCB8fCB0IDogciwgITApKSwgQS50ZXN0KGlbMV0pICYmIHcuaXNQbGFpbk9iamVjdCh0KSkgZm9yIChpIGluIHQpIGcodGhpc1tpXSkgPyB0aGlzW2ldKHRbaV0pIDogdGhpcy5hdHRyKGksIHRbaV0pO3JldHVybiB0aGlzO1xuICAgICAgfXJldHVybiAobyA9IHIuZ2V0RWxlbWVudEJ5SWQoaVsyXSkpICYmICh0aGlzWzBdID0gbywgdGhpcy5sZW5ndGggPSAxKSwgdGhpcztcbiAgICB9cmV0dXJuIGUubm9kZVR5cGUgPyAodGhpc1swXSA9IGUsIHRoaXMubGVuZ3RoID0gMSwgdGhpcykgOiBnKGUpID8gdm9pZCAwICE9PSBuLnJlYWR5ID8gbi5yZWFkeShlKSA6IGUodykgOiB3Lm1ha2VBcnJheShlLCB0aGlzKTtcbiAgfSkucHJvdG90eXBlID0gdy5mbiwgcSA9IHcocik7dmFyIEggPSAvXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLyxcbiAgICAgIE8gPSB7IGNoaWxkcmVuOiAhMCwgY29udGVudHM6ICEwLCBuZXh0OiAhMCwgcHJldjogITAgfTt3LmZuLmV4dGVuZCh7IGhhczogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciB0ID0gdyhlLCB0aGlzKSxcbiAgICAgICAgICBuID0gdC5sZW5ndGg7cmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCBuOyBlKyspIGlmICh3LmNvbnRhaW5zKHRoaXMsIHRbZV0pKSByZXR1cm4gITA7XG4gICAgICB9KTtcbiAgICB9LCBjbG9zZXN0OiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgdmFyIG4sXG4gICAgICAgICAgciA9IDAsXG4gICAgICAgICAgaSA9IHRoaXMubGVuZ3RoLFxuICAgICAgICAgIG8gPSBbXSxcbiAgICAgICAgICBhID0gXCJzdHJpbmdcIiAhPSB0eXBlb2YgZSAmJiB3KGUpO2lmICghRC50ZXN0KGUpKSBmb3IgKDsgciA8IGk7IHIrKykgZm9yIChuID0gdGhpc1tyXTsgbiAmJiBuICE9PSB0OyBuID0gbi5wYXJlbnROb2RlKSBpZiAobi5ub2RlVHlwZSA8IDExICYmIChhID8gYS5pbmRleChuKSA+IC0xIDogMSA9PT0gbi5ub2RlVHlwZSAmJiB3LmZpbmQubWF0Y2hlc1NlbGVjdG9yKG4sIGUpKSkge1xuICAgICAgICBvLnB1c2gobik7YnJlYWs7XG4gICAgICB9cmV0dXJuIHRoaXMucHVzaFN0YWNrKG8ubGVuZ3RoID4gMSA/IHcudW5pcXVlU29ydChvKSA6IG8pO1xuICAgIH0sIGluZGV4OiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIGUgPyBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gdS5jYWxsKHcoZSksIHRoaXNbMF0pIDogdS5jYWxsKHRoaXMsIGUuanF1ZXJ5ID8gZVswXSA6IGUpIDogdGhpc1swXSAmJiB0aGlzWzBdLnBhcmVudE5vZGUgPyB0aGlzLmZpcnN0KCkucHJldkFsbCgpLmxlbmd0aCA6IC0xO1xuICAgIH0sIGFkZDogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayh3LnVuaXF1ZVNvcnQody5tZXJnZSh0aGlzLmdldCgpLCB3KGUsIHQpKSkpO1xuICAgIH0sIGFkZEJhY2s6IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gdGhpcy5hZGQobnVsbCA9PSBlID8gdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlcihlKSk7XG4gICAgfSB9KTtmdW5jdGlvbiBQKGUsIHQpIHtcbiAgICB3aGlsZSAoKGUgPSBlW3RdKSAmJiAxICE9PSBlLm5vZGVUeXBlKTtyZXR1cm4gZTtcbiAgfXcuZWFjaCh7IHBhcmVudDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciB0ID0gZS5wYXJlbnROb2RlO3JldHVybiB0ICYmIDExICE9PSB0Lm5vZGVUeXBlID8gdCA6IG51bGw7XG4gICAgfSwgcGFyZW50czogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBrKGUsIFwicGFyZW50Tm9kZVwiKTtcbiAgICB9LCBwYXJlbnRzVW50aWw6IGZ1bmN0aW9uIChlLCB0LCBuKSB7XG4gICAgICByZXR1cm4gayhlLCBcInBhcmVudE5vZGVcIiwgbik7XG4gICAgfSwgbmV4dDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBQKGUsIFwibmV4dFNpYmxpbmdcIik7XG4gICAgfSwgcHJldjogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBQKGUsIFwicHJldmlvdXNTaWJsaW5nXCIpO1xuICAgIH0sIG5leHRBbGw6IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gayhlLCBcIm5leHRTaWJsaW5nXCIpO1xuICAgIH0sIHByZXZBbGw6IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gayhlLCBcInByZXZpb3VzU2libGluZ1wiKTtcbiAgICB9LCBuZXh0VW50aWw6IGZ1bmN0aW9uIChlLCB0LCBuKSB7XG4gICAgICByZXR1cm4gayhlLCBcIm5leHRTaWJsaW5nXCIsIG4pO1xuICAgIH0sIHByZXZVbnRpbDogZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICAgIHJldHVybiBrKGUsIFwicHJldmlvdXNTaWJsaW5nXCIsIG4pO1xuICAgIH0sIHNpYmxpbmdzOiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIFMoKGUucGFyZW50Tm9kZSB8fCB7fSkuZmlyc3RDaGlsZCwgZSk7XG4gICAgfSwgY2hpbGRyZW46IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gUyhlLmZpcnN0Q2hpbGQpO1xuICAgIH0sIGNvbnRlbnRzOiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIE4oZSwgXCJpZnJhbWVcIikgPyBlLmNvbnRlbnREb2N1bWVudCA6IChOKGUsIFwidGVtcGxhdGVcIikgJiYgKGUgPSBlLmNvbnRlbnQgfHwgZSksIHcubWVyZ2UoW10sIGUuY2hpbGROb2RlcykpO1xuICAgIH0gfSwgZnVuY3Rpb24gKGUsIHQpIHtcbiAgICB3LmZuW2VdID0gZnVuY3Rpb24gKG4sIHIpIHtcbiAgICAgIHZhciBpID0gdy5tYXAodGhpcywgdCwgbik7cmV0dXJuIFwiVW50aWxcIiAhPT0gZS5zbGljZSgtNSkgJiYgKHIgPSBuKSwgciAmJiBcInN0cmluZ1wiID09IHR5cGVvZiByICYmIChpID0gdy5maWx0ZXIociwgaSkpLCB0aGlzLmxlbmd0aCA+IDEgJiYgKE9bZV0gfHwgdy51bmlxdWVTb3J0KGkpLCBILnRlc3QoZSkgJiYgaS5yZXZlcnNlKCkpLCB0aGlzLnB1c2hTdGFjayhpKTtcbiAgICB9O1xuICB9KTt2YXIgTSA9IC9bXlxceDIwXFx0XFxyXFxuXFxmXSsvZztmdW5jdGlvbiBSKGUpIHtcbiAgICB2YXIgdCA9IHt9O3JldHVybiB3LmVhY2goZS5tYXRjaChNKSB8fCBbXSwgZnVuY3Rpb24gKGUsIG4pIHtcbiAgICAgIHRbbl0gPSAhMDtcbiAgICB9KSwgdDtcbiAgfXcuQ2FsbGJhY2tzID0gZnVuY3Rpb24gKGUpIHtcbiAgICBlID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSA/IFIoZSkgOiB3LmV4dGVuZCh7fSwgZSk7dmFyIHQsXG4gICAgICAgIG4sXG4gICAgICAgIHIsXG4gICAgICAgIGksXG4gICAgICAgIG8gPSBbXSxcbiAgICAgICAgYSA9IFtdLFxuICAgICAgICBzID0gLTEsXG4gICAgICAgIHUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKGkgPSBpIHx8IGUub25jZSwgciA9IHQgPSAhMDsgYS5sZW5ndGg7IHMgPSAtMSkge1xuICAgICAgICBuID0gYS5zaGlmdCgpO3doaWxlICgrK3MgPCBvLmxlbmd0aCkgITEgPT09IG9bc10uYXBwbHkoblswXSwgblsxXSkgJiYgZS5zdG9wT25GYWxzZSAmJiAocyA9IG8ubGVuZ3RoLCBuID0gITEpO1xuICAgICAgfWUubWVtb3J5IHx8IChuID0gITEpLCB0ID0gITEsIGkgJiYgKG8gPSBuID8gW10gOiBcIlwiKTtcbiAgICB9LFxuICAgICAgICBsID0geyBhZGQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG8gJiYgKG4gJiYgIXQgJiYgKHMgPSBvLmxlbmd0aCAtIDEsIGEucHVzaChuKSksIGZ1bmN0aW9uIHQobikge1xuICAgICAgICAgIHcuZWFjaChuLCBmdW5jdGlvbiAobiwgcikge1xuICAgICAgICAgICAgZyhyKSA/IGUudW5pcXVlICYmIGwuaGFzKHIpIHx8IG8ucHVzaChyKSA6IHIgJiYgci5sZW5ndGggJiYgXCJzdHJpbmdcIiAhPT0geChyKSAmJiB0KHIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KGFyZ3VtZW50cyksIG4gJiYgIXQgJiYgdSgpKSwgdGhpcztcbiAgICAgIH0sIHJlbW92ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdy5lYWNoKGFyZ3VtZW50cywgZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgICB2YXIgbjt3aGlsZSAoKG4gPSB3LmluQXJyYXkodCwgbywgbikpID4gLTEpIG8uc3BsaWNlKG4sIDEpLCBuIDw9IHMgJiYgcy0tO1xuICAgICAgICB9KSwgdGhpcztcbiAgICAgIH0sIGhhczogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIGUgPyB3LmluQXJyYXkoZSwgbykgPiAtMSA6IG8ubGVuZ3RoID4gMDtcbiAgICAgIH0sIGVtcHR5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBvICYmIChvID0gW10pLCB0aGlzO1xuICAgICAgfSwgZGlzYWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gaSA9IGEgPSBbXSwgbyA9IG4gPSBcIlwiLCB0aGlzO1xuICAgICAgfSwgZGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICFvO1xuICAgICAgfSwgbG9jazogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gaSA9IGEgPSBbXSwgbiB8fCB0IHx8IChvID0gbiA9IFwiXCIpLCB0aGlzO1xuICAgICAgfSwgbG9ja2VkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAhIWk7XG4gICAgICB9LCBmaXJlV2l0aDogZnVuY3Rpb24gKGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIGkgfHwgKG4gPSBbZSwgKG4gPSBuIHx8IFtdKS5zbGljZSA/IG4uc2xpY2UoKSA6IG5dLCBhLnB1c2gobiksIHQgfHwgdSgpKSwgdGhpcztcbiAgICAgIH0sIGZpcmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGwuZmlyZVdpdGgodGhpcywgYXJndW1lbnRzKSwgdGhpcztcbiAgICAgIH0sIGZpcmVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAhIXI7XG4gICAgICB9IH07cmV0dXJuIGw7XG4gIH07ZnVuY3Rpb24gSShlKSB7XG4gICAgcmV0dXJuIGU7XG4gIH1mdW5jdGlvbiBXKGUpIHtcbiAgICB0aHJvdyBlO1xuICB9ZnVuY3Rpb24gJChlLCB0LCBuLCByKSB7XG4gICAgdmFyIGk7dHJ5IHtcbiAgICAgIGUgJiYgZyhpID0gZS5wcm9taXNlKSA/IGkuY2FsbChlKS5kb25lKHQpLmZhaWwobikgOiBlICYmIGcoaSA9IGUudGhlbikgPyBpLmNhbGwoZSwgdCwgbikgOiB0LmFwcGx5KHZvaWQgMCwgW2VdLnNsaWNlKHIpKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBuLmFwcGx5KHZvaWQgMCwgW2VdKTtcbiAgICB9XG4gIH13LmV4dGVuZCh7IERlZmVycmVkOiBmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIG4gPSBbW1wibm90aWZ5XCIsIFwicHJvZ3Jlc3NcIiwgdy5DYWxsYmFja3MoXCJtZW1vcnlcIiksIHcuQ2FsbGJhY2tzKFwibWVtb3J5XCIpLCAyXSwgW1wicmVzb2x2ZVwiLCBcImRvbmVcIiwgdy5DYWxsYmFja3MoXCJvbmNlIG1lbW9yeVwiKSwgdy5DYWxsYmFja3MoXCJvbmNlIG1lbW9yeVwiKSwgMCwgXCJyZXNvbHZlZFwiXSwgW1wicmVqZWN0XCIsIFwiZmFpbFwiLCB3LkNhbGxiYWNrcyhcIm9uY2UgbWVtb3J5XCIpLCB3LkNhbGxiYWNrcyhcIm9uY2UgbWVtb3J5XCIpLCAxLCBcInJlamVjdGVkXCJdXSxcbiAgICAgICAgICByID0gXCJwZW5kaW5nXCIsXG4gICAgICAgICAgaSA9IHsgc3RhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gcjtcbiAgICAgICAgfSwgYWx3YXlzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG8uZG9uZShhcmd1bWVudHMpLmZhaWwoYXJndW1lbnRzKSwgdGhpcztcbiAgICAgICAgfSwgXCJjYXRjaFwiOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHJldHVybiBpLnRoZW4obnVsbCwgZSk7XG4gICAgICAgIH0sIHBpcGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgZSA9IGFyZ3VtZW50cztyZXR1cm4gdy5EZWZlcnJlZChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgdy5lYWNoKG4sIGZ1bmN0aW9uIChuLCByKSB7XG4gICAgICAgICAgICAgIHZhciBpID0gZyhlW3JbNF1dKSAmJiBlW3JbNF1dO29bclsxXV0oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBlID0gaSAmJiBpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7ZSAmJiBnKGUucHJvbWlzZSkgPyBlLnByb21pc2UoKS5wcm9ncmVzcyh0Lm5vdGlmeSkuZG9uZSh0LnJlc29sdmUpLmZhaWwodC5yZWplY3QpIDogdFtyWzBdICsgXCJXaXRoXCJdKHRoaXMsIGkgPyBbZV0gOiBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pLCBlID0gbnVsbDtcbiAgICAgICAgICB9KS5wcm9taXNlKCk7XG4gICAgICAgIH0sIHRoZW46IGZ1bmN0aW9uICh0LCByLCBpKSB7XG4gICAgICAgICAgdmFyIG8gPSAwO2Z1bmN0aW9uIGEodCwgbiwgciwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgdmFyIHMgPSB0aGlzLFxuICAgICAgICAgICAgICAgICAgdSA9IGFyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgIGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGUsIGw7aWYgKCEodCA8IG8pKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoKGUgPSByLmFwcGx5KHMsIHUpKSA9PT0gbi5wcm9taXNlKCkpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGVuYWJsZSBzZWxmLXJlc29sdXRpb25cIik7bCA9IGUgJiYgKFwib2JqZWN0XCIgPT0gdHlwZW9mIGUgfHwgXCJmdW5jdGlvblwiID09IHR5cGVvZiBlKSAmJiBlLnRoZW4sIGcobCkgPyBpID8gbC5jYWxsKGUsIGEobywgbiwgSSwgaSksIGEobywgbiwgVywgaSkpIDogKG8rKywgbC5jYWxsKGUsIGEobywgbiwgSSwgaSksIGEobywgbiwgVywgaSksIGEobywgbiwgSSwgbi5ub3RpZnlXaXRoKSkpIDogKHIgIT09IEkgJiYgKHMgPSB2b2lkIDAsIHUgPSBbZV0pLCAoaSB8fCBuLnJlc29sdmVXaXRoKShzLCB1KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgYyA9IGkgPyBsIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBsKCk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgdy5EZWZlcnJlZC5leGNlcHRpb25Ib29rICYmIHcuRGVmZXJyZWQuZXhjZXB0aW9uSG9vayhlLCBjLnN0YWNrVHJhY2UpLCB0ICsgMSA+PSBvICYmIChyICE9PSBXICYmIChzID0gdm9pZCAwLCB1ID0gW2VdKSwgbi5yZWplY3RXaXRoKHMsIHUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH07dCA/IGMoKSA6ICh3LkRlZmVycmVkLmdldFN0YWNrSG9vayAmJiAoYy5zdGFja1RyYWNlID0gdy5EZWZlcnJlZC5nZXRTdGFja0hvb2soKSksIGUuc2V0VGltZW91dChjKSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1yZXR1cm4gdy5EZWZlcnJlZChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgblswXVszXS5hZGQoYSgwLCBlLCBnKGkpID8gaSA6IEksIGUubm90aWZ5V2l0aCkpLCBuWzFdWzNdLmFkZChhKDAsIGUsIGcodCkgPyB0IDogSSkpLCBuWzJdWzNdLmFkZChhKDAsIGUsIGcocikgPyByIDogVykpO1xuICAgICAgICAgIH0pLnByb21pc2UoKTtcbiAgICAgICAgfSwgcHJvbWlzZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbCAhPSBlID8gdy5leHRlbmQoZSwgaSkgOiBpO1xuICAgICAgICB9IH0sXG4gICAgICAgICAgbyA9IHt9O3JldHVybiB3LmVhY2gobiwgZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgdmFyIGEgPSB0WzJdLFxuICAgICAgICAgICAgcyA9IHRbNV07aVt0WzFdXSA9IGEuYWRkLCBzICYmIGEuYWRkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByID0gcztcbiAgICAgICAgfSwgblszIC0gZV1bMl0uZGlzYWJsZSwgblszIC0gZV1bM10uZGlzYWJsZSwgblswXVsyXS5sb2NrLCBuWzBdWzNdLmxvY2spLCBhLmFkZCh0WzNdLmZpcmUpLCBvW3RbMF1dID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBvW3RbMF0gKyBcIldpdGhcIl0odGhpcyA9PT0gbyA/IHZvaWQgMCA6IHRoaXMsIGFyZ3VtZW50cyksIHRoaXM7XG4gICAgICAgIH0sIG9bdFswXSArIFwiV2l0aFwiXSA9IGEuZmlyZVdpdGg7XG4gICAgICB9KSwgaS5wcm9taXNlKG8pLCB0ICYmIHQuY2FsbChvLCBvKSwgbztcbiAgICB9LCB3aGVuOiBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHQgPSBhcmd1bWVudHMubGVuZ3RoLFxuICAgICAgICAgIG4gPSB0LFxuICAgICAgICAgIHIgPSBBcnJheShuKSxcbiAgICAgICAgICBpID0gby5jYWxsKGFyZ3VtZW50cyksXG4gICAgICAgICAgYSA9IHcuRGVmZXJyZWQoKSxcbiAgICAgICAgICBzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChuKSB7XG4gICAgICAgICAgcltlXSA9IHRoaXMsIGlbZV0gPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IG8uY2FsbChhcmd1bWVudHMpIDogbiwgLS10IHx8IGEucmVzb2x2ZVdpdGgociwgaSk7XG4gICAgICAgIH07XG4gICAgICB9O2lmICh0IDw9IDEgJiYgKCQoZSwgYS5kb25lKHMobikpLnJlc29sdmUsIGEucmVqZWN0LCAhdCksIFwicGVuZGluZ1wiID09PSBhLnN0YXRlKCkgfHwgZyhpW25dICYmIGlbbl0udGhlbikpKSByZXR1cm4gYS50aGVuKCk7d2hpbGUgKG4tLSkgJChpW25dLCBzKG4pLCBhLnJlamVjdCk7cmV0dXJuIGEucHJvbWlzZSgpO1xuICAgIH0gfSk7dmFyIEIgPSAvXihFdmFsfEludGVybmFsfFJhbmdlfFJlZmVyZW5jZXxTeW50YXh8VHlwZXxVUkkpRXJyb3IkLzt3LkRlZmVycmVkLmV4Y2VwdGlvbkhvb2sgPSBmdW5jdGlvbiAodCwgbikge1xuICAgIGUuY29uc29sZSAmJiBlLmNvbnNvbGUud2FybiAmJiB0ICYmIEIudGVzdCh0Lm5hbWUpICYmIGUuY29uc29sZS53YXJuKFwialF1ZXJ5LkRlZmVycmVkIGV4Y2VwdGlvbjogXCIgKyB0Lm1lc3NhZ2UsIHQuc3RhY2ssIG4pO1xuICB9LCB3LnJlYWR5RXhjZXB0aW9uID0gZnVuY3Rpb24gKHQpIHtcbiAgICBlLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgdGhyb3cgdDtcbiAgICB9KTtcbiAgfTt2YXIgRiA9IHcuRGVmZXJyZWQoKTt3LmZuLnJlYWR5ID0gZnVuY3Rpb24gKGUpIHtcbiAgICByZXR1cm4gRi50aGVuKGUpW1wiY2F0Y2hcIl0oZnVuY3Rpb24gKGUpIHtcbiAgICAgIHcucmVhZHlFeGNlcHRpb24oZSk7XG4gICAgfSksIHRoaXM7XG4gIH0sIHcuZXh0ZW5kKHsgaXNSZWFkeTogITEsIHJlYWR5V2FpdDogMSwgcmVhZHk6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAoITAgPT09IGUgPyAtLXcucmVhZHlXYWl0IDogdy5pc1JlYWR5KSB8fCAody5pc1JlYWR5ID0gITAsICEwICE9PSBlICYmIC0tdy5yZWFkeVdhaXQgPiAwIHx8IEYucmVzb2x2ZVdpdGgociwgW3ddKSk7XG4gICAgfSB9KSwgdy5yZWFkeS50aGVuID0gRi50aGVuO2Z1bmN0aW9uIF8oKSB7XG4gICAgci5yZW1vdmVFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBfKSwgZS5yZW1vdmVFdmVudExpc3RlbmVyKFwibG9hZFwiLCBfKSwgdy5yZWFkeSgpO1xuICB9XCJjb21wbGV0ZVwiID09PSByLnJlYWR5U3RhdGUgfHwgXCJsb2FkaW5nXCIgIT09IHIucmVhZHlTdGF0ZSAmJiAhci5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwgPyBlLnNldFRpbWVvdXQody5yZWFkeSkgOiAoci5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBfKSwgZS5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBfKSk7dmFyIHogPSBmdW5jdGlvbiAoZSwgdCwgbiwgciwgaSwgbywgYSkge1xuICAgIHZhciBzID0gMCxcbiAgICAgICAgdSA9IGUubGVuZ3RoLFxuICAgICAgICBsID0gbnVsbCA9PSBuO2lmIChcIm9iamVjdFwiID09PSB4KG4pKSB7XG4gICAgICBpID0gITA7Zm9yIChzIGluIG4pIHooZSwgdCwgcywgbltzXSwgITAsIG8sIGEpO1xuICAgIH0gZWxzZSBpZiAodm9pZCAwICE9PSByICYmIChpID0gITAsIGcocikgfHwgKGEgPSAhMCksIGwgJiYgKGEgPyAodC5jYWxsKGUsIHIpLCB0ID0gbnVsbCkgOiAobCA9IHQsIHQgPSBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgcmV0dXJuIGwuY2FsbCh3KGUpLCBuKTtcbiAgICB9KSksIHQpKSBmb3IgKDsgcyA8IHU7IHMrKykgdChlW3NdLCBuLCBhID8gciA6IHIuY2FsbChlW3NdLCBzLCB0KGVbc10sIG4pKSk7cmV0dXJuIGkgPyBlIDogbCA/IHQuY2FsbChlKSA6IHUgPyB0KGVbMF0sIG4pIDogbztcbiAgfSxcbiAgICAgIFggPSAvXi1tcy0vLFxuICAgICAgVSA9IC8tKFthLXpdKS9nO2Z1bmN0aW9uIFYoZSwgdCkge1xuICAgIHJldHVybiB0LnRvVXBwZXJDYXNlKCk7XG4gIH1mdW5jdGlvbiBHKGUpIHtcbiAgICByZXR1cm4gZS5yZXBsYWNlKFgsIFwibXMtXCIpLnJlcGxhY2UoVSwgVik7XG4gIH12YXIgWSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgcmV0dXJuIDEgPT09IGUubm9kZVR5cGUgfHwgOSA9PT0gZS5ub2RlVHlwZSB8fCAhK2Uubm9kZVR5cGU7XG4gIH07ZnVuY3Rpb24gUSgpIHtcbiAgICB0aGlzLmV4cGFuZG8gPSB3LmV4cGFuZG8gKyBRLnVpZCsrO1xuICB9US51aWQgPSAxLCBRLnByb3RvdHlwZSA9IHsgY2FjaGU6IGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgdCA9IGVbdGhpcy5leHBhbmRvXTtyZXR1cm4gdCB8fCAodCA9IHt9LCBZKGUpICYmIChlLm5vZGVUeXBlID8gZVt0aGlzLmV4cGFuZG9dID0gdCA6IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCB0aGlzLmV4cGFuZG8sIHsgdmFsdWU6IHQsIGNvbmZpZ3VyYWJsZTogITAgfSkpKSwgdDtcbiAgICB9LCBzZXQ6IGZ1bmN0aW9uIChlLCB0LCBuKSB7XG4gICAgICB2YXIgcixcbiAgICAgICAgICBpID0gdGhpcy5jYWNoZShlKTtpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgdCkgaVtHKHQpXSA9IG47ZWxzZSBmb3IgKHIgaW4gdCkgaVtHKHIpXSA9IHRbcl07cmV0dXJuIGk7XG4gICAgfSwgZ2V0OiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gdCA/IHRoaXMuY2FjaGUoZSkgOiBlW3RoaXMuZXhwYW5kb10gJiYgZVt0aGlzLmV4cGFuZG9dW0codCldO1xuICAgIH0sIGFjY2VzczogZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICAgIHJldHVybiB2b2lkIDAgPT09IHQgfHwgdCAmJiBcInN0cmluZ1wiID09IHR5cGVvZiB0ICYmIHZvaWQgMCA9PT0gbiA/IHRoaXMuZ2V0KGUsIHQpIDogKHRoaXMuc2V0KGUsIHQsIG4pLCB2b2lkIDAgIT09IG4gPyBuIDogdCk7XG4gICAgfSwgcmVtb3ZlOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgdmFyIG4sXG4gICAgICAgICAgciA9IGVbdGhpcy5leHBhbmRvXTtpZiAodm9pZCAwICE9PSByKSB7XG4gICAgICAgIGlmICh2b2lkIDAgIT09IHQpIHtcbiAgICAgICAgICBuID0gKHQgPSBBcnJheS5pc0FycmF5KHQpID8gdC5tYXAoRykgOiAodCA9IEcodCkpIGluIHIgPyBbdF0gOiB0Lm1hdGNoKE0pIHx8IFtdKS5sZW5ndGg7d2hpbGUgKG4tLSkgZGVsZXRlIHJbdFtuXV07XG4gICAgICAgIH0odm9pZCAwID09PSB0IHx8IHcuaXNFbXB0eU9iamVjdChyKSkgJiYgKGUubm9kZVR5cGUgPyBlW3RoaXMuZXhwYW5kb10gPSB2b2lkIDAgOiBkZWxldGUgZVt0aGlzLmV4cGFuZG9dKTtcbiAgICAgIH1cbiAgICB9LCBoYXNEYXRhOiBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHQgPSBlW3RoaXMuZXhwYW5kb107cmV0dXJuIHZvaWQgMCAhPT0gdCAmJiAhdy5pc0VtcHR5T2JqZWN0KHQpO1xuICAgIH0gfTt2YXIgSiA9IG5ldyBRKCksXG4gICAgICBLID0gbmV3IFEoKSxcbiAgICAgIFogPSAvXig/Olxce1tcXHdcXFddKlxcfXxcXFtbXFx3XFxXXSpcXF0pJC8sXG4gICAgICBlZSA9IC9bQS1aXS9nO2Z1bmN0aW9uIHRlKGUpIHtcbiAgICByZXR1cm4gXCJ0cnVlXCIgPT09IGUgfHwgXCJmYWxzZVwiICE9PSBlICYmIChcIm51bGxcIiA9PT0gZSA/IG51bGwgOiBlID09PSArZSArIFwiXCIgPyArZSA6IFoudGVzdChlKSA/IEpTT04ucGFyc2UoZSkgOiBlKTtcbiAgfWZ1bmN0aW9uIG5lKGUsIHQsIG4pIHtcbiAgICB2YXIgcjtpZiAodm9pZCAwID09PSBuICYmIDEgPT09IGUubm9kZVR5cGUpIGlmIChyID0gXCJkYXRhLVwiICsgdC5yZXBsYWNlKGVlLCBcIi0kJlwiKS50b0xvd2VyQ2FzZSgpLCBcInN0cmluZ1wiID09IHR5cGVvZiAobiA9IGUuZ2V0QXR0cmlidXRlKHIpKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgbiA9IHRlKG4pO1xuICAgICAgfSBjYXRjaCAoZSkge31LLnNldChlLCB0LCBuKTtcbiAgICB9IGVsc2UgbiA9IHZvaWQgMDtyZXR1cm4gbjtcbiAgfXcuZXh0ZW5kKHsgaGFzRGF0YTogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBLLmhhc0RhdGEoZSkgfHwgSi5oYXNEYXRhKGUpO1xuICAgIH0sIGRhdGE6IGZ1bmN0aW9uIChlLCB0LCBuKSB7XG4gICAgICByZXR1cm4gSy5hY2Nlc3MoZSwgdCwgbik7XG4gICAgfSwgcmVtb3ZlRGF0YTogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIEsucmVtb3ZlKGUsIHQpO1xuICAgIH0sIF9kYXRhOiBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgcmV0dXJuIEouYWNjZXNzKGUsIHQsIG4pO1xuICAgIH0sIF9yZW1vdmVEYXRhOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgSi5yZW1vdmUoZSwgdCk7XG4gICAgfSB9KSwgdy5mbi5leHRlbmQoeyBkYXRhOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgdmFyIG4sXG4gICAgICAgICAgcixcbiAgICAgICAgICBpLFxuICAgICAgICAgIG8gPSB0aGlzWzBdLFxuICAgICAgICAgIGEgPSBvICYmIG8uYXR0cmlidXRlcztpZiAodm9pZCAwID09PSBlKSB7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCAmJiAoaSA9IEsuZ2V0KG8pLCAxID09PSBvLm5vZGVUeXBlICYmICFKLmdldChvLCBcImhhc0RhdGFBdHRyc1wiKSkpIHtcbiAgICAgICAgICBuID0gYS5sZW5ndGg7d2hpbGUgKG4tLSkgYVtuXSAmJiAwID09PSAociA9IGFbbl0ubmFtZSkuaW5kZXhPZihcImRhdGEtXCIpICYmIChyID0gRyhyLnNsaWNlKDUpKSwgbmUobywgciwgaVtyXSkpO0ouc2V0KG8sIFwiaGFzRGF0YUF0dHJzXCIsICEwKTtcbiAgICAgICAgfXJldHVybiBpO1xuICAgICAgfXJldHVybiBcIm9iamVjdFwiID09IHR5cGVvZiBlID8gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgSy5zZXQodGhpcywgZSk7XG4gICAgICB9KSA6IHoodGhpcywgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgdmFyIG47aWYgKG8gJiYgdm9pZCAwID09PSB0KSB7XG4gICAgICAgICAgaWYgKHZvaWQgMCAhPT0gKG4gPSBLLmdldChvLCBlKSkpIHJldHVybiBuO2lmICh2b2lkIDAgIT09IChuID0gbmUobywgZSkpKSByZXR1cm4gbjtcbiAgICAgICAgfSBlbHNlIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgSy5zZXQodGhpcywgZSwgdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSwgbnVsbCwgdCwgYXJndW1lbnRzLmxlbmd0aCA+IDEsIG51bGwsICEwKTtcbiAgICB9LCByZW1vdmVEYXRhOiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIEsucmVtb3ZlKHRoaXMsIGUpO1xuICAgICAgfSk7XG4gICAgfSB9KSwgdy5leHRlbmQoeyBxdWV1ZTogZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICAgIHZhciByO2lmIChlKSByZXR1cm4gdCA9ICh0IHx8IFwiZnhcIikgKyBcInF1ZXVlXCIsIHIgPSBKLmdldChlLCB0KSwgbiAmJiAoIXIgfHwgQXJyYXkuaXNBcnJheShuKSA/IHIgPSBKLmFjY2VzcyhlLCB0LCB3Lm1ha2VBcnJheShuKSkgOiByLnB1c2gobikpLCByIHx8IFtdO1xuICAgIH0sIGRlcXVldWU6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICB0ID0gdCB8fCBcImZ4XCI7dmFyIG4gPSB3LnF1ZXVlKGUsIHQpLFxuICAgICAgICAgIHIgPSBuLmxlbmd0aCxcbiAgICAgICAgICBpID0gbi5zaGlmdCgpLFxuICAgICAgICAgIG8gPSB3Ll9xdWV1ZUhvb2tzKGUsIHQpLFxuICAgICAgICAgIGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHcuZGVxdWV1ZShlLCB0KTtcbiAgICAgIH07XCJpbnByb2dyZXNzXCIgPT09IGkgJiYgKGkgPSBuLnNoaWZ0KCksIHItLSksIGkgJiYgKFwiZnhcIiA9PT0gdCAmJiBuLnVuc2hpZnQoXCJpbnByb2dyZXNzXCIpLCBkZWxldGUgby5zdG9wLCBpLmNhbGwoZSwgYSwgbykpLCAhciAmJiBvICYmIG8uZW1wdHkuZmlyZSgpO1xuICAgIH0sIF9xdWV1ZUhvb2tzOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgdmFyIG4gPSB0ICsgXCJxdWV1ZUhvb2tzXCI7cmV0dXJuIEouZ2V0KGUsIG4pIHx8IEouYWNjZXNzKGUsIG4sIHsgZW1wdHk6IHcuQ2FsbGJhY2tzKFwib25jZSBtZW1vcnlcIikuYWRkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBKLnJlbW92ZShlLCBbdCArIFwicXVldWVcIiwgbl0pO1xuICAgICAgICB9KSB9KTtcbiAgICB9IH0pLCB3LmZuLmV4dGVuZCh7IHF1ZXVlOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgdmFyIG4gPSAyO3JldHVybiBcInN0cmluZ1wiICE9IHR5cGVvZiBlICYmICh0ID0gZSwgZSA9IFwiZnhcIiwgbi0tKSwgYXJndW1lbnRzLmxlbmd0aCA8IG4gPyB3LnF1ZXVlKHRoaXNbMF0sIGUpIDogdm9pZCAwID09PSB0ID8gdGhpcyA6IHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBuID0gdy5xdWV1ZSh0aGlzLCBlLCB0KTt3Ll9xdWV1ZUhvb2tzKHRoaXMsIGUpLCBcImZ4XCIgPT09IGUgJiYgXCJpbnByb2dyZXNzXCIgIT09IG5bMF0gJiYgdy5kZXF1ZXVlKHRoaXMsIGUpO1xuICAgICAgfSk7XG4gICAgfSwgZGVxdWV1ZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICB3LmRlcXVldWUodGhpcywgZSk7XG4gICAgICB9KTtcbiAgICB9LCBjbGVhclF1ZXVlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIHRoaXMucXVldWUoZSB8fCBcImZ4XCIsIFtdKTtcbiAgICB9LCBwcm9taXNlOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgdmFyIG4sXG4gICAgICAgICAgciA9IDEsXG4gICAgICAgICAgaSA9IHcuRGVmZXJyZWQoKSxcbiAgICAgICAgICBvID0gdGhpcyxcbiAgICAgICAgICBhID0gdGhpcy5sZW5ndGgsXG4gICAgICAgICAgcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLS1yIHx8IGkucmVzb2x2ZVdpdGgobywgW29dKTtcbiAgICAgIH07XCJzdHJpbmdcIiAhPSB0eXBlb2YgZSAmJiAodCA9IGUsIGUgPSB2b2lkIDApLCBlID0gZSB8fCBcImZ4XCI7d2hpbGUgKGEtLSkgKG4gPSBKLmdldChvW2FdLCBlICsgXCJxdWV1ZUhvb2tzXCIpKSAmJiBuLmVtcHR5ICYmIChyKyssIG4uZW1wdHkuYWRkKHMpKTtyZXR1cm4gcygpLCBpLnByb21pc2UodCk7XG4gICAgfSB9KTt2YXIgcmUgPSAvWystXT8oPzpcXGQqXFwufClcXGQrKD86W2VFXVsrLV0/XFxkK3wpLy5zb3VyY2UsXG4gICAgICBpZSA9IG5ldyBSZWdFeHAoXCJeKD86KFsrLV0pPXwpKFwiICsgcmUgKyBcIikoW2EteiVdKikkXCIsIFwiaVwiKSxcbiAgICAgIG9lID0gW1wiVG9wXCIsIFwiUmlnaHRcIiwgXCJCb3R0b21cIiwgXCJMZWZ0XCJdLFxuICAgICAgYWUgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgIHJldHVybiBcIm5vbmVcIiA9PT0gKGUgPSB0IHx8IGUpLnN0eWxlLmRpc3BsYXkgfHwgXCJcIiA9PT0gZS5zdHlsZS5kaXNwbGF5ICYmIHcuY29udGFpbnMoZS5vd25lckRvY3VtZW50LCBlKSAmJiBcIm5vbmVcIiA9PT0gdy5jc3MoZSwgXCJkaXNwbGF5XCIpO1xuICB9LFxuICAgICAgc2UgPSBmdW5jdGlvbiAoZSwgdCwgbiwgcikge1xuICAgIHZhciBpLFxuICAgICAgICBvLFxuICAgICAgICBhID0ge307Zm9yIChvIGluIHQpIGFbb10gPSBlLnN0eWxlW29dLCBlLnN0eWxlW29dID0gdFtvXTtpID0gbi5hcHBseShlLCByIHx8IFtdKTtmb3IgKG8gaW4gdCkgZS5zdHlsZVtvXSA9IGFbb107cmV0dXJuIGk7XG4gIH07ZnVuY3Rpb24gdWUoZSwgdCwgbiwgcikge1xuICAgIHZhciBpLFxuICAgICAgICBvLFxuICAgICAgICBhID0gMjAsXG4gICAgICAgIHMgPSByID8gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHIuY3VyKCk7XG4gICAgfSA6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB3LmNzcyhlLCB0LCBcIlwiKTtcbiAgICB9LFxuICAgICAgICB1ID0gcygpLFxuICAgICAgICBsID0gbiAmJiBuWzNdIHx8ICh3LmNzc051bWJlclt0XSA/IFwiXCIgOiBcInB4XCIpLFxuICAgICAgICBjID0gKHcuY3NzTnVtYmVyW3RdIHx8IFwicHhcIiAhPT0gbCAmJiArdSkgJiYgaWUuZXhlYyh3LmNzcyhlLCB0KSk7aWYgKGMgJiYgY1szXSAhPT0gbCkge1xuICAgICAgdSAvPSAyLCBsID0gbCB8fCBjWzNdLCBjID0gK3UgfHwgMTt3aGlsZSAoYS0tKSB3LnN0eWxlKGUsIHQsIGMgKyBsKSwgKDEgLSBvKSAqICgxIC0gKG8gPSBzKCkgLyB1IHx8IC41KSkgPD0gMCAmJiAoYSA9IDApLCBjIC89IG87YyAqPSAyLCB3LnN0eWxlKGUsIHQsIGMgKyBsKSwgbiA9IG4gfHwgW107XG4gICAgfXJldHVybiBuICYmIChjID0gK2MgfHwgK3UgfHwgMCwgaSA9IG5bMV0gPyBjICsgKG5bMV0gKyAxKSAqIG5bMl0gOiArblsyXSwgciAmJiAoci51bml0ID0gbCwgci5zdGFydCA9IGMsIHIuZW5kID0gaSkpLCBpO1xuICB9dmFyIGxlID0ge307ZnVuY3Rpb24gY2UoZSkge1xuICAgIHZhciB0LFxuICAgICAgICBuID0gZS5vd25lckRvY3VtZW50LFxuICAgICAgICByID0gZS5ub2RlTmFtZSxcbiAgICAgICAgaSA9IGxlW3JdO3JldHVybiBpIHx8ICh0ID0gbi5ib2R5LmFwcGVuZENoaWxkKG4uY3JlYXRlRWxlbWVudChyKSksIGkgPSB3LmNzcyh0LCBcImRpc3BsYXlcIiksIHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0KSwgXCJub25lXCIgPT09IGkgJiYgKGkgPSBcImJsb2NrXCIpLCBsZVtyXSA9IGksIGkpO1xuICB9ZnVuY3Rpb24gZmUoZSwgdCkge1xuICAgIGZvciAodmFyIG4sIHIsIGkgPSBbXSwgbyA9IDAsIGEgPSBlLmxlbmd0aDsgbyA8IGE7IG8rKykgKHIgPSBlW29dKS5zdHlsZSAmJiAobiA9IHIuc3R5bGUuZGlzcGxheSwgdCA/IChcIm5vbmVcIiA9PT0gbiAmJiAoaVtvXSA9IEouZ2V0KHIsIFwiZGlzcGxheVwiKSB8fCBudWxsLCBpW29dIHx8IChyLnN0eWxlLmRpc3BsYXkgPSBcIlwiKSksIFwiXCIgPT09IHIuc3R5bGUuZGlzcGxheSAmJiBhZShyKSAmJiAoaVtvXSA9IGNlKHIpKSkgOiBcIm5vbmVcIiAhPT0gbiAmJiAoaVtvXSA9IFwibm9uZVwiLCBKLnNldChyLCBcImRpc3BsYXlcIiwgbikpKTtmb3IgKG8gPSAwOyBvIDwgYTsgbysrKSBudWxsICE9IGlbb10gJiYgKGVbb10uc3R5bGUuZGlzcGxheSA9IGlbb10pO3JldHVybiBlO1xuICB9dy5mbi5leHRlbmQoeyBzaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZmUodGhpcywgITApO1xuICAgIH0sIGhpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBmZSh0aGlzKTtcbiAgICB9LCB0b2dnbGU6IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gXCJib29sZWFuXCIgPT0gdHlwZW9mIGUgPyBlID8gdGhpcy5zaG93KCkgOiB0aGlzLmhpZGUoKSA6IHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFlKHRoaXMpID8gdyh0aGlzKS5zaG93KCkgOiB3KHRoaXMpLmhpZGUoKTtcbiAgICAgIH0pO1xuICAgIH0gfSk7dmFyIHBlID0gL14oPzpjaGVja2JveHxyYWRpbykkL2ksXG4gICAgICBkZSA9IC88KFthLXpdW15cXC9cXDA+XFx4MjBcXHRcXHJcXG5cXGZdKykvaSxcbiAgICAgIGhlID0gL14kfF5tb2R1bGUkfFxcLyg/OmphdmF8ZWNtYSlzY3JpcHQvaSxcbiAgICAgIGdlID0geyBvcHRpb246IFsxLCBcIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz5cIiwgXCI8L3NlbGVjdD5cIl0sIHRoZWFkOiBbMSwgXCI8dGFibGU+XCIsIFwiPC90YWJsZT5cIl0sIGNvbDogWzIsIFwiPHRhYmxlPjxjb2xncm91cD5cIiwgXCI8L2NvbGdyb3VwPjwvdGFibGU+XCJdLCB0cjogWzIsIFwiPHRhYmxlPjx0Ym9keT5cIiwgXCI8L3Rib2R5PjwvdGFibGU+XCJdLCB0ZDogWzMsIFwiPHRhYmxlPjx0Ym9keT48dHI+XCIsIFwiPC90cj48L3Rib2R5PjwvdGFibGU+XCJdLCBfZGVmYXVsdDogWzAsIFwiXCIsIFwiXCJdIH07Z2Uub3B0Z3JvdXAgPSBnZS5vcHRpb24sIGdlLnRib2R5ID0gZ2UudGZvb3QgPSBnZS5jb2xncm91cCA9IGdlLmNhcHRpb24gPSBnZS50aGVhZCwgZ2UudGggPSBnZS50ZDtmdW5jdGlvbiB5ZShlLCB0KSB7XG4gICAgdmFyIG47cmV0dXJuIG4gPSBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBlLmdldEVsZW1lbnRzQnlUYWdOYW1lID8gZS5nZXRFbGVtZW50c0J5VGFnTmFtZSh0IHx8IFwiKlwiKSA6IFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGUucXVlcnlTZWxlY3RvckFsbCA/IGUucXVlcnlTZWxlY3RvckFsbCh0IHx8IFwiKlwiKSA6IFtdLCB2b2lkIDAgPT09IHQgfHwgdCAmJiBOKGUsIHQpID8gdy5tZXJnZShbZV0sIG4pIDogbjtcbiAgfWZ1bmN0aW9uIHZlKGUsIHQpIHtcbiAgICBmb3IgKHZhciBuID0gMCwgciA9IGUubGVuZ3RoOyBuIDwgcjsgbisrKSBKLnNldChlW25dLCBcImdsb2JhbEV2YWxcIiwgIXQgfHwgSi5nZXQodFtuXSwgXCJnbG9iYWxFdmFsXCIpKTtcbiAgfXZhciBtZSA9IC88fCYjP1xcdys7LztmdW5jdGlvbiB4ZShlLCB0LCBuLCByLCBpKSB7XG4gICAgZm9yICh2YXIgbywgYSwgcywgdSwgbCwgYywgZiA9IHQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLCBwID0gW10sIGQgPSAwLCBoID0gZS5sZW5ndGg7IGQgPCBoOyBkKyspIGlmICgobyA9IGVbZF0pIHx8IDAgPT09IG8pIGlmIChcIm9iamVjdFwiID09PSB4KG8pKSB3Lm1lcmdlKHAsIG8ubm9kZVR5cGUgPyBbb10gOiBvKTtlbHNlIGlmIChtZS50ZXN0KG8pKSB7XG4gICAgICBhID0gYSB8fCBmLmFwcGVuZENoaWxkKHQuY3JlYXRlRWxlbWVudChcImRpdlwiKSksIHMgPSAoZGUuZXhlYyhvKSB8fCBbXCJcIiwgXCJcIl0pWzFdLnRvTG93ZXJDYXNlKCksIHUgPSBnZVtzXSB8fCBnZS5fZGVmYXVsdCwgYS5pbm5lckhUTUwgPSB1WzFdICsgdy5odG1sUHJlZmlsdGVyKG8pICsgdVsyXSwgYyA9IHVbMF07d2hpbGUgKGMtLSkgYSA9IGEubGFzdENoaWxkO3cubWVyZ2UocCwgYS5jaGlsZE5vZGVzKSwgKGEgPSBmLmZpcnN0Q2hpbGQpLnRleHRDb250ZW50ID0gXCJcIjtcbiAgICB9IGVsc2UgcC5wdXNoKHQuY3JlYXRlVGV4dE5vZGUobykpO2YudGV4dENvbnRlbnQgPSBcIlwiLCBkID0gMDt3aGlsZSAobyA9IHBbZCsrXSkgaWYgKHIgJiYgdy5pbkFycmF5KG8sIHIpID4gLTEpIGkgJiYgaS5wdXNoKG8pO2Vsc2UgaWYgKGwgPSB3LmNvbnRhaW5zKG8ub3duZXJEb2N1bWVudCwgbyksIGEgPSB5ZShmLmFwcGVuZENoaWxkKG8pLCBcInNjcmlwdFwiKSwgbCAmJiB2ZShhKSwgbikge1xuICAgICAgYyA9IDA7d2hpbGUgKG8gPSBhW2MrK10pIGhlLnRlc3Qoby50eXBlIHx8IFwiXCIpICYmIG4ucHVzaChvKTtcbiAgICB9cmV0dXJuIGY7XG4gIH0hZnVuY3Rpb24gKCkge1xuICAgIHZhciBlID0gci5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkuYXBwZW5kQ2hpbGQoci5jcmVhdGVFbGVtZW50KFwiZGl2XCIpKSxcbiAgICAgICAgdCA9IHIuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO3Quc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInJhZGlvXCIpLCB0LnNldEF0dHJpYnV0ZShcImNoZWNrZWRcIiwgXCJjaGVja2VkXCIpLCB0LnNldEF0dHJpYnV0ZShcIm5hbWVcIiwgXCJ0XCIpLCBlLmFwcGVuZENoaWxkKHQpLCBoLmNoZWNrQ2xvbmUgPSBlLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCwgZS5pbm5lckhUTUwgPSBcIjx0ZXh0YXJlYT54PC90ZXh0YXJlYT5cIiwgaC5ub0Nsb25lQ2hlY2tlZCA9ICEhZS5jbG9uZU5vZGUoITApLmxhc3RDaGlsZC5kZWZhdWx0VmFsdWU7XG4gIH0oKTt2YXIgYmUgPSByLmRvY3VtZW50RWxlbWVudCxcbiAgICAgIHdlID0gL15rZXkvLFxuICAgICAgVGUgPSAvXig/Om1vdXNlfHBvaW50ZXJ8Y29udGV4dG1lbnV8ZHJhZ3xkcm9wKXxjbGljay8sXG4gICAgICBDZSA9IC9eKFteLl0qKSg/OlxcLiguKyl8KS87ZnVuY3Rpb24gRWUoKSB7XG4gICAgcmV0dXJuICEwO1xuICB9ZnVuY3Rpb24ga2UoKSB7XG4gICAgcmV0dXJuICExO1xuICB9ZnVuY3Rpb24gU2UoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiByLmFjdGl2ZUVsZW1lbnQ7XG4gICAgfSBjYXRjaCAoZSkge31cbiAgfWZ1bmN0aW9uIERlKGUsIHQsIG4sIHIsIGksIG8pIHtcbiAgICB2YXIgYSwgcztpZiAoXCJvYmplY3RcIiA9PSB0eXBlb2YgdCkge1xuICAgICAgXCJzdHJpbmdcIiAhPSB0eXBlb2YgbiAmJiAociA9IHIgfHwgbiwgbiA9IHZvaWQgMCk7Zm9yIChzIGluIHQpIERlKGUsIHMsIG4sIHIsIHRbc10sIG8pO3JldHVybiBlO1xuICAgIH1pZiAobnVsbCA9PSByICYmIG51bGwgPT0gaSA/IChpID0gbiwgciA9IG4gPSB2b2lkIDApIDogbnVsbCA9PSBpICYmIChcInN0cmluZ1wiID09IHR5cGVvZiBuID8gKGkgPSByLCByID0gdm9pZCAwKSA6IChpID0gciwgciA9IG4sIG4gPSB2b2lkIDApKSwgITEgPT09IGkpIGkgPSBrZTtlbHNlIGlmICghaSkgcmV0dXJuIGU7cmV0dXJuIDEgPT09IG8gJiYgKGEgPSBpLCAoaSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gdygpLm9mZihlKSwgYS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH0pLmd1aWQgPSBhLmd1aWQgfHwgKGEuZ3VpZCA9IHcuZ3VpZCsrKSksIGUuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICB3LmV2ZW50LmFkZCh0aGlzLCB0LCBpLCByLCBuKTtcbiAgICB9KTtcbiAgfXcuZXZlbnQgPSB7IGdsb2JhbDoge30sIGFkZDogZnVuY3Rpb24gKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgIHZhciBvLFxuICAgICAgICAgIGEsXG4gICAgICAgICAgcyxcbiAgICAgICAgICB1LFxuICAgICAgICAgIGwsXG4gICAgICAgICAgYyxcbiAgICAgICAgICBmLFxuICAgICAgICAgIHAsXG4gICAgICAgICAgZCxcbiAgICAgICAgICBoLFxuICAgICAgICAgIGcsXG4gICAgICAgICAgeSA9IEouZ2V0KGUpO2lmICh5KSB7XG4gICAgICAgIG4uaGFuZGxlciAmJiAobiA9IChvID0gbikuaGFuZGxlciwgaSA9IG8uc2VsZWN0b3IpLCBpICYmIHcuZmluZC5tYXRjaGVzU2VsZWN0b3IoYmUsIGkpLCBuLmd1aWQgfHwgKG4uZ3VpZCA9IHcuZ3VpZCsrKSwgKHUgPSB5LmV2ZW50cykgfHwgKHUgPSB5LmV2ZW50cyA9IHt9KSwgKGEgPSB5LmhhbmRsZSkgfHwgKGEgPSB5LmhhbmRsZSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHcgJiYgdy5ldmVudC50cmlnZ2VyZWQgIT09IHQudHlwZSA/IHcuZXZlbnQuZGlzcGF0Y2guYXBwbHkoZSwgYXJndW1lbnRzKSA6IHZvaWQgMDtcbiAgICAgICAgfSksIGwgPSAodCA9ICh0IHx8IFwiXCIpLm1hdGNoKE0pIHx8IFtcIlwiXSkubGVuZ3RoO3doaWxlIChsLS0pIGQgPSBnID0gKHMgPSBDZS5leGVjKHRbbF0pIHx8IFtdKVsxXSwgaCA9IChzWzJdIHx8IFwiXCIpLnNwbGl0KFwiLlwiKS5zb3J0KCksIGQgJiYgKGYgPSB3LmV2ZW50LnNwZWNpYWxbZF0gfHwge30sIGQgPSAoaSA/IGYuZGVsZWdhdGVUeXBlIDogZi5iaW5kVHlwZSkgfHwgZCwgZiA9IHcuZXZlbnQuc3BlY2lhbFtkXSB8fCB7fSwgYyA9IHcuZXh0ZW5kKHsgdHlwZTogZCwgb3JpZ1R5cGU6IGcsIGRhdGE6IHIsIGhhbmRsZXI6IG4sIGd1aWQ6IG4uZ3VpZCwgc2VsZWN0b3I6IGksIG5lZWRzQ29udGV4dDogaSAmJiB3LmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LnRlc3QoaSksIG5hbWVzcGFjZTogaC5qb2luKFwiLlwiKSB9LCBvKSwgKHAgPSB1W2RdKSB8fCAoKHAgPSB1W2RdID0gW10pLmRlbGVnYXRlQ291bnQgPSAwLCBmLnNldHVwICYmICExICE9PSBmLnNldHVwLmNhbGwoZSwgciwgaCwgYSkgfHwgZS5hZGRFdmVudExpc3RlbmVyICYmIGUuYWRkRXZlbnRMaXN0ZW5lcihkLCBhKSksIGYuYWRkICYmIChmLmFkZC5jYWxsKGUsIGMpLCBjLmhhbmRsZXIuZ3VpZCB8fCAoYy5oYW5kbGVyLmd1aWQgPSBuLmd1aWQpKSwgaSA/IHAuc3BsaWNlKHAuZGVsZWdhdGVDb3VudCsrLCAwLCBjKSA6IHAucHVzaChjKSwgdy5ldmVudC5nbG9iYWxbZF0gPSAhMCk7XG4gICAgICB9XG4gICAgfSwgcmVtb3ZlOiBmdW5jdGlvbiAoZSwgdCwgbiwgciwgaSkge1xuICAgICAgdmFyIG8sXG4gICAgICAgICAgYSxcbiAgICAgICAgICBzLFxuICAgICAgICAgIHUsXG4gICAgICAgICAgbCxcbiAgICAgICAgICBjLFxuICAgICAgICAgIGYsXG4gICAgICAgICAgcCxcbiAgICAgICAgICBkLFxuICAgICAgICAgIGgsXG4gICAgICAgICAgZyxcbiAgICAgICAgICB5ID0gSi5oYXNEYXRhKGUpICYmIEouZ2V0KGUpO2lmICh5ICYmICh1ID0geS5ldmVudHMpKSB7XG4gICAgICAgIGwgPSAodCA9ICh0IHx8IFwiXCIpLm1hdGNoKE0pIHx8IFtcIlwiXSkubGVuZ3RoO3doaWxlIChsLS0pIGlmIChzID0gQ2UuZXhlYyh0W2xdKSB8fCBbXSwgZCA9IGcgPSBzWzFdLCBoID0gKHNbMl0gfHwgXCJcIikuc3BsaXQoXCIuXCIpLnNvcnQoKSwgZCkge1xuICAgICAgICAgIGYgPSB3LmV2ZW50LnNwZWNpYWxbZF0gfHwge30sIHAgPSB1W2QgPSAociA/IGYuZGVsZWdhdGVUeXBlIDogZi5iaW5kVHlwZSkgfHwgZF0gfHwgW10sIHMgPSBzWzJdICYmIG5ldyBSZWdFeHAoXCIoXnxcXFxcLilcIiArIGguam9pbihcIlxcXFwuKD86LipcXFxcLnwpXCIpICsgXCIoXFxcXC58JClcIiksIGEgPSBvID0gcC5sZW5ndGg7d2hpbGUgKG8tLSkgYyA9IHBbb10sICFpICYmIGcgIT09IGMub3JpZ1R5cGUgfHwgbiAmJiBuLmd1aWQgIT09IGMuZ3VpZCB8fCBzICYmICFzLnRlc3QoYy5uYW1lc3BhY2UpIHx8IHIgJiYgciAhPT0gYy5zZWxlY3RvciAmJiAoXCIqKlwiICE9PSByIHx8ICFjLnNlbGVjdG9yKSB8fCAocC5zcGxpY2UobywgMSksIGMuc2VsZWN0b3IgJiYgcC5kZWxlZ2F0ZUNvdW50LS0sIGYucmVtb3ZlICYmIGYucmVtb3ZlLmNhbGwoZSwgYykpO2EgJiYgIXAubGVuZ3RoICYmIChmLnRlYXJkb3duICYmICExICE9PSBmLnRlYXJkb3duLmNhbGwoZSwgaCwgeS5oYW5kbGUpIHx8IHcucmVtb3ZlRXZlbnQoZSwgZCwgeS5oYW5kbGUpLCBkZWxldGUgdVtkXSk7XG4gICAgICAgIH0gZWxzZSBmb3IgKGQgaW4gdSkgdy5ldmVudC5yZW1vdmUoZSwgZCArIHRbbF0sIG4sIHIsICEwKTt3LmlzRW1wdHlPYmplY3QodSkgJiYgSi5yZW1vdmUoZSwgXCJoYW5kbGUgZXZlbnRzXCIpO1xuICAgICAgfVxuICAgIH0sIGRpc3BhdGNoOiBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHQgPSB3LmV2ZW50LmZpeChlKSxcbiAgICAgICAgICBuLFxuICAgICAgICAgIHIsXG4gICAgICAgICAgaSxcbiAgICAgICAgICBvLFxuICAgICAgICAgIGEsXG4gICAgICAgICAgcyxcbiAgICAgICAgICB1ID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGgpLFxuICAgICAgICAgIGwgPSAoSi5nZXQodGhpcywgXCJldmVudHNcIikgfHwge30pW3QudHlwZV0gfHwgW10sXG4gICAgICAgICAgYyA9IHcuZXZlbnQuc3BlY2lhbFt0LnR5cGVdIHx8IHt9O2ZvciAodVswXSA9IHQsIG4gPSAxOyBuIDwgYXJndW1lbnRzLmxlbmd0aDsgbisrKSB1W25dID0gYXJndW1lbnRzW25dO2lmICh0LmRlbGVnYXRlVGFyZ2V0ID0gdGhpcywgIWMucHJlRGlzcGF0Y2ggfHwgITEgIT09IGMucHJlRGlzcGF0Y2guY2FsbCh0aGlzLCB0KSkge1xuICAgICAgICBzID0gdy5ldmVudC5oYW5kbGVycy5jYWxsKHRoaXMsIHQsIGwpLCBuID0gMDt3aGlsZSAoKG8gPSBzW24rK10pICYmICF0LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpIHtcbiAgICAgICAgICB0LmN1cnJlbnRUYXJnZXQgPSBvLmVsZW0sIHIgPSAwO3doaWxlICgoYSA9IG8uaGFuZGxlcnNbcisrXSkgJiYgIXQuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSkgdC5ybmFtZXNwYWNlICYmICF0LnJuYW1lc3BhY2UudGVzdChhLm5hbWVzcGFjZSkgfHwgKHQuaGFuZGxlT2JqID0gYSwgdC5kYXRhID0gYS5kYXRhLCB2b2lkIDAgIT09IChpID0gKCh3LmV2ZW50LnNwZWNpYWxbYS5vcmlnVHlwZV0gfHwge30pLmhhbmRsZSB8fCBhLmhhbmRsZXIpLmFwcGx5KG8uZWxlbSwgdSkpICYmICExID09PSAodC5yZXN1bHQgPSBpKSAmJiAodC5wcmV2ZW50RGVmYXVsdCgpLCB0LnN0b3BQcm9wYWdhdGlvbigpKSk7XG4gICAgICAgIH1yZXR1cm4gYy5wb3N0RGlzcGF0Y2ggJiYgYy5wb3N0RGlzcGF0Y2guY2FsbCh0aGlzLCB0KSwgdC5yZXN1bHQ7XG4gICAgICB9XG4gICAgfSwgaGFuZGxlcnM6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICB2YXIgbixcbiAgICAgICAgICByLFxuICAgICAgICAgIGksXG4gICAgICAgICAgbyxcbiAgICAgICAgICBhLFxuICAgICAgICAgIHMgPSBbXSxcbiAgICAgICAgICB1ID0gdC5kZWxlZ2F0ZUNvdW50LFxuICAgICAgICAgIGwgPSBlLnRhcmdldDtpZiAodSAmJiBsLm5vZGVUeXBlICYmICEoXCJjbGlja1wiID09PSBlLnR5cGUgJiYgZS5idXR0b24gPj0gMSkpIGZvciAoOyBsICE9PSB0aGlzOyBsID0gbC5wYXJlbnROb2RlIHx8IHRoaXMpIGlmICgxID09PSBsLm5vZGVUeXBlICYmIChcImNsaWNrXCIgIT09IGUudHlwZSB8fCAhMCAhPT0gbC5kaXNhYmxlZCkpIHtcbiAgICAgICAgZm9yIChvID0gW10sIGEgPSB7fSwgbiA9IDA7IG4gPCB1OyBuKyspIHZvaWQgMCA9PT0gYVtpID0gKHIgPSB0W25dKS5zZWxlY3RvciArIFwiIFwiXSAmJiAoYVtpXSA9IHIubmVlZHNDb250ZXh0ID8gdyhpLCB0aGlzKS5pbmRleChsKSA+IC0xIDogdy5maW5kKGksIHRoaXMsIG51bGwsIFtsXSkubGVuZ3RoKSwgYVtpXSAmJiBvLnB1c2gocik7by5sZW5ndGggJiYgcy5wdXNoKHsgZWxlbTogbCwgaGFuZGxlcnM6IG8gfSk7XG4gICAgICB9cmV0dXJuIGwgPSB0aGlzLCB1IDwgdC5sZW5ndGggJiYgcy5wdXNoKHsgZWxlbTogbCwgaGFuZGxlcnM6IHQuc2xpY2UodSkgfSksIHM7XG4gICAgfSwgYWRkUHJvcDogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3LkV2ZW50LnByb3RvdHlwZSwgZSwgeyBlbnVtZXJhYmxlOiAhMCwgY29uZmlndXJhYmxlOiAhMCwgZ2V0OiBnKHQpID8gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmICh0aGlzLm9yaWdpbmFsRXZlbnQpIHJldHVybiB0KHRoaXMub3JpZ2luYWxFdmVudCk7XG4gICAgICAgIH0gOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKHRoaXMub3JpZ2luYWxFdmVudCkgcmV0dXJuIHRoaXMub3JpZ2luYWxFdmVudFtlXTtcbiAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiAodCkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBlLCB7IGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwLCB3cml0YWJsZTogITAsIHZhbHVlOiB0IH0pO1xuICAgICAgICB9IH0pO1xuICAgIH0sIGZpeDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBlW3cuZXhwYW5kb10gPyBlIDogbmV3IHcuRXZlbnQoZSk7XG4gICAgfSwgc3BlY2lhbDogeyBsb2FkOiB7IG5vQnViYmxlOiAhMCB9LCBmb2N1czogeyB0cmlnZ2VyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKHRoaXMgIT09IFNlKCkgJiYgdGhpcy5mb2N1cykgcmV0dXJuIHRoaXMuZm9jdXMoKSwgITE7XG4gICAgICAgIH0sIGRlbGVnYXRlVHlwZTogXCJmb2N1c2luXCIgfSwgYmx1cjogeyB0cmlnZ2VyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKHRoaXMgPT09IFNlKCkgJiYgdGhpcy5ibHVyKSByZXR1cm4gdGhpcy5ibHVyKCksICExO1xuICAgICAgICB9LCBkZWxlZ2F0ZVR5cGU6IFwiZm9jdXNvdXRcIiB9LCBjbGljazogeyB0cmlnZ2VyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKFwiY2hlY2tib3hcIiA9PT0gdGhpcy50eXBlICYmIHRoaXMuY2xpY2sgJiYgTih0aGlzLCBcImlucHV0XCIpKSByZXR1cm4gdGhpcy5jbGljaygpLCAhMTtcbiAgICAgICAgfSwgX2RlZmF1bHQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgcmV0dXJuIE4oZS50YXJnZXQsIFwiYVwiKTtcbiAgICAgICAgfSB9LCBiZWZvcmV1bmxvYWQ6IHsgcG9zdERpc3BhdGNoOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHZvaWQgMCAhPT0gZS5yZXN1bHQgJiYgZS5vcmlnaW5hbEV2ZW50ICYmIChlLm9yaWdpbmFsRXZlbnQucmV0dXJuVmFsdWUgPSBlLnJlc3VsdCk7XG4gICAgICAgIH0gfSB9IH0sIHcucmVtb3ZlRXZlbnQgPSBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgIGUucmVtb3ZlRXZlbnRMaXN0ZW5lciAmJiBlLnJlbW92ZUV2ZW50TGlzdGVuZXIodCwgbik7XG4gIH0sIHcuRXZlbnQgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiB3LkV2ZW50KSkgcmV0dXJuIG5ldyB3LkV2ZW50KGUsIHQpO2UgJiYgZS50eXBlID8gKHRoaXMub3JpZ2luYWxFdmVudCA9IGUsIHRoaXMudHlwZSA9IGUudHlwZSwgdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSBlLmRlZmF1bHRQcmV2ZW50ZWQgfHwgdm9pZCAwID09PSBlLmRlZmF1bHRQcmV2ZW50ZWQgJiYgITEgPT09IGUucmV0dXJuVmFsdWUgPyBFZSA6IGtlLCB0aGlzLnRhcmdldCA9IGUudGFyZ2V0ICYmIDMgPT09IGUudGFyZ2V0Lm5vZGVUeXBlID8gZS50YXJnZXQucGFyZW50Tm9kZSA6IGUudGFyZ2V0LCB0aGlzLmN1cnJlbnRUYXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQsIHRoaXMucmVsYXRlZFRhcmdldCA9IGUucmVsYXRlZFRhcmdldCkgOiB0aGlzLnR5cGUgPSBlLCB0ICYmIHcuZXh0ZW5kKHRoaXMsIHQpLCB0aGlzLnRpbWVTdGFtcCA9IGUgJiYgZS50aW1lU3RhbXAgfHwgRGF0ZS5ub3coKSwgdGhpc1t3LmV4cGFuZG9dID0gITA7XG4gIH0sIHcuRXZlbnQucHJvdG90eXBlID0geyBjb25zdHJ1Y3Rvcjogdy5FdmVudCwgaXNEZWZhdWx0UHJldmVudGVkOiBrZSwgaXNQcm9wYWdhdGlvblN0b3BwZWQ6IGtlLCBpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDoga2UsIGlzU2ltdWxhdGVkOiAhMSwgcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50O3RoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gRWUsIGUgJiYgIXRoaXMuaXNTaW11bGF0ZWQgJiYgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0sIHN0b3BQcm9wYWdhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGUgPSB0aGlzLm9yaWdpbmFsRXZlbnQ7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IEVlLCBlICYmICF0aGlzLmlzU2ltdWxhdGVkICYmIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfSwgc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDt0aGlzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gRWUsIGUgJiYgIXRoaXMuaXNTaW11bGF0ZWQgJiYgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSwgdGhpcy5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9IH0sIHcuZWFjaCh7IGFsdEtleTogITAsIGJ1YmJsZXM6ICEwLCBjYW5jZWxhYmxlOiAhMCwgY2hhbmdlZFRvdWNoZXM6ICEwLCBjdHJsS2V5OiAhMCwgZGV0YWlsOiAhMCwgZXZlbnRQaGFzZTogITAsIG1ldGFLZXk6ICEwLCBwYWdlWDogITAsIHBhZ2VZOiAhMCwgc2hpZnRLZXk6ICEwLCB2aWV3OiAhMCwgXCJjaGFyXCI6ICEwLCBjaGFyQ29kZTogITAsIGtleTogITAsIGtleUNvZGU6ICEwLCBidXR0b246ICEwLCBidXR0b25zOiAhMCwgY2xpZW50WDogITAsIGNsaWVudFk6ICEwLCBvZmZzZXRYOiAhMCwgb2Zmc2V0WTogITAsIHBvaW50ZXJJZDogITAsIHBvaW50ZXJUeXBlOiAhMCwgc2NyZWVuWDogITAsIHNjcmVlblk6ICEwLCB0YXJnZXRUb3VjaGVzOiAhMCwgdG9FbGVtZW50OiAhMCwgdG91Y2hlczogITAsIHdoaWNoOiBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHQgPSBlLmJ1dHRvbjtyZXR1cm4gbnVsbCA9PSBlLndoaWNoICYmIHdlLnRlc3QoZS50eXBlKSA/IG51bGwgIT0gZS5jaGFyQ29kZSA/IGUuY2hhckNvZGUgOiBlLmtleUNvZGUgOiAhZS53aGljaCAmJiB2b2lkIDAgIT09IHQgJiYgVGUudGVzdChlLnR5cGUpID8gMSAmIHQgPyAxIDogMiAmIHQgPyAzIDogNCAmIHQgPyAyIDogMCA6IGUud2hpY2g7XG4gICAgfSB9LCB3LmV2ZW50LmFkZFByb3ApLCB3LmVhY2goeyBtb3VzZWVudGVyOiBcIm1vdXNlb3ZlclwiLCBtb3VzZWxlYXZlOiBcIm1vdXNlb3V0XCIsIHBvaW50ZXJlbnRlcjogXCJwb2ludGVyb3ZlclwiLCBwb2ludGVybGVhdmU6IFwicG9pbnRlcm91dFwiIH0sIGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgdy5ldmVudC5zcGVjaWFsW2VdID0geyBkZWxlZ2F0ZVR5cGU6IHQsIGJpbmRUeXBlOiB0LCBoYW5kbGU6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBuLFxuICAgICAgICAgICAgciA9IHRoaXMsXG4gICAgICAgICAgICBpID0gZS5yZWxhdGVkVGFyZ2V0LFxuICAgICAgICAgICAgbyA9IGUuaGFuZGxlT2JqO3JldHVybiBpICYmIChpID09PSByIHx8IHcuY29udGFpbnMociwgaSkpIHx8IChlLnR5cGUgPSBvLm9yaWdUeXBlLCBuID0gby5oYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIGUudHlwZSA9IHQpLCBuO1xuICAgICAgfSB9O1xuICB9KSwgdy5mbi5leHRlbmQoeyBvbjogZnVuY3Rpb24gKGUsIHQsIG4sIHIpIHtcbiAgICAgIHJldHVybiBEZSh0aGlzLCBlLCB0LCBuLCByKTtcbiAgICB9LCBvbmU6IGZ1bmN0aW9uIChlLCB0LCBuLCByKSB7XG4gICAgICByZXR1cm4gRGUodGhpcywgZSwgdCwgbiwgciwgMSk7XG4gICAgfSwgb2ZmOiBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgdmFyIHIsIGk7aWYgKGUgJiYgZS5wcmV2ZW50RGVmYXVsdCAmJiBlLmhhbmRsZU9iaikgcmV0dXJuIHIgPSBlLmhhbmRsZU9iaiwgdyhlLmRlbGVnYXRlVGFyZ2V0KS5vZmYoci5uYW1lc3BhY2UgPyByLm9yaWdUeXBlICsgXCIuXCIgKyByLm5hbWVzcGFjZSA6IHIub3JpZ1R5cGUsIHIuc2VsZWN0b3IsIHIuaGFuZGxlciksIHRoaXM7aWYgKFwib2JqZWN0XCIgPT0gdHlwZW9mIGUpIHtcbiAgICAgICAgZm9yIChpIGluIGUpIHRoaXMub2ZmKGksIHQsIGVbaV0pO3JldHVybiB0aGlzO1xuICAgICAgfXJldHVybiAhMSAhPT0gdCAmJiBcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIHQgfHwgKG4gPSB0LCB0ID0gdm9pZCAwKSwgITEgPT09IG4gJiYgKG4gPSBrZSksIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHcuZXZlbnQucmVtb3ZlKHRoaXMsIGUsIG4sIHQpO1xuICAgICAgfSk7XG4gICAgfSB9KTt2YXIgTmUgPSAvPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbYS16XVteXFwvXFwwPlxceDIwXFx0XFxyXFxuXFxmXSopW14+XSopXFwvPi9naSxcbiAgICAgIEFlID0gLzxzY3JpcHR8PHN0eWxlfDxsaW5rL2ksXG4gICAgICBqZSA9IC9jaGVja2VkXFxzKig/OltePV18PVxccyouY2hlY2tlZC4pL2ksXG4gICAgICBxZSA9IC9eXFxzKjwhKD86XFxbQ0RBVEFcXFt8LS0pfCg/OlxcXVxcXXwtLSk+XFxzKiQvZztmdW5jdGlvbiBMZShlLCB0KSB7XG4gICAgcmV0dXJuIE4oZSwgXCJ0YWJsZVwiKSAmJiBOKDExICE9PSB0Lm5vZGVUeXBlID8gdCA6IHQuZmlyc3RDaGlsZCwgXCJ0clwiKSA/IHcoZSkuY2hpbGRyZW4oXCJ0Ym9keVwiKVswXSB8fCBlIDogZTtcbiAgfWZ1bmN0aW9uIEhlKGUpIHtcbiAgICByZXR1cm4gZS50eXBlID0gKG51bGwgIT09IGUuZ2V0QXR0cmlidXRlKFwidHlwZVwiKSkgKyBcIi9cIiArIGUudHlwZSwgZTtcbiAgfWZ1bmN0aW9uIE9lKGUpIHtcbiAgICByZXR1cm4gXCJ0cnVlL1wiID09PSAoZS50eXBlIHx8IFwiXCIpLnNsaWNlKDAsIDUpID8gZS50eXBlID0gZS50eXBlLnNsaWNlKDUpIDogZS5yZW1vdmVBdHRyaWJ1dGUoXCJ0eXBlXCIpLCBlO1xuICB9ZnVuY3Rpb24gUGUoZSwgdCkge1xuICAgIHZhciBuLCByLCBpLCBvLCBhLCBzLCB1LCBsO2lmICgxID09PSB0Lm5vZGVUeXBlKSB7XG4gICAgICBpZiAoSi5oYXNEYXRhKGUpICYmIChvID0gSi5hY2Nlc3MoZSksIGEgPSBKLnNldCh0LCBvKSwgbCA9IG8uZXZlbnRzKSkge1xuICAgICAgICBkZWxldGUgYS5oYW5kbGUsIGEuZXZlbnRzID0ge307Zm9yIChpIGluIGwpIGZvciAobiA9IDAsIHIgPSBsW2ldLmxlbmd0aDsgbiA8IHI7IG4rKykgdy5ldmVudC5hZGQodCwgaSwgbFtpXVtuXSk7XG4gICAgICB9Sy5oYXNEYXRhKGUpICYmIChzID0gSy5hY2Nlc3MoZSksIHUgPSB3LmV4dGVuZCh7fSwgcyksIEsuc2V0KHQsIHUpKTtcbiAgICB9XG4gIH1mdW5jdGlvbiBNZShlLCB0KSB7XG4gICAgdmFyIG4gPSB0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XCJpbnB1dFwiID09PSBuICYmIHBlLnRlc3QoZS50eXBlKSA/IHQuY2hlY2tlZCA9IGUuY2hlY2tlZCA6IFwiaW5wdXRcIiAhPT0gbiAmJiBcInRleHRhcmVhXCIgIT09IG4gfHwgKHQuZGVmYXVsdFZhbHVlID0gZS5kZWZhdWx0VmFsdWUpO1xuICB9ZnVuY3Rpb24gUmUoZSwgdCwgbiwgcikge1xuICAgIHQgPSBhLmFwcGx5KFtdLCB0KTt2YXIgaSxcbiAgICAgICAgbyxcbiAgICAgICAgcyxcbiAgICAgICAgdSxcbiAgICAgICAgbCxcbiAgICAgICAgYyxcbiAgICAgICAgZiA9IDAsXG4gICAgICAgIHAgPSBlLmxlbmd0aCxcbiAgICAgICAgZCA9IHAgLSAxLFxuICAgICAgICB5ID0gdFswXSxcbiAgICAgICAgdiA9IGcoeSk7aWYgKHYgfHwgcCA+IDEgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2YgeSAmJiAhaC5jaGVja0Nsb25lICYmIGplLnRlc3QoeSkpIHJldHVybiBlLmVhY2goZnVuY3Rpb24gKGkpIHtcbiAgICAgIHZhciBvID0gZS5lcShpKTt2ICYmICh0WzBdID0geS5jYWxsKHRoaXMsIGksIG8uaHRtbCgpKSksIFJlKG8sIHQsIG4sIHIpO1xuICAgIH0pO2lmIChwICYmIChpID0geGUodCwgZVswXS5vd25lckRvY3VtZW50LCAhMSwgZSwgciksIG8gPSBpLmZpcnN0Q2hpbGQsIDEgPT09IGkuY2hpbGROb2Rlcy5sZW5ndGggJiYgKGkgPSBvKSwgbyB8fCByKSkge1xuICAgICAgZm9yICh1ID0gKHMgPSB3Lm1hcCh5ZShpLCBcInNjcmlwdFwiKSwgSGUpKS5sZW5ndGg7IGYgPCBwOyBmKyspIGwgPSBpLCBmICE9PSBkICYmIChsID0gdy5jbG9uZShsLCAhMCwgITApLCB1ICYmIHcubWVyZ2UocywgeWUobCwgXCJzY3JpcHRcIikpKSwgbi5jYWxsKGVbZl0sIGwsIGYpO2lmICh1KSBmb3IgKGMgPSBzW3MubGVuZ3RoIC0gMV0ub3duZXJEb2N1bWVudCwgdy5tYXAocywgT2UpLCBmID0gMDsgZiA8IHU7IGYrKykgbCA9IHNbZl0sIGhlLnRlc3QobC50eXBlIHx8IFwiXCIpICYmICFKLmFjY2VzcyhsLCBcImdsb2JhbEV2YWxcIikgJiYgdy5jb250YWlucyhjLCBsKSAmJiAobC5zcmMgJiYgXCJtb2R1bGVcIiAhPT0gKGwudHlwZSB8fCBcIlwiKS50b0xvd2VyQ2FzZSgpID8gdy5fZXZhbFVybCAmJiB3Ll9ldmFsVXJsKGwuc3JjKSA6IG0obC50ZXh0Q29udGVudC5yZXBsYWNlKHFlLCBcIlwiKSwgYywgbCkpO1xuICAgIH1yZXR1cm4gZTtcbiAgfWZ1bmN0aW9uIEllKGUsIHQsIG4pIHtcbiAgICBmb3IgKHZhciByLCBpID0gdCA/IHcuZmlsdGVyKHQsIGUpIDogZSwgbyA9IDA7IG51bGwgIT0gKHIgPSBpW29dKTsgbysrKSBuIHx8IDEgIT09IHIubm9kZVR5cGUgfHwgdy5jbGVhbkRhdGEoeWUocikpLCByLnBhcmVudE5vZGUgJiYgKG4gJiYgdy5jb250YWlucyhyLm93bmVyRG9jdW1lbnQsIHIpICYmIHZlKHllKHIsIFwic2NyaXB0XCIpKSwgci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHIpKTtyZXR1cm4gZTtcbiAgfXcuZXh0ZW5kKHsgaHRtbFByZWZpbHRlcjogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBlLnJlcGxhY2UoTmUsIFwiPCQxPjwvJDI+XCIpO1xuICAgIH0sIGNsb25lOiBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgdmFyIHIsXG4gICAgICAgICAgaSxcbiAgICAgICAgICBvLFxuICAgICAgICAgIGEsXG4gICAgICAgICAgcyA9IGUuY2xvbmVOb2RlKCEwKSxcbiAgICAgICAgICB1ID0gdy5jb250YWlucyhlLm93bmVyRG9jdW1lbnQsIGUpO2lmICghKGgubm9DbG9uZUNoZWNrZWQgfHwgMSAhPT0gZS5ub2RlVHlwZSAmJiAxMSAhPT0gZS5ub2RlVHlwZSB8fCB3LmlzWE1MRG9jKGUpKSkgZm9yIChhID0geWUocyksIHIgPSAwLCBpID0gKG8gPSB5ZShlKSkubGVuZ3RoOyByIDwgaTsgcisrKSBNZShvW3JdLCBhW3JdKTtpZiAodCkgaWYgKG4pIGZvciAobyA9IG8gfHwgeWUoZSksIGEgPSBhIHx8IHllKHMpLCByID0gMCwgaSA9IG8ubGVuZ3RoOyByIDwgaTsgcisrKSBQZShvW3JdLCBhW3JdKTtlbHNlIFBlKGUsIHMpO3JldHVybiAoYSA9IHllKHMsIFwic2NyaXB0XCIpKS5sZW5ndGggPiAwICYmIHZlKGEsICF1ICYmIHllKGUsIFwic2NyaXB0XCIpKSwgcztcbiAgICB9LCBjbGVhbkRhdGE6IGZ1bmN0aW9uIChlKSB7XG4gICAgICBmb3IgKHZhciB0LCBuLCByLCBpID0gdy5ldmVudC5zcGVjaWFsLCBvID0gMDsgdm9pZCAwICE9PSAobiA9IGVbb10pOyBvKyspIGlmIChZKG4pKSB7XG4gICAgICAgIGlmICh0ID0gbltKLmV4cGFuZG9dKSB7XG4gICAgICAgICAgaWYgKHQuZXZlbnRzKSBmb3IgKHIgaW4gdC5ldmVudHMpIGlbcl0gPyB3LmV2ZW50LnJlbW92ZShuLCByKSA6IHcucmVtb3ZlRXZlbnQobiwgciwgdC5oYW5kbGUpO25bSi5leHBhbmRvXSA9IHZvaWQgMDtcbiAgICAgICAgfW5bSy5leHBhbmRvXSAmJiAobltLLmV4cGFuZG9dID0gdm9pZCAwKTtcbiAgICAgIH1cbiAgICB9IH0pLCB3LmZuLmV4dGVuZCh7IGRldGFjaDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBJZSh0aGlzLCBlLCAhMCk7XG4gICAgfSwgcmVtb3ZlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIEllKHRoaXMsIGUpO1xuICAgIH0sIHRleHQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4geih0aGlzLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICByZXR1cm4gdm9pZCAwID09PSBlID8gdy50ZXh0KHRoaXMpIDogdGhpcy5lbXB0eSgpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgIDEgIT09IHRoaXMubm9kZVR5cGUgJiYgMTEgIT09IHRoaXMubm9kZVR5cGUgJiYgOSAhPT0gdGhpcy5ub2RlVHlwZSB8fCAodGhpcy50ZXh0Q29udGVudCA9IGUpO1xuICAgICAgICB9KTtcbiAgICAgIH0sIG51bGwsIGUsIGFyZ3VtZW50cy5sZW5ndGgpO1xuICAgIH0sIGFwcGVuZDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFJlKHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgMSAhPT0gdGhpcy5ub2RlVHlwZSAmJiAxMSAhPT0gdGhpcy5ub2RlVHlwZSAmJiA5ICE9PSB0aGlzLm5vZGVUeXBlIHx8IExlKHRoaXMsIGUpLmFwcGVuZENoaWxkKGUpO1xuICAgICAgfSk7XG4gICAgfSwgcHJlcGVuZDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFJlKHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKDEgPT09IHRoaXMubm9kZVR5cGUgfHwgMTEgPT09IHRoaXMubm9kZVR5cGUgfHwgOSA9PT0gdGhpcy5ub2RlVHlwZSkge1xuICAgICAgICAgIHZhciB0ID0gTGUodGhpcywgZSk7dC5pbnNlcnRCZWZvcmUoZSwgdC5maXJzdENoaWxkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSwgYmVmb3JlOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gUmUodGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aGlzLnBhcmVudE5vZGUgJiYgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLCB0aGlzKTtcbiAgICAgIH0pO1xuICAgIH0sIGFmdGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gUmUodGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aGlzLnBhcmVudE5vZGUgJiYgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLCB0aGlzLm5leHRTaWJsaW5nKTtcbiAgICAgIH0pO1xuICAgIH0sIGVtcHR5OiBmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKHZhciBlLCB0ID0gMDsgbnVsbCAhPSAoZSA9IHRoaXNbdF0pOyB0KyspIDEgPT09IGUubm9kZVR5cGUgJiYgKHcuY2xlYW5EYXRhKHllKGUsICExKSksIGUudGV4dENvbnRlbnQgPSBcIlwiKTtyZXR1cm4gdGhpcztcbiAgICB9LCBjbG9uZTogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIHJldHVybiBlID0gbnVsbCAhPSBlICYmIGUsIHQgPSBudWxsID09IHQgPyBlIDogdCwgdGhpcy5tYXAoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdy5jbG9uZSh0aGlzLCBlLCB0KTtcbiAgICAgIH0pO1xuICAgIH0sIGh0bWw6IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4geih0aGlzLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdCA9IHRoaXNbMF0gfHwge30sXG4gICAgICAgICAgICBuID0gMCxcbiAgICAgICAgICAgIHIgPSB0aGlzLmxlbmd0aDtpZiAodm9pZCAwID09PSBlICYmIDEgPT09IHQubm9kZVR5cGUpIHJldHVybiB0LmlubmVySFRNTDtpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSAmJiAhQWUudGVzdChlKSAmJiAhZ2VbKGRlLmV4ZWMoZSkgfHwgW1wiXCIsIFwiXCJdKVsxXS50b0xvd2VyQ2FzZSgpXSkge1xuICAgICAgICAgIGUgPSB3Lmh0bWxQcmVmaWx0ZXIoZSk7dHJ5IHtcbiAgICAgICAgICAgIGZvciAoOyBuIDwgcjsgbisrKSAxID09PSAodCA9IHRoaXNbbl0gfHwge30pLm5vZGVUeXBlICYmICh3LmNsZWFuRGF0YSh5ZSh0LCAhMSkpLCB0LmlubmVySFRNTCA9IGUpO3QgPSAwO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9XG4gICAgICAgIH10ICYmIHRoaXMuZW1wdHkoKS5hcHBlbmQoZSk7XG4gICAgICB9LCBudWxsLCBlLCBhcmd1bWVudHMubGVuZ3RoKTtcbiAgICB9LCByZXBsYWNlV2l0aDogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGUgPSBbXTtyZXR1cm4gUmUodGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbiAodCkge1xuICAgICAgICB2YXIgbiA9IHRoaXMucGFyZW50Tm9kZTt3LmluQXJyYXkodGhpcywgZSkgPCAwICYmICh3LmNsZWFuRGF0YSh5ZSh0aGlzKSksIG4gJiYgbi5yZXBsYWNlQ2hpbGQodCwgdGhpcykpO1xuICAgICAgfSwgZSk7XG4gICAgfSB9KSwgdy5lYWNoKHsgYXBwZW5kVG86IFwiYXBwZW5kXCIsIHByZXBlbmRUbzogXCJwcmVwZW5kXCIsIGluc2VydEJlZm9yZTogXCJiZWZvcmVcIiwgaW5zZXJ0QWZ0ZXI6IFwiYWZ0ZXJcIiwgcmVwbGFjZUFsbDogXCJyZXBsYWNlV2l0aFwiIH0sIGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgdy5mbltlXSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBmb3IgKHZhciBuLCByID0gW10sIGkgPSB3KGUpLCBvID0gaS5sZW5ndGggLSAxLCBhID0gMDsgYSA8PSBvOyBhKyspIG4gPSBhID09PSBvID8gdGhpcyA6IHRoaXMuY2xvbmUoITApLCB3KGlbYV0pW3RdKG4pLCBzLmFwcGx5KHIsIG4uZ2V0KCkpO3JldHVybiB0aGlzLnB1c2hTdGFjayhyKTtcbiAgICB9O1xuICB9KTt2YXIgV2UgPSBuZXcgUmVnRXhwKFwiXihcIiArIHJlICsgXCIpKD8hcHgpW2EteiVdKyRcIiwgXCJpXCIpLFxuICAgICAgJGUgPSBmdW5jdGlvbiAodCkge1xuICAgIHZhciBuID0gdC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3O3JldHVybiBuICYmIG4ub3BlbmVyIHx8IChuID0gZSksIG4uZ2V0Q29tcHV0ZWRTdHlsZSh0KTtcbiAgfSxcbiAgICAgIEJlID0gbmV3IFJlZ0V4cChvZS5qb2luKFwifFwiKSwgXCJpXCIpOyFmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gdCgpIHtcbiAgICAgIGlmIChjKSB7XG4gICAgICAgIGwuc3R5bGUuY3NzVGV4dCA9IFwicG9zaXRpb246YWJzb2x1dGU7bGVmdDotMTExMTFweDt3aWR0aDo2MHB4O21hcmdpbi10b3A6MXB4O3BhZGRpbmc6MDtib3JkZXI6MFwiLCBjLnN0eWxlLmNzc1RleHQgPSBcInBvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6YmxvY2s7Ym94LXNpemluZzpib3JkZXItYm94O292ZXJmbG93OnNjcm9sbDttYXJnaW46YXV0bztib3JkZXI6MXB4O3BhZGRpbmc6MXB4O3dpZHRoOjYwJTt0b3A6MSVcIiwgYmUuYXBwZW5kQ2hpbGQobCkuYXBwZW5kQ2hpbGQoYyk7dmFyIHQgPSBlLmdldENvbXB1dGVkU3R5bGUoYyk7aSA9IFwiMSVcIiAhPT0gdC50b3AsIHUgPSAxMiA9PT0gbih0Lm1hcmdpbkxlZnQpLCBjLnN0eWxlLnJpZ2h0ID0gXCI2MCVcIiwgcyA9IDM2ID09PSBuKHQucmlnaHQpLCBvID0gMzYgPT09IG4odC53aWR0aCksIGMuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCIsIGEgPSAzNiA9PT0gYy5vZmZzZXRXaWR0aCB8fCBcImFic29sdXRlXCIsIGJlLnJlbW92ZUNoaWxkKGwpLCBjID0gbnVsbDtcbiAgICAgIH1cbiAgICB9ZnVuY3Rpb24gbihlKSB7XG4gICAgICByZXR1cm4gTWF0aC5yb3VuZChwYXJzZUZsb2F0KGUpKTtcbiAgICB9dmFyIGksXG4gICAgICAgIG8sXG4gICAgICAgIGEsXG4gICAgICAgIHMsXG4gICAgICAgIHUsXG4gICAgICAgIGwgPSByLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksXG4gICAgICAgIGMgPSByLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7Yy5zdHlsZSAmJiAoYy5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9IFwiY29udGVudC1ib3hcIiwgYy5jbG9uZU5vZGUoITApLnN0eWxlLmJhY2tncm91bmRDbGlwID0gXCJcIiwgaC5jbGVhckNsb25lU3R5bGUgPSBcImNvbnRlbnQtYm94XCIgPT09IGMuc3R5bGUuYmFja2dyb3VuZENsaXAsIHcuZXh0ZW5kKGgsIHsgYm94U2l6aW5nUmVsaWFibGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHQoKSwgbztcbiAgICAgIH0sIHBpeGVsQm94U3R5bGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0KCksIHM7XG4gICAgICB9LCBwaXhlbFBvc2l0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0KCksIGk7XG4gICAgICB9LCByZWxpYWJsZU1hcmdpbkxlZnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHQoKSwgdTtcbiAgICAgIH0sIHNjcm9sbGJveFNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHQoKSwgYTtcbiAgICAgIH0gfSkpO1xuICB9KCk7ZnVuY3Rpb24gRmUoZSwgdCwgbikge1xuICAgIHZhciByLFxuICAgICAgICBpLFxuICAgICAgICBvLFxuICAgICAgICBhLFxuICAgICAgICBzID0gZS5zdHlsZTtyZXR1cm4gKG4gPSBuIHx8ICRlKGUpKSAmJiAoXCJcIiAhPT0gKGEgPSBuLmdldFByb3BlcnR5VmFsdWUodCkgfHwgblt0XSkgfHwgdy5jb250YWlucyhlLm93bmVyRG9jdW1lbnQsIGUpIHx8IChhID0gdy5zdHlsZShlLCB0KSksICFoLnBpeGVsQm94U3R5bGVzKCkgJiYgV2UudGVzdChhKSAmJiBCZS50ZXN0KHQpICYmIChyID0gcy53aWR0aCwgaSA9IHMubWluV2lkdGgsIG8gPSBzLm1heFdpZHRoLCBzLm1pbldpZHRoID0gcy5tYXhXaWR0aCA9IHMud2lkdGggPSBhLCBhID0gbi53aWR0aCwgcy53aWR0aCA9IHIsIHMubWluV2lkdGggPSBpLCBzLm1heFdpZHRoID0gbykpLCB2b2lkIDAgIT09IGEgPyBhICsgXCJcIiA6IGE7XG4gIH1mdW5jdGlvbiBfZShlLCB0KSB7XG4gICAgcmV0dXJuIHsgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghZSgpKSByZXR1cm4gKHRoaXMuZ2V0ID0gdCkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtkZWxldGUgdGhpcy5nZXQ7XG4gICAgICB9IH07XG4gIH12YXIgemUgPSAvXihub25lfHRhYmxlKD8hLWNbZWFdKS4rKS8sXG4gICAgICBYZSA9IC9eLS0vLFxuICAgICAgVWUgPSB7IHBvc2l0aW9uOiBcImFic29sdXRlXCIsIHZpc2liaWxpdHk6IFwiaGlkZGVuXCIsIGRpc3BsYXk6IFwiYmxvY2tcIiB9LFxuICAgICAgVmUgPSB7IGxldHRlclNwYWNpbmc6IFwiMFwiLCBmb250V2VpZ2h0OiBcIjQwMFwiIH0sXG4gICAgICBHZSA9IFtcIldlYmtpdFwiLCBcIk1velwiLCBcIm1zXCJdLFxuICAgICAgWWUgPSByLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIikuc3R5bGU7ZnVuY3Rpb24gUWUoZSkge1xuICAgIGlmIChlIGluIFllKSByZXR1cm4gZTt2YXIgdCA9IGVbMF0udG9VcHBlckNhc2UoKSArIGUuc2xpY2UoMSksXG4gICAgICAgIG4gPSBHZS5sZW5ndGg7d2hpbGUgKG4tLSkgaWYgKChlID0gR2Vbbl0gKyB0KSBpbiBZZSkgcmV0dXJuIGU7XG4gIH1mdW5jdGlvbiBKZShlKSB7XG4gICAgdmFyIHQgPSB3LmNzc1Byb3BzW2VdO3JldHVybiB0IHx8ICh0ID0gdy5jc3NQcm9wc1tlXSA9IFFlKGUpIHx8IGUpLCB0O1xuICB9ZnVuY3Rpb24gS2UoZSwgdCwgbikge1xuICAgIHZhciByID0gaWUuZXhlYyh0KTtyZXR1cm4gciA/IE1hdGgubWF4KDAsIHJbMl0gLSAobiB8fCAwKSkgKyAoclszXSB8fCBcInB4XCIpIDogdDtcbiAgfWZ1bmN0aW9uIFplKGUsIHQsIG4sIHIsIGksIG8pIHtcbiAgICB2YXIgYSA9IFwid2lkdGhcIiA9PT0gdCA/IDEgOiAwLFxuICAgICAgICBzID0gMCxcbiAgICAgICAgdSA9IDA7aWYgKG4gPT09IChyID8gXCJib3JkZXJcIiA6IFwiY29udGVudFwiKSkgcmV0dXJuIDA7Zm9yICg7IGEgPCA0OyBhICs9IDIpIFwibWFyZ2luXCIgPT09IG4gJiYgKHUgKz0gdy5jc3MoZSwgbiArIG9lW2FdLCAhMCwgaSkpLCByID8gKFwiY29udGVudFwiID09PSBuICYmICh1IC09IHcuY3NzKGUsIFwicGFkZGluZ1wiICsgb2VbYV0sICEwLCBpKSksIFwibWFyZ2luXCIgIT09IG4gJiYgKHUgLT0gdy5jc3MoZSwgXCJib3JkZXJcIiArIG9lW2FdICsgXCJXaWR0aFwiLCAhMCwgaSkpKSA6ICh1ICs9IHcuY3NzKGUsIFwicGFkZGluZ1wiICsgb2VbYV0sICEwLCBpKSwgXCJwYWRkaW5nXCIgIT09IG4gPyB1ICs9IHcuY3NzKGUsIFwiYm9yZGVyXCIgKyBvZVthXSArIFwiV2lkdGhcIiwgITAsIGkpIDogcyArPSB3LmNzcyhlLCBcImJvcmRlclwiICsgb2VbYV0gKyBcIldpZHRoXCIsICEwLCBpKSk7cmV0dXJuICFyICYmIG8gPj0gMCAmJiAodSArPSBNYXRoLm1heCgwLCBNYXRoLmNlaWwoZVtcIm9mZnNldFwiICsgdFswXS50b1VwcGVyQ2FzZSgpICsgdC5zbGljZSgxKV0gLSBvIC0gdSAtIHMgLSAuNSkpKSwgdTtcbiAgfWZ1bmN0aW9uIGV0KGUsIHQsIG4pIHtcbiAgICB2YXIgciA9ICRlKGUpLFxuICAgICAgICBpID0gRmUoZSwgdCwgciksXG4gICAgICAgIG8gPSBcImJvcmRlci1ib3hcIiA9PT0gdy5jc3MoZSwgXCJib3hTaXppbmdcIiwgITEsIHIpLFxuICAgICAgICBhID0gbztpZiAoV2UudGVzdChpKSkge1xuICAgICAgaWYgKCFuKSByZXR1cm4gaTtpID0gXCJhdXRvXCI7XG4gICAgfXJldHVybiBhID0gYSAmJiAoaC5ib3hTaXppbmdSZWxpYWJsZSgpIHx8IGkgPT09IGUuc3R5bGVbdF0pLCAoXCJhdXRvXCIgPT09IGkgfHwgIXBhcnNlRmxvYXQoaSkgJiYgXCJpbmxpbmVcIiA9PT0gdy5jc3MoZSwgXCJkaXNwbGF5XCIsICExLCByKSkgJiYgKGkgPSBlW1wib2Zmc2V0XCIgKyB0WzBdLnRvVXBwZXJDYXNlKCkgKyB0LnNsaWNlKDEpXSwgYSA9ICEwKSwgKGkgPSBwYXJzZUZsb2F0KGkpIHx8IDApICsgWmUoZSwgdCwgbiB8fCAobyA/IFwiYm9yZGVyXCIgOiBcImNvbnRlbnRcIiksIGEsIHIsIGkpICsgXCJweFwiO1xuICB9dy5leHRlbmQoeyBjc3NIb29rczogeyBvcGFjaXR5OiB7IGdldDogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgICBpZiAodCkge1xuICAgICAgICAgICAgdmFyIG4gPSBGZShlLCBcIm9wYWNpdHlcIik7cmV0dXJuIFwiXCIgPT09IG4gPyBcIjFcIiA6IG47XG4gICAgICAgICAgfVxuICAgICAgICB9IH0gfSwgY3NzTnVtYmVyOiB7IGFuaW1hdGlvbkl0ZXJhdGlvbkNvdW50OiAhMCwgY29sdW1uQ291bnQ6ICEwLCBmaWxsT3BhY2l0eTogITAsIGZsZXhHcm93OiAhMCwgZmxleFNocmluazogITAsIGZvbnRXZWlnaHQ6ICEwLCBsaW5lSGVpZ2h0OiAhMCwgb3BhY2l0eTogITAsIG9yZGVyOiAhMCwgb3JwaGFuczogITAsIHdpZG93czogITAsIHpJbmRleDogITAsIHpvb206ICEwIH0sIGNzc1Byb3BzOiB7fSwgc3R5bGU6IGZ1bmN0aW9uIChlLCB0LCBuLCByKSB7XG4gICAgICBpZiAoZSAmJiAzICE9PSBlLm5vZGVUeXBlICYmIDggIT09IGUubm9kZVR5cGUgJiYgZS5zdHlsZSkge1xuICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgIG8sXG4gICAgICAgICAgICBhLFxuICAgICAgICAgICAgcyA9IEcodCksXG4gICAgICAgICAgICB1ID0gWGUudGVzdCh0KSxcbiAgICAgICAgICAgIGwgPSBlLnN0eWxlO2lmICh1IHx8ICh0ID0gSmUocykpLCBhID0gdy5jc3NIb29rc1t0XSB8fCB3LmNzc0hvb2tzW3NdLCB2b2lkIDAgPT09IG4pIHJldHVybiBhICYmIFwiZ2V0XCIgaW4gYSAmJiB2b2lkIDAgIT09IChpID0gYS5nZXQoZSwgITEsIHIpKSA/IGkgOiBsW3RdO1wic3RyaW5nXCIgPT0gKG8gPSB0eXBlb2YgbikgJiYgKGkgPSBpZS5leGVjKG4pKSAmJiBpWzFdICYmIChuID0gdWUoZSwgdCwgaSksIG8gPSBcIm51bWJlclwiKSwgbnVsbCAhPSBuICYmIG4gPT09IG4gJiYgKFwibnVtYmVyXCIgPT09IG8gJiYgKG4gKz0gaSAmJiBpWzNdIHx8ICh3LmNzc051bWJlcltzXSA/IFwiXCIgOiBcInB4XCIpKSwgaC5jbGVhckNsb25lU3R5bGUgfHwgXCJcIiAhPT0gbiB8fCAwICE9PSB0LmluZGV4T2YoXCJiYWNrZ3JvdW5kXCIpIHx8IChsW3RdID0gXCJpbmhlcml0XCIpLCBhICYmIFwic2V0XCIgaW4gYSAmJiB2b2lkIDAgPT09IChuID0gYS5zZXQoZSwgbiwgcikpIHx8ICh1ID8gbC5zZXRQcm9wZXJ0eSh0LCBuKSA6IGxbdF0gPSBuKSk7XG4gICAgICB9XG4gICAgfSwgY3NzOiBmdW5jdGlvbiAoZSwgdCwgbiwgcikge1xuICAgICAgdmFyIGksXG4gICAgICAgICAgbyxcbiAgICAgICAgICBhLFxuICAgICAgICAgIHMgPSBHKHQpO3JldHVybiBYZS50ZXN0KHQpIHx8ICh0ID0gSmUocykpLCAoYSA9IHcuY3NzSG9va3NbdF0gfHwgdy5jc3NIb29rc1tzXSkgJiYgXCJnZXRcIiBpbiBhICYmIChpID0gYS5nZXQoZSwgITAsIG4pKSwgdm9pZCAwID09PSBpICYmIChpID0gRmUoZSwgdCwgcikpLCBcIm5vcm1hbFwiID09PSBpICYmIHQgaW4gVmUgJiYgKGkgPSBWZVt0XSksIFwiXCIgPT09IG4gfHwgbiA/IChvID0gcGFyc2VGbG9hdChpKSwgITAgPT09IG4gfHwgaXNGaW5pdGUobykgPyBvIHx8IDAgOiBpKSA6IGk7XG4gICAgfSB9KSwgdy5lYWNoKFtcImhlaWdodFwiLCBcIndpZHRoXCJdLCBmdW5jdGlvbiAoZSwgdCkge1xuICAgIHcuY3NzSG9va3NbdF0gPSB7IGdldDogZnVuY3Rpb24gKGUsIG4sIHIpIHtcbiAgICAgICAgaWYgKG4pIHJldHVybiAhemUudGVzdCh3LmNzcyhlLCBcImRpc3BsYXlcIikpIHx8IGUuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGggJiYgZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCA/IGV0KGUsIHQsIHIpIDogc2UoZSwgVWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZXQoZSwgdCwgcik7XG4gICAgICAgIH0pO1xuICAgICAgfSwgc2V0OiBmdW5jdGlvbiAoZSwgbiwgcikge1xuICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgIG8gPSAkZShlKSxcbiAgICAgICAgICAgIGEgPSBcImJvcmRlci1ib3hcIiA9PT0gdy5jc3MoZSwgXCJib3hTaXppbmdcIiwgITEsIG8pLFxuICAgICAgICAgICAgcyA9IHIgJiYgWmUoZSwgdCwgciwgYSwgbyk7cmV0dXJuIGEgJiYgaC5zY3JvbGxib3hTaXplKCkgPT09IG8ucG9zaXRpb24gJiYgKHMgLT0gTWF0aC5jZWlsKGVbXCJvZmZzZXRcIiArIHRbMF0udG9VcHBlckNhc2UoKSArIHQuc2xpY2UoMSldIC0gcGFyc2VGbG9hdChvW3RdKSAtIFplKGUsIHQsIFwiYm9yZGVyXCIsICExLCBvKSAtIC41KSksIHMgJiYgKGkgPSBpZS5leGVjKG4pKSAmJiBcInB4XCIgIT09IChpWzNdIHx8IFwicHhcIikgJiYgKGUuc3R5bGVbdF0gPSBuLCBuID0gdy5jc3MoZSwgdCkpLCBLZShlLCBuLCBzKTtcbiAgICAgIH0gfTtcbiAgfSksIHcuY3NzSG9va3MubWFyZ2luTGVmdCA9IF9lKGgucmVsaWFibGVNYXJnaW5MZWZ0LCBmdW5jdGlvbiAoZSwgdCkge1xuICAgIGlmICh0KSByZXR1cm4gKHBhcnNlRmxvYXQoRmUoZSwgXCJtYXJnaW5MZWZ0XCIpKSB8fCBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgLSBzZShlLCB7IG1hcmdpbkxlZnQ6IDAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcbiAgICB9KSkgKyBcInB4XCI7XG4gIH0pLCB3LmVhY2goeyBtYXJnaW46IFwiXCIsIHBhZGRpbmc6IFwiXCIsIGJvcmRlcjogXCJXaWR0aFwiIH0sIGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgdy5jc3NIb29rc1tlICsgdF0gPSB7IGV4cGFuZDogZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgZm9yICh2YXIgciA9IDAsIGkgPSB7fSwgbyA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIG4gPyBuLnNwbGl0KFwiIFwiKSA6IFtuXTsgciA8IDQ7IHIrKykgaVtlICsgb2Vbcl0gKyB0XSA9IG9bcl0gfHwgb1tyIC0gMl0gfHwgb1swXTtyZXR1cm4gaTtcbiAgICAgIH0gfSwgXCJtYXJnaW5cIiAhPT0gZSAmJiAody5jc3NIb29rc1tlICsgdF0uc2V0ID0gS2UpO1xuICB9KSwgdy5mbi5leHRlbmQoeyBjc3M6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICByZXR1cm4geih0aGlzLCBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgICB2YXIgcixcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICBvID0ge30sXG4gICAgICAgICAgICBhID0gMDtpZiAoQXJyYXkuaXNBcnJheSh0KSkge1xuICAgICAgICAgIGZvciAociA9ICRlKGUpLCBpID0gdC5sZW5ndGg7IGEgPCBpOyBhKyspIG9bdFthXV0gPSB3LmNzcyhlLCB0W2FdLCAhMSwgcik7cmV0dXJuIG87XG4gICAgICAgIH1yZXR1cm4gdm9pZCAwICE9PSBuID8gdy5zdHlsZShlLCB0LCBuKSA6IHcuY3NzKGUsIHQpO1xuICAgICAgfSwgZSwgdCwgYXJndW1lbnRzLmxlbmd0aCA+IDEpO1xuICAgIH0gfSk7ZnVuY3Rpb24gdHQoZSwgdCwgbiwgciwgaSkge1xuICAgIHJldHVybiBuZXcgdHQucHJvdG90eXBlLmluaXQoZSwgdCwgbiwgciwgaSk7XG4gIH13LlR3ZWVuID0gdHQsIHR0LnByb3RvdHlwZSA9IHsgY29uc3RydWN0b3I6IHR0LCBpbml0OiBmdW5jdGlvbiAoZSwgdCwgbiwgciwgaSwgbykge1xuICAgICAgdGhpcy5lbGVtID0gZSwgdGhpcy5wcm9wID0gbiwgdGhpcy5lYXNpbmcgPSBpIHx8IHcuZWFzaW5nLl9kZWZhdWx0LCB0aGlzLm9wdGlvbnMgPSB0LCB0aGlzLnN0YXJ0ID0gdGhpcy5ub3cgPSB0aGlzLmN1cigpLCB0aGlzLmVuZCA9IHIsIHRoaXMudW5pdCA9IG8gfHwgKHcuY3NzTnVtYmVyW25dID8gXCJcIiA6IFwicHhcIik7XG4gICAgfSwgY3VyOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZSA9IHR0LnByb3BIb29rc1t0aGlzLnByb3BdO3JldHVybiBlICYmIGUuZ2V0ID8gZS5nZXQodGhpcykgOiB0dC5wcm9wSG9va3MuX2RlZmF1bHQuZ2V0KHRoaXMpO1xuICAgIH0sIHJ1bjogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciB0LFxuICAgICAgICAgIG4gPSB0dC5wcm9wSG9va3NbdGhpcy5wcm9wXTtyZXR1cm4gdGhpcy5vcHRpb25zLmR1cmF0aW9uID8gdGhpcy5wb3MgPSB0ID0gdy5lYXNpbmdbdGhpcy5lYXNpbmddKGUsIHRoaXMub3B0aW9ucy5kdXJhdGlvbiAqIGUsIDAsIDEsIHRoaXMub3B0aW9ucy5kdXJhdGlvbikgOiB0aGlzLnBvcyA9IHQgPSBlLCB0aGlzLm5vdyA9ICh0aGlzLmVuZCAtIHRoaXMuc3RhcnQpICogdCArIHRoaXMuc3RhcnQsIHRoaXMub3B0aW9ucy5zdGVwICYmIHRoaXMub3B0aW9ucy5zdGVwLmNhbGwodGhpcy5lbGVtLCB0aGlzLm5vdywgdGhpcyksIG4gJiYgbi5zZXQgPyBuLnNldCh0aGlzKSA6IHR0LnByb3BIb29rcy5fZGVmYXVsdC5zZXQodGhpcyksIHRoaXM7XG4gICAgfSB9LCB0dC5wcm90b3R5cGUuaW5pdC5wcm90b3R5cGUgPSB0dC5wcm90b3R5cGUsIHR0LnByb3BIb29rcyA9IHsgX2RlZmF1bHQ6IHsgZ2V0OiBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdDtyZXR1cm4gMSAhPT0gZS5lbGVtLm5vZGVUeXBlIHx8IG51bGwgIT0gZS5lbGVtW2UucHJvcF0gJiYgbnVsbCA9PSBlLmVsZW0uc3R5bGVbZS5wcm9wXSA/IGUuZWxlbVtlLnByb3BdIDogKHQgPSB3LmNzcyhlLmVsZW0sIGUucHJvcCwgXCJcIikpICYmIFwiYXV0b1wiICE9PSB0ID8gdCA6IDA7XG4gICAgICB9LCBzZXQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHcuZnguc3RlcFtlLnByb3BdID8gdy5meC5zdGVwW2UucHJvcF0oZSkgOiAxICE9PSBlLmVsZW0ubm9kZVR5cGUgfHwgbnVsbCA9PSBlLmVsZW0uc3R5bGVbdy5jc3NQcm9wc1tlLnByb3BdXSAmJiAhdy5jc3NIb29rc1tlLnByb3BdID8gZS5lbGVtW2UucHJvcF0gPSBlLm5vdyA6IHcuc3R5bGUoZS5lbGVtLCBlLnByb3AsIGUubm93ICsgZS51bml0KTtcbiAgICAgIH0gfSB9LCB0dC5wcm9wSG9va3Muc2Nyb2xsVG9wID0gdHQucHJvcEhvb2tzLnNjcm9sbExlZnQgPSB7IHNldDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIGUuZWxlbS5ub2RlVHlwZSAmJiBlLmVsZW0ucGFyZW50Tm9kZSAmJiAoZS5lbGVtW2UucHJvcF0gPSBlLm5vdyk7XG4gICAgfSB9LCB3LmVhc2luZyA9IHsgbGluZWFyOiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIGU7XG4gICAgfSwgc3dpbmc6IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gLjUgLSBNYXRoLmNvcyhlICogTWF0aC5QSSkgLyAyO1xuICAgIH0sIF9kZWZhdWx0OiBcInN3aW5nXCIgfSwgdy5meCA9IHR0LnByb3RvdHlwZS5pbml0LCB3LmZ4LnN0ZXAgPSB7fTt2YXIgbnQsXG4gICAgICBydCxcbiAgICAgIGl0ID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLFxuICAgICAgb3QgPSAvcXVldWVIb29rcyQvO2Z1bmN0aW9uIGF0KCkge1xuICAgIHJ0ICYmICghMSA9PT0gci5oaWRkZW4gJiYgZS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPyBlLnJlcXVlc3RBbmltYXRpb25GcmFtZShhdCkgOiBlLnNldFRpbWVvdXQoYXQsIHcuZnguaW50ZXJ2YWwpLCB3LmZ4LnRpY2soKSk7XG4gIH1mdW5jdGlvbiBzdCgpIHtcbiAgICByZXR1cm4gZS5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIG50ID0gdm9pZCAwO1xuICAgIH0pLCBudCA9IERhdGUubm93KCk7XG4gIH1mdW5jdGlvbiB1dChlLCB0KSB7XG4gICAgdmFyIG4sXG4gICAgICAgIHIgPSAwLFxuICAgICAgICBpID0geyBoZWlnaHQ6IGUgfTtmb3IgKHQgPSB0ID8gMSA6IDA7IHIgPCA0OyByICs9IDIgLSB0KSBpW1wibWFyZ2luXCIgKyAobiA9IG9lW3JdKV0gPSBpW1wicGFkZGluZ1wiICsgbl0gPSBlO3JldHVybiB0ICYmIChpLm9wYWNpdHkgPSBpLndpZHRoID0gZSksIGk7XG4gIH1mdW5jdGlvbiBsdChlLCB0LCBuKSB7XG4gICAgZm9yICh2YXIgciwgaSA9IChwdC50d2VlbmVyc1t0XSB8fCBbXSkuY29uY2F0KHB0LnR3ZWVuZXJzW1wiKlwiXSksIG8gPSAwLCBhID0gaS5sZW5ndGg7IG8gPCBhOyBvKyspIGlmIChyID0gaVtvXS5jYWxsKG4sIHQsIGUpKSByZXR1cm4gcjtcbiAgfWZ1bmN0aW9uIGN0KGUsIHQsIG4pIHtcbiAgICB2YXIgcixcbiAgICAgICAgaSxcbiAgICAgICAgbyxcbiAgICAgICAgYSxcbiAgICAgICAgcyxcbiAgICAgICAgdSxcbiAgICAgICAgbCxcbiAgICAgICAgYyxcbiAgICAgICAgZiA9IFwid2lkdGhcIiBpbiB0IHx8IFwiaGVpZ2h0XCIgaW4gdCxcbiAgICAgICAgcCA9IHRoaXMsXG4gICAgICAgIGQgPSB7fSxcbiAgICAgICAgaCA9IGUuc3R5bGUsXG4gICAgICAgIGcgPSBlLm5vZGVUeXBlICYmIGFlKGUpLFxuICAgICAgICB5ID0gSi5nZXQoZSwgXCJmeHNob3dcIik7bi5xdWV1ZSB8fCAobnVsbCA9PSAoYSA9IHcuX3F1ZXVlSG9va3MoZSwgXCJmeFwiKSkudW5xdWV1ZWQgJiYgKGEudW5xdWV1ZWQgPSAwLCBzID0gYS5lbXB0eS5maXJlLCBhLmVtcHR5LmZpcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBhLnVucXVldWVkIHx8IHMoKTtcbiAgICB9KSwgYS51bnF1ZXVlZCsrLCBwLmFsd2F5cyhmdW5jdGlvbiAoKSB7XG4gICAgICBwLmFsd2F5cyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGEudW5xdWV1ZWQtLSwgdy5xdWV1ZShlLCBcImZ4XCIpLmxlbmd0aCB8fCBhLmVtcHR5LmZpcmUoKTtcbiAgICAgIH0pO1xuICAgIH0pKTtmb3IgKHIgaW4gdCkgaWYgKGkgPSB0W3JdLCBpdC50ZXN0KGkpKSB7XG4gICAgICBpZiAoZGVsZXRlIHRbcl0sIG8gPSBvIHx8IFwidG9nZ2xlXCIgPT09IGksIGkgPT09IChnID8gXCJoaWRlXCIgOiBcInNob3dcIikpIHtcbiAgICAgICAgaWYgKFwic2hvd1wiICE9PSBpIHx8ICF5IHx8IHZvaWQgMCA9PT0geVtyXSkgY29udGludWU7ZyA9ICEwO1xuICAgICAgfWRbcl0gPSB5ICYmIHlbcl0gfHwgdy5zdHlsZShlLCByKTtcbiAgICB9aWYgKCh1ID0gIXcuaXNFbXB0eU9iamVjdCh0KSkgfHwgIXcuaXNFbXB0eU9iamVjdChkKSkge1xuICAgICAgZiAmJiAxID09PSBlLm5vZGVUeXBlICYmIChuLm92ZXJmbG93ID0gW2gub3ZlcmZsb3csIGgub3ZlcmZsb3dYLCBoLm92ZXJmbG93WV0sIG51bGwgPT0gKGwgPSB5ICYmIHkuZGlzcGxheSkgJiYgKGwgPSBKLmdldChlLCBcImRpc3BsYXlcIikpLCBcIm5vbmVcIiA9PT0gKGMgPSB3LmNzcyhlLCBcImRpc3BsYXlcIikpICYmIChsID8gYyA9IGwgOiAoZmUoW2VdLCAhMCksIGwgPSBlLnN0eWxlLmRpc3BsYXkgfHwgbCwgYyA9IHcuY3NzKGUsIFwiZGlzcGxheVwiKSwgZmUoW2VdKSkpLCAoXCJpbmxpbmVcIiA9PT0gYyB8fCBcImlubGluZS1ibG9ja1wiID09PSBjICYmIG51bGwgIT0gbCkgJiYgXCJub25lXCIgPT09IHcuY3NzKGUsIFwiZmxvYXRcIikgJiYgKHUgfHwgKHAuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIGguZGlzcGxheSA9IGw7XG4gICAgICB9KSwgbnVsbCA9PSBsICYmIChjID0gaC5kaXNwbGF5LCBsID0gXCJub25lXCIgPT09IGMgPyBcIlwiIDogYykpLCBoLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiKSksIG4ub3ZlcmZsb3cgJiYgKGgub3ZlcmZsb3cgPSBcImhpZGRlblwiLCBwLmFsd2F5cyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGgub3ZlcmZsb3cgPSBuLm92ZXJmbG93WzBdLCBoLm92ZXJmbG93WCA9IG4ub3ZlcmZsb3dbMV0sIGgub3ZlcmZsb3dZID0gbi5vdmVyZmxvd1syXTtcbiAgICAgIH0pKSwgdSA9ICExO2ZvciAociBpbiBkKSB1IHx8ICh5ID8gXCJoaWRkZW5cIiBpbiB5ICYmIChnID0geS5oaWRkZW4pIDogeSA9IEouYWNjZXNzKGUsIFwiZnhzaG93XCIsIHsgZGlzcGxheTogbCB9KSwgbyAmJiAoeS5oaWRkZW4gPSAhZyksIGcgJiYgZmUoW2VdLCAhMCksIHAuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIGcgfHwgZmUoW2VdKSwgSi5yZW1vdmUoZSwgXCJmeHNob3dcIik7Zm9yIChyIGluIGQpIHcuc3R5bGUoZSwgciwgZFtyXSk7XG4gICAgICB9KSksIHUgPSBsdChnID8geVtyXSA6IDAsIHIsIHApLCByIGluIHkgfHwgKHlbcl0gPSB1LnN0YXJ0LCBnICYmICh1LmVuZCA9IHUuc3RhcnQsIHUuc3RhcnQgPSAwKSk7XG4gICAgfVxuICB9ZnVuY3Rpb24gZnQoZSwgdCkge1xuICAgIHZhciBuLCByLCBpLCBvLCBhO2ZvciAobiBpbiBlKSBpZiAociA9IEcobiksIGkgPSB0W3JdLCBvID0gZVtuXSwgQXJyYXkuaXNBcnJheShvKSAmJiAoaSA9IG9bMV0sIG8gPSBlW25dID0gb1swXSksIG4gIT09IHIgJiYgKGVbcl0gPSBvLCBkZWxldGUgZVtuXSksIChhID0gdy5jc3NIb29rc1tyXSkgJiYgXCJleHBhbmRcIiBpbiBhKSB7XG4gICAgICBvID0gYS5leHBhbmQobyksIGRlbGV0ZSBlW3JdO2ZvciAobiBpbiBvKSBuIGluIGUgfHwgKGVbbl0gPSBvW25dLCB0W25dID0gaSk7XG4gICAgfSBlbHNlIHRbcl0gPSBpO1xuICB9ZnVuY3Rpb24gcHQoZSwgdCwgbikge1xuICAgIHZhciByLFxuICAgICAgICBpLFxuICAgICAgICBvID0gMCxcbiAgICAgICAgYSA9IHB0LnByZWZpbHRlcnMubGVuZ3RoLFxuICAgICAgICBzID0gdy5EZWZlcnJlZCgpLmFsd2F5cyhmdW5jdGlvbiAoKSB7XG4gICAgICBkZWxldGUgdS5lbGVtO1xuICAgIH0pLFxuICAgICAgICB1ID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGkpIHJldHVybiAhMTtmb3IgKHZhciB0ID0gbnQgfHwgc3QoKSwgbiA9IE1hdGgubWF4KDAsIGwuc3RhcnRUaW1lICsgbC5kdXJhdGlvbiAtIHQpLCByID0gMSAtIChuIC8gbC5kdXJhdGlvbiB8fCAwKSwgbyA9IDAsIGEgPSBsLnR3ZWVucy5sZW5ndGg7IG8gPCBhOyBvKyspIGwudHdlZW5zW29dLnJ1bihyKTtyZXR1cm4gcy5ub3RpZnlXaXRoKGUsIFtsLCByLCBuXSksIHIgPCAxICYmIGEgPyBuIDogKGEgfHwgcy5ub3RpZnlXaXRoKGUsIFtsLCAxLCAwXSksIHMucmVzb2x2ZVdpdGgoZSwgW2xdKSwgITEpO1xuICAgIH0sXG4gICAgICAgIGwgPSBzLnByb21pc2UoeyBlbGVtOiBlLCBwcm9wczogdy5leHRlbmQoe30sIHQpLCBvcHRzOiB3LmV4dGVuZCghMCwgeyBzcGVjaWFsRWFzaW5nOiB7fSwgZWFzaW5nOiB3LmVhc2luZy5fZGVmYXVsdCB9LCBuKSwgb3JpZ2luYWxQcm9wZXJ0aWVzOiB0LCBvcmlnaW5hbE9wdGlvbnM6IG4sIHN0YXJ0VGltZTogbnQgfHwgc3QoKSwgZHVyYXRpb246IG4uZHVyYXRpb24sIHR3ZWVuczogW10sIGNyZWF0ZVR3ZWVuOiBmdW5jdGlvbiAodCwgbikge1xuICAgICAgICB2YXIgciA9IHcuVHdlZW4oZSwgbC5vcHRzLCB0LCBuLCBsLm9wdHMuc3BlY2lhbEVhc2luZ1t0XSB8fCBsLm9wdHMuZWFzaW5nKTtyZXR1cm4gbC50d2VlbnMucHVzaChyKSwgcjtcbiAgICAgIH0sIHN0b3A6IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHZhciBuID0gMCxcbiAgICAgICAgICAgIHIgPSB0ID8gbC50d2VlbnMubGVuZ3RoIDogMDtpZiAoaSkgcmV0dXJuIHRoaXM7Zm9yIChpID0gITA7IG4gPCByOyBuKyspIGwudHdlZW5zW25dLnJ1bigxKTtyZXR1cm4gdCA/IChzLm5vdGlmeVdpdGgoZSwgW2wsIDEsIDBdKSwgcy5yZXNvbHZlV2l0aChlLCBbbCwgdF0pKSA6IHMucmVqZWN0V2l0aChlLCBbbCwgdF0pLCB0aGlzO1xuICAgICAgfSB9KSxcbiAgICAgICAgYyA9IGwucHJvcHM7Zm9yIChmdChjLCBsLm9wdHMuc3BlY2lhbEVhc2luZyk7IG8gPCBhOyBvKyspIGlmIChyID0gcHQucHJlZmlsdGVyc1tvXS5jYWxsKGwsIGUsIGMsIGwub3B0cykpIHJldHVybiBnKHIuc3RvcCkgJiYgKHcuX3F1ZXVlSG9va3MobC5lbGVtLCBsLm9wdHMucXVldWUpLnN0b3AgPSByLnN0b3AuYmluZChyKSksIHI7cmV0dXJuIHcubWFwKGMsIGx0LCBsKSwgZyhsLm9wdHMuc3RhcnQpICYmIGwub3B0cy5zdGFydC5jYWxsKGUsIGwpLCBsLnByb2dyZXNzKGwub3B0cy5wcm9ncmVzcykuZG9uZShsLm9wdHMuZG9uZSwgbC5vcHRzLmNvbXBsZXRlKS5mYWlsKGwub3B0cy5mYWlsKS5hbHdheXMobC5vcHRzLmFsd2F5cyksIHcuZngudGltZXIody5leHRlbmQodSwgeyBlbGVtOiBlLCBhbmltOiBsLCBxdWV1ZTogbC5vcHRzLnF1ZXVlIH0pKSwgbDtcbiAgfXcuQW5pbWF0aW9uID0gdy5leHRlbmQocHQsIHsgdHdlZW5lcnM6IHsgXCIqXCI6IFtmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICB2YXIgbiA9IHRoaXMuY3JlYXRlVHdlZW4oZSwgdCk7cmV0dXJuIHVlKG4uZWxlbSwgZSwgaWUuZXhlYyh0KSwgbiksIG47XG4gICAgICB9XSB9LCB0d2VlbmVyOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgZyhlKSA/ICh0ID0gZSwgZSA9IFtcIipcIl0pIDogZSA9IGUubWF0Y2goTSk7Zm9yICh2YXIgbiwgciA9IDAsIGkgPSBlLmxlbmd0aDsgciA8IGk7IHIrKykgbiA9IGVbcl0sIHB0LnR3ZWVuZXJzW25dID0gcHQudHdlZW5lcnNbbl0gfHwgW10sIHB0LnR3ZWVuZXJzW25dLnVuc2hpZnQodCk7XG4gICAgfSwgcHJlZmlsdGVyczogW2N0XSwgcHJlZmlsdGVyOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgdCA/IHB0LnByZWZpbHRlcnMudW5zaGlmdChlKSA6IHB0LnByZWZpbHRlcnMucHVzaChlKTtcbiAgICB9IH0pLCB3LnNwZWVkID0gZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICB2YXIgciA9IGUgJiYgXCJvYmplY3RcIiA9PSB0eXBlb2YgZSA/IHcuZXh0ZW5kKHt9LCBlKSA6IHsgY29tcGxldGU6IG4gfHwgIW4gJiYgdCB8fCBnKGUpICYmIGUsIGR1cmF0aW9uOiBlLCBlYXNpbmc6IG4gJiYgdCB8fCB0ICYmICFnKHQpICYmIHQgfTtyZXR1cm4gdy5meC5vZmYgPyByLmR1cmF0aW9uID0gMCA6IFwibnVtYmVyXCIgIT0gdHlwZW9mIHIuZHVyYXRpb24gJiYgKHIuZHVyYXRpb24gaW4gdy5meC5zcGVlZHMgPyByLmR1cmF0aW9uID0gdy5meC5zcGVlZHNbci5kdXJhdGlvbl0gOiByLmR1cmF0aW9uID0gdy5meC5zcGVlZHMuX2RlZmF1bHQpLCBudWxsICE9IHIucXVldWUgJiYgITAgIT09IHIucXVldWUgfHwgKHIucXVldWUgPSBcImZ4XCIpLCByLm9sZCA9IHIuY29tcGxldGUsIHIuY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBnKHIub2xkKSAmJiByLm9sZC5jYWxsKHRoaXMpLCByLnF1ZXVlICYmIHcuZGVxdWV1ZSh0aGlzLCByLnF1ZXVlKTtcbiAgICB9LCByO1xuICB9LCB3LmZuLmV4dGVuZCh7IGZhZGVUbzogZnVuY3Rpb24gKGUsIHQsIG4sIHIpIHtcbiAgICAgIHJldHVybiB0aGlzLmZpbHRlcihhZSkuY3NzKFwib3BhY2l0eVwiLCAwKS5zaG93KCkuZW5kKCkuYW5pbWF0ZSh7IG9wYWNpdHk6IHQgfSwgZSwgbiwgcik7XG4gICAgfSwgYW5pbWF0ZTogZnVuY3Rpb24gKGUsIHQsIG4sIHIpIHtcbiAgICAgIHZhciBpID0gdy5pc0VtcHR5T2JqZWN0KGUpLFxuICAgICAgICAgIG8gPSB3LnNwZWVkKHQsIG4sIHIpLFxuICAgICAgICAgIGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ID0gcHQodGhpcywgdy5leHRlbmQoe30sIGUpLCBvKTsoaSB8fCBKLmdldCh0aGlzLCBcImZpbmlzaFwiKSkgJiYgdC5zdG9wKCEwKTtcbiAgICAgIH07cmV0dXJuIGEuZmluaXNoID0gYSwgaSB8fCAhMSA9PT0gby5xdWV1ZSA/IHRoaXMuZWFjaChhKSA6IHRoaXMucXVldWUoby5xdWV1ZSwgYSk7XG4gICAgfSwgc3RvcDogZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICAgIHZhciByID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIHQgPSBlLnN0b3A7ZGVsZXRlIGUuc3RvcCwgdChuKTtcbiAgICAgIH07cmV0dXJuIFwic3RyaW5nXCIgIT0gdHlwZW9mIGUgJiYgKG4gPSB0LCB0ID0gZSwgZSA9IHZvaWQgMCksIHQgJiYgITEgIT09IGUgJiYgdGhpcy5xdWV1ZShlIHx8IFwiZnhcIiwgW10pLCB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdCA9ICEwLFxuICAgICAgICAgICAgaSA9IG51bGwgIT0gZSAmJiBlICsgXCJxdWV1ZUhvb2tzXCIsXG4gICAgICAgICAgICBvID0gdy50aW1lcnMsXG4gICAgICAgICAgICBhID0gSi5nZXQodGhpcyk7aWYgKGkpIGFbaV0gJiYgYVtpXS5zdG9wICYmIHIoYVtpXSk7ZWxzZSBmb3IgKGkgaW4gYSkgYVtpXSAmJiBhW2ldLnN0b3AgJiYgb3QudGVzdChpKSAmJiByKGFbaV0pO2ZvciAoaSA9IG8ubGVuZ3RoOyBpLS07KSBvW2ldLmVsZW0gIT09IHRoaXMgfHwgbnVsbCAhPSBlICYmIG9baV0ucXVldWUgIT09IGUgfHwgKG9baV0uYW5pbS5zdG9wKG4pLCB0ID0gITEsIG8uc3BsaWNlKGksIDEpKTshdCAmJiBuIHx8IHcuZGVxdWV1ZSh0aGlzLCBlKTtcbiAgICAgIH0pO1xuICAgIH0sIGZpbmlzaDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiAhMSAhPT0gZSAmJiAoZSA9IGUgfHwgXCJmeFwiKSwgdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQsXG4gICAgICAgICAgICBuID0gSi5nZXQodGhpcyksXG4gICAgICAgICAgICByID0gbltlICsgXCJxdWV1ZVwiXSxcbiAgICAgICAgICAgIGkgPSBuW2UgKyBcInF1ZXVlSG9va3NcIl0sXG4gICAgICAgICAgICBvID0gdy50aW1lcnMsXG4gICAgICAgICAgICBhID0gciA/IHIubGVuZ3RoIDogMDtmb3IgKG4uZmluaXNoID0gITAsIHcucXVldWUodGhpcywgZSwgW10pLCBpICYmIGkuc3RvcCAmJiBpLnN0b3AuY2FsbCh0aGlzLCAhMCksIHQgPSBvLmxlbmd0aDsgdC0tOykgb1t0XS5lbGVtID09PSB0aGlzICYmIG9bdF0ucXVldWUgPT09IGUgJiYgKG9bdF0uYW5pbS5zdG9wKCEwKSwgby5zcGxpY2UodCwgMSkpO2ZvciAodCA9IDA7IHQgPCBhOyB0KyspIHJbdF0gJiYgclt0XS5maW5pc2ggJiYgclt0XS5maW5pc2guY2FsbCh0aGlzKTtkZWxldGUgbi5maW5pc2g7XG4gICAgICB9KTtcbiAgICB9IH0pLCB3LmVhY2goW1widG9nZ2xlXCIsIFwic2hvd1wiLCBcImhpZGVcIl0sIGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgdmFyIG4gPSB3LmZuW3RdO3cuZm5bdF0gPSBmdW5jdGlvbiAoZSwgciwgaSkge1xuICAgICAgcmV0dXJuIG51bGwgPT0gZSB8fCBcImJvb2xlYW5cIiA9PSB0eXBlb2YgZSA/IG4uYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IHRoaXMuYW5pbWF0ZSh1dCh0LCAhMCksIGUsIHIsIGkpO1xuICAgIH07XG4gIH0pLCB3LmVhY2goeyBzbGlkZURvd246IHV0KFwic2hvd1wiKSwgc2xpZGVVcDogdXQoXCJoaWRlXCIpLCBzbGlkZVRvZ2dsZTogdXQoXCJ0b2dnbGVcIiksIGZhZGVJbjogeyBvcGFjaXR5OiBcInNob3dcIiB9LCBmYWRlT3V0OiB7IG9wYWNpdHk6IFwiaGlkZVwiIH0sIGZhZGVUb2dnbGU6IHsgb3BhY2l0eTogXCJ0b2dnbGVcIiB9IH0sIGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgdy5mbltlXSA9IGZ1bmN0aW9uIChlLCBuLCByKSB7XG4gICAgICByZXR1cm4gdGhpcy5hbmltYXRlKHQsIGUsIG4sIHIpO1xuICAgIH07XG4gIH0pLCB3LnRpbWVycyA9IFtdLCB3LmZ4LnRpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGUsXG4gICAgICAgIHQgPSAwLFxuICAgICAgICBuID0gdy50aW1lcnM7Zm9yIChudCA9IERhdGUubm93KCk7IHQgPCBuLmxlbmd0aDsgdCsrKSAoZSA9IG5bdF0pKCkgfHwgblt0XSAhPT0gZSB8fCBuLnNwbGljZSh0LS0sIDEpO24ubGVuZ3RoIHx8IHcuZnguc3RvcCgpLCBudCA9IHZvaWQgMDtcbiAgfSwgdy5meC50aW1lciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgdy50aW1lcnMucHVzaChlKSwgdy5meC5zdGFydCgpO1xuICB9LCB3LmZ4LmludGVydmFsID0gMTMsIHcuZnguc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcnQgfHwgKHJ0ID0gITAsIGF0KCkpO1xuICB9LCB3LmZ4LnN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgcnQgPSBudWxsO1xuICB9LCB3LmZ4LnNwZWVkcyA9IHsgc2xvdzogNjAwLCBmYXN0OiAyMDAsIF9kZWZhdWx0OiA0MDAgfSwgdy5mbi5kZWxheSA9IGZ1bmN0aW9uICh0LCBuKSB7XG4gICAgcmV0dXJuIHQgPSB3LmZ4ID8gdy5meC5zcGVlZHNbdF0gfHwgdCA6IHQsIG4gPSBuIHx8IFwiZnhcIiwgdGhpcy5xdWV1ZShuLCBmdW5jdGlvbiAobiwgcikge1xuICAgICAgdmFyIGkgPSBlLnNldFRpbWVvdXQobiwgdCk7ci5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBlLmNsZWFyVGltZW91dChpKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0sIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZSA9IHIuY3JlYXRlRWxlbWVudChcImlucHV0XCIpLFxuICAgICAgICB0ID0gci5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpLmFwcGVuZENoaWxkKHIuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKSk7ZS50eXBlID0gXCJjaGVja2JveFwiLCBoLmNoZWNrT24gPSBcIlwiICE9PSBlLnZhbHVlLCBoLm9wdFNlbGVjdGVkID0gdC5zZWxlY3RlZCwgKGUgPSByLmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKSkudmFsdWUgPSBcInRcIiwgZS50eXBlID0gXCJyYWRpb1wiLCBoLnJhZGlvVmFsdWUgPSBcInRcIiA9PT0gZS52YWx1ZTtcbiAgfSgpO3ZhciBkdCxcbiAgICAgIGh0ID0gdy5leHByLmF0dHJIYW5kbGU7dy5mbi5leHRlbmQoeyBhdHRyOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgcmV0dXJuIHoodGhpcywgdy5hdHRyLCBlLCB0LCBhcmd1bWVudHMubGVuZ3RoID4gMSk7XG4gICAgfSwgcmVtb3ZlQXR0cjogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICB3LnJlbW92ZUF0dHIodGhpcywgZSk7XG4gICAgICB9KTtcbiAgICB9IH0pLCB3LmV4dGVuZCh7IGF0dHI6IGZ1bmN0aW9uIChlLCB0LCBuKSB7XG4gICAgICB2YXIgcixcbiAgICAgICAgICBpLFxuICAgICAgICAgIG8gPSBlLm5vZGVUeXBlO2lmICgzICE9PSBvICYmIDggIT09IG8gJiYgMiAhPT0gbykgcmV0dXJuIFwidW5kZWZpbmVkXCIgPT0gdHlwZW9mIGUuZ2V0QXR0cmlidXRlID8gdy5wcm9wKGUsIHQsIG4pIDogKDEgPT09IG8gJiYgdy5pc1hNTERvYyhlKSB8fCAoaSA9IHcuYXR0ckhvb2tzW3QudG9Mb3dlckNhc2UoKV0gfHwgKHcuZXhwci5tYXRjaC5ib29sLnRlc3QodCkgPyBkdCA6IHZvaWQgMCkpLCB2b2lkIDAgIT09IG4gPyBudWxsID09PSBuID8gdm9pZCB3LnJlbW92ZUF0dHIoZSwgdCkgOiBpICYmIFwic2V0XCIgaW4gaSAmJiB2b2lkIDAgIT09IChyID0gaS5zZXQoZSwgbiwgdCkpID8gciA6IChlLnNldEF0dHJpYnV0ZSh0LCBuICsgXCJcIiksIG4pIDogaSAmJiBcImdldFwiIGluIGkgJiYgbnVsbCAhPT0gKHIgPSBpLmdldChlLCB0KSkgPyByIDogbnVsbCA9PSAociA9IHcuZmluZC5hdHRyKGUsIHQpKSA/IHZvaWQgMCA6IHIpO1xuICAgIH0sIGF0dHJIb29rczogeyB0eXBlOiB7IHNldDogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgICBpZiAoIWgucmFkaW9WYWx1ZSAmJiBcInJhZGlvXCIgPT09IHQgJiYgTihlLCBcImlucHV0XCIpKSB7XG4gICAgICAgICAgICB2YXIgbiA9IGUudmFsdWU7cmV0dXJuIGUuc2V0QXR0cmlidXRlKFwidHlwZVwiLCB0KSwgbiAmJiAoZS52YWx1ZSA9IG4pLCB0O1xuICAgICAgICAgIH1cbiAgICAgICAgfSB9IH0sIHJlbW92ZUF0dHI6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICB2YXIgbixcbiAgICAgICAgICByID0gMCxcbiAgICAgICAgICBpID0gdCAmJiB0Lm1hdGNoKE0pO2lmIChpICYmIDEgPT09IGUubm9kZVR5cGUpIHdoaWxlIChuID0gaVtyKytdKSBlLnJlbW92ZUF0dHJpYnV0ZShuKTtcbiAgICB9IH0pLCBkdCA9IHsgc2V0OiBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgcmV0dXJuICExID09PSB0ID8gdy5yZW1vdmVBdHRyKGUsIG4pIDogZS5zZXRBdHRyaWJ1dGUobiwgbiksIG47XG4gICAgfSB9LCB3LmVhY2gody5leHByLm1hdGNoLmJvb2wuc291cmNlLm1hdGNoKC9cXHcrL2cpLCBmdW5jdGlvbiAoZSwgdCkge1xuICAgIHZhciBuID0gaHRbdF0gfHwgdy5maW5kLmF0dHI7aHRbdF0gPSBmdW5jdGlvbiAoZSwgdCwgcikge1xuICAgICAgdmFyIGksXG4gICAgICAgICAgbyxcbiAgICAgICAgICBhID0gdC50b0xvd2VyQ2FzZSgpO3JldHVybiByIHx8IChvID0gaHRbYV0sIGh0W2FdID0gaSwgaSA9IG51bGwgIT0gbihlLCB0LCByKSA/IGEgOiBudWxsLCBodFthXSA9IG8pLCBpO1xuICAgIH07XG4gIH0pO3ZhciBndCA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksXG4gICAgICB5dCA9IC9eKD86YXxhcmVhKSQvaTt3LmZuLmV4dGVuZCh7IHByb3A6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICByZXR1cm4geih0aGlzLCB3LnByb3AsIGUsIHQsIGFyZ3VtZW50cy5sZW5ndGggPiAxKTtcbiAgICB9LCByZW1vdmVQcm9wOiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzW3cucHJvcEZpeFtlXSB8fCBlXTtcbiAgICAgIH0pO1xuICAgIH0gfSksIHcuZXh0ZW5kKHsgcHJvcDogZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICAgIHZhciByLFxuICAgICAgICAgIGksXG4gICAgICAgICAgbyA9IGUubm9kZVR5cGU7aWYgKDMgIT09IG8gJiYgOCAhPT0gbyAmJiAyICE9PSBvKSByZXR1cm4gMSA9PT0gbyAmJiB3LmlzWE1MRG9jKGUpIHx8ICh0ID0gdy5wcm9wRml4W3RdIHx8IHQsIGkgPSB3LnByb3BIb29rc1t0XSksIHZvaWQgMCAhPT0gbiA/IGkgJiYgXCJzZXRcIiBpbiBpICYmIHZvaWQgMCAhPT0gKHIgPSBpLnNldChlLCBuLCB0KSkgPyByIDogZVt0XSA9IG4gOiBpICYmIFwiZ2V0XCIgaW4gaSAmJiBudWxsICE9PSAociA9IGkuZ2V0KGUsIHQpKSA/IHIgOiBlW3RdO1xuICAgIH0sIHByb3BIb29rczogeyB0YWJJbmRleDogeyBnZXQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgdmFyIHQgPSB3LmZpbmQuYXR0cihlLCBcInRhYmluZGV4XCIpO3JldHVybiB0ID8gcGFyc2VJbnQodCwgMTApIDogZ3QudGVzdChlLm5vZGVOYW1lKSB8fCB5dC50ZXN0KGUubm9kZU5hbWUpICYmIGUuaHJlZiA/IDAgOiAtMTtcbiAgICAgICAgfSB9IH0sIHByb3BGaXg6IHsgXCJmb3JcIjogXCJodG1sRm9yXCIsIFwiY2xhc3NcIjogXCJjbGFzc05hbWVcIiB9IH0pLCBoLm9wdFNlbGVjdGVkIHx8ICh3LnByb3BIb29rcy5zZWxlY3RlZCA9IHsgZ2V0OiBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHQgPSBlLnBhcmVudE5vZGU7cmV0dXJuIHQgJiYgdC5wYXJlbnROb2RlICYmIHQucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4LCBudWxsO1xuICAgIH0sIHNldDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciB0ID0gZS5wYXJlbnROb2RlO3QgJiYgKHQuc2VsZWN0ZWRJbmRleCwgdC5wYXJlbnROb2RlICYmIHQucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4KTtcbiAgICB9IH0pLCB3LmVhY2goW1widGFiSW5kZXhcIiwgXCJyZWFkT25seVwiLCBcIm1heExlbmd0aFwiLCBcImNlbGxTcGFjaW5nXCIsIFwiY2VsbFBhZGRpbmdcIiwgXCJyb3dTcGFuXCIsIFwiY29sU3BhblwiLCBcInVzZU1hcFwiLCBcImZyYW1lQm9yZGVyXCIsIFwiY29udGVudEVkaXRhYmxlXCJdLCBmdW5jdGlvbiAoKSB7XG4gICAgdy5wcm9wRml4W3RoaXMudG9Mb3dlckNhc2UoKV0gPSB0aGlzO1xuICB9KTtmdW5jdGlvbiB2dChlKSB7XG4gICAgcmV0dXJuIChlLm1hdGNoKE0pIHx8IFtdKS5qb2luKFwiIFwiKTtcbiAgfWZ1bmN0aW9uIG10KGUpIHtcbiAgICByZXR1cm4gZS5nZXRBdHRyaWJ1dGUgJiYgZS5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKSB8fCBcIlwiO1xuICB9ZnVuY3Rpb24geHQoZSkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KGUpID8gZSA6IFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgPyBlLm1hdGNoKE0pIHx8IFtdIDogW107XG4gIH13LmZuLmV4dGVuZCh7IGFkZENsYXNzOiBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHQsXG4gICAgICAgICAgbixcbiAgICAgICAgICByLFxuICAgICAgICAgIGksXG4gICAgICAgICAgbyxcbiAgICAgICAgICBhLFxuICAgICAgICAgIHMsXG4gICAgICAgICAgdSA9IDA7aWYgKGcoZSkpIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgdyh0aGlzKS5hZGRDbGFzcyhlLmNhbGwodGhpcywgdCwgbXQodGhpcykpKTtcbiAgICAgIH0pO2lmICgodCA9IHh0KGUpKS5sZW5ndGgpIHdoaWxlIChuID0gdGhpc1t1KytdKSBpZiAoaSA9IG10KG4pLCByID0gMSA9PT0gbi5ub2RlVHlwZSAmJiBcIiBcIiArIHZ0KGkpICsgXCIgXCIpIHtcbiAgICAgICAgYSA9IDA7d2hpbGUgKG8gPSB0W2ErK10pIHIuaW5kZXhPZihcIiBcIiArIG8gKyBcIiBcIikgPCAwICYmIChyICs9IG8gKyBcIiBcIik7aSAhPT0gKHMgPSB2dChyKSkgJiYgbi5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBzKTtcbiAgICAgIH1yZXR1cm4gdGhpcztcbiAgICB9LCByZW1vdmVDbGFzczogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciB0LFxuICAgICAgICAgIG4sXG4gICAgICAgICAgcixcbiAgICAgICAgICBpLFxuICAgICAgICAgIG8sXG4gICAgICAgICAgYSxcbiAgICAgICAgICBzLFxuICAgICAgICAgIHUgPSAwO2lmIChnKGUpKSByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHcodGhpcykucmVtb3ZlQ2xhc3MoZS5jYWxsKHRoaXMsIHQsIG10KHRoaXMpKSk7XG4gICAgICB9KTtpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0aGlzLmF0dHIoXCJjbGFzc1wiLCBcIlwiKTtpZiAoKHQgPSB4dChlKSkubGVuZ3RoKSB3aGlsZSAobiA9IHRoaXNbdSsrXSkgaWYgKGkgPSBtdChuKSwgciA9IDEgPT09IG4ubm9kZVR5cGUgJiYgXCIgXCIgKyB2dChpKSArIFwiIFwiKSB7XG4gICAgICAgIGEgPSAwO3doaWxlIChvID0gdFthKytdKSB3aGlsZSAoci5pbmRleE9mKFwiIFwiICsgbyArIFwiIFwiKSA+IC0xKSByID0gci5yZXBsYWNlKFwiIFwiICsgbyArIFwiIFwiLCBcIiBcIik7aSAhPT0gKHMgPSB2dChyKSkgJiYgbi5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBzKTtcbiAgICAgIH1yZXR1cm4gdGhpcztcbiAgICB9LCB0b2dnbGVDbGFzczogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIHZhciBuID0gdHlwZW9mIGUsXG4gICAgICAgICAgciA9IFwic3RyaW5nXCIgPT09IG4gfHwgQXJyYXkuaXNBcnJheShlKTtyZXR1cm4gXCJib29sZWFuXCIgPT0gdHlwZW9mIHQgJiYgciA/IHQgPyB0aGlzLmFkZENsYXNzKGUpIDogdGhpcy5yZW1vdmVDbGFzcyhlKSA6IGcoZSkgPyB0aGlzLmVhY2goZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgdyh0aGlzKS50b2dnbGVDbGFzcyhlLmNhbGwodGhpcywgbiwgbXQodGhpcyksIHQpLCB0KTtcbiAgICAgIH0pIDogdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQsIGksIG8sIGE7aWYgKHIpIHtcbiAgICAgICAgICBpID0gMCwgbyA9IHcodGhpcyksIGEgPSB4dChlKTt3aGlsZSAodCA9IGFbaSsrXSkgby5oYXNDbGFzcyh0KSA/IG8ucmVtb3ZlQ2xhc3ModCkgOiBvLmFkZENsYXNzKHQpO1xuICAgICAgICB9IGVsc2Ugdm9pZCAwICE9PSBlICYmIFwiYm9vbGVhblwiICE9PSBuIHx8ICgodCA9IG10KHRoaXMpKSAmJiBKLnNldCh0aGlzLCBcIl9fY2xhc3NOYW1lX19cIiwgdCksIHRoaXMuc2V0QXR0cmlidXRlICYmIHRoaXMuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgdCB8fCAhMSA9PT0gZSA/IFwiXCIgOiBKLmdldCh0aGlzLCBcIl9fY2xhc3NOYW1lX19cIikgfHwgXCJcIikpO1xuICAgICAgfSk7XG4gICAgfSwgaGFzQ2xhc3M6IGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgdCxcbiAgICAgICAgICBuLFxuICAgICAgICAgIHIgPSAwO3QgPSBcIiBcIiArIGUgKyBcIiBcIjt3aGlsZSAobiA9IHRoaXNbcisrXSkgaWYgKDEgPT09IG4ubm9kZVR5cGUgJiYgKFwiIFwiICsgdnQobXQobikpICsgXCIgXCIpLmluZGV4T2YodCkgPiAtMSkgcmV0dXJuICEwO3JldHVybiAhMTtcbiAgICB9IH0pO3ZhciBidCA9IC9cXHIvZzt3LmZuLmV4dGVuZCh7IHZhbDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciB0LFxuICAgICAgICAgIG4sXG4gICAgICAgICAgcixcbiAgICAgICAgICBpID0gdGhpc1swXTt7XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gciA9IGcoZSksIHRoaXMuZWFjaChmdW5jdGlvbiAobikge1xuICAgICAgICAgIHZhciBpOzEgPT09IHRoaXMubm9kZVR5cGUgJiYgKG51bGwgPT0gKGkgPSByID8gZS5jYWxsKHRoaXMsIG4sIHcodGhpcykudmFsKCkpIDogZSkgPyBpID0gXCJcIiA6IFwibnVtYmVyXCIgPT0gdHlwZW9mIGkgPyBpICs9IFwiXCIgOiBBcnJheS5pc0FycmF5KGkpICYmIChpID0gdy5tYXAoaSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsID09IGUgPyBcIlwiIDogZSArIFwiXCI7XG4gICAgICAgICAgfSkpLCAodCA9IHcudmFsSG9va3NbdGhpcy50eXBlXSB8fCB3LnZhbEhvb2tzW3RoaXMubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0pICYmIFwic2V0XCIgaW4gdCAmJiB2b2lkIDAgIT09IHQuc2V0KHRoaXMsIGksIFwidmFsdWVcIikgfHwgKHRoaXMudmFsdWUgPSBpKSk7XG4gICAgICAgIH0pO2lmIChpKSByZXR1cm4gKHQgPSB3LnZhbEhvb2tzW2kudHlwZV0gfHwgdy52YWxIb29rc1tpLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSAmJiBcImdldFwiIGluIHQgJiYgdm9pZCAwICE9PSAobiA9IHQuZ2V0KGksIFwidmFsdWVcIikpID8gbiA6IFwic3RyaW5nXCIgPT0gdHlwZW9mIChuID0gaS52YWx1ZSkgPyBuLnJlcGxhY2UoYnQsIFwiXCIpIDogbnVsbCA9PSBuID8gXCJcIiA6IG47XG4gICAgICB9XG4gICAgfSB9KSwgdy5leHRlbmQoeyB2YWxIb29rczogeyBvcHRpb246IHsgZ2V0OiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHZhciB0ID0gdy5maW5kLmF0dHIoZSwgXCJ2YWx1ZVwiKTtyZXR1cm4gbnVsbCAhPSB0ID8gdCA6IHZ0KHcudGV4dChlKSk7XG4gICAgICAgIH0gfSwgc2VsZWN0OiB7IGdldDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICB2YXIgdCxcbiAgICAgICAgICAgICAgbixcbiAgICAgICAgICAgICAgcixcbiAgICAgICAgICAgICAgaSA9IGUub3B0aW9ucyxcbiAgICAgICAgICAgICAgbyA9IGUuc2VsZWN0ZWRJbmRleCxcbiAgICAgICAgICAgICAgYSA9IFwic2VsZWN0LW9uZVwiID09PSBlLnR5cGUsXG4gICAgICAgICAgICAgIHMgPSBhID8gbnVsbCA6IFtdLFxuICAgICAgICAgICAgICB1ID0gYSA/IG8gKyAxIDogaS5sZW5ndGg7Zm9yIChyID0gbyA8IDAgPyB1IDogYSA/IG8gOiAwOyByIDwgdTsgcisrKSBpZiAoKChuID0gaVtyXSkuc2VsZWN0ZWQgfHwgciA9PT0gbykgJiYgIW4uZGlzYWJsZWQgJiYgKCFuLnBhcmVudE5vZGUuZGlzYWJsZWQgfHwgIU4obi5wYXJlbnROb2RlLCBcIm9wdGdyb3VwXCIpKSkge1xuICAgICAgICAgICAgaWYgKHQgPSB3KG4pLnZhbCgpLCBhKSByZXR1cm4gdDtzLnB1c2godCk7XG4gICAgICAgICAgfXJldHVybiBzO1xuICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgICAgdmFyIG4sXG4gICAgICAgICAgICAgIHIsXG4gICAgICAgICAgICAgIGkgPSBlLm9wdGlvbnMsXG4gICAgICAgICAgICAgIG8gPSB3Lm1ha2VBcnJheSh0KSxcbiAgICAgICAgICAgICAgYSA9IGkubGVuZ3RoO3doaWxlIChhLS0pICgociA9IGlbYV0pLnNlbGVjdGVkID0gdy5pbkFycmF5KHcudmFsSG9va3Mub3B0aW9uLmdldChyKSwgbykgPiAtMSkgJiYgKG4gPSAhMCk7cmV0dXJuIG4gfHwgKGUuc2VsZWN0ZWRJbmRleCA9IC0xKSwgbztcbiAgICAgICAgfSB9IH0gfSksIHcuZWFjaChbXCJyYWRpb1wiLCBcImNoZWNrYm94XCJdLCBmdW5jdGlvbiAoKSB7XG4gICAgdy52YWxIb29rc1t0aGlzXSA9IHsgc2V0OiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0KSkgcmV0dXJuIGUuY2hlY2tlZCA9IHcuaW5BcnJheSh3KGUpLnZhbCgpLCB0KSA+IC0xO1xuICAgICAgfSB9LCBoLmNoZWNrT24gfHwgKHcudmFsSG9va3NbdGhpc10uZ2V0ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBudWxsID09PSBlLmdldEF0dHJpYnV0ZShcInZhbHVlXCIpID8gXCJvblwiIDogZS52YWx1ZTtcbiAgICB9KTtcbiAgfSksIGguZm9jdXNpbiA9IFwib25mb2N1c2luXCIgaW4gZTt2YXIgd3QgPSAvXig/OmZvY3VzaW5mb2N1c3xmb2N1c291dGJsdXIpJC8sXG4gICAgICBUdCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfTt3LmV4dGVuZCh3LmV2ZW50LCB7IHRyaWdnZXI6IGZ1bmN0aW9uICh0LCBuLCBpLCBvKSB7XG4gICAgICB2YXIgYSxcbiAgICAgICAgICBzLFxuICAgICAgICAgIHUsXG4gICAgICAgICAgbCxcbiAgICAgICAgICBjLFxuICAgICAgICAgIHAsXG4gICAgICAgICAgZCxcbiAgICAgICAgICBoLFxuICAgICAgICAgIHYgPSBbaSB8fCByXSxcbiAgICAgICAgICBtID0gZi5jYWxsKHQsIFwidHlwZVwiKSA/IHQudHlwZSA6IHQsXG4gICAgICAgICAgeCA9IGYuY2FsbCh0LCBcIm5hbWVzcGFjZVwiKSA/IHQubmFtZXNwYWNlLnNwbGl0KFwiLlwiKSA6IFtdO2lmIChzID0gaCA9IHUgPSBpID0gaSB8fCByLCAzICE9PSBpLm5vZGVUeXBlICYmIDggIT09IGkubm9kZVR5cGUgJiYgIXd0LnRlc3QobSArIHcuZXZlbnQudHJpZ2dlcmVkKSAmJiAobS5pbmRleE9mKFwiLlwiKSA+IC0xICYmIChtID0gKHggPSBtLnNwbGl0KFwiLlwiKSkuc2hpZnQoKSwgeC5zb3J0KCkpLCBjID0gbS5pbmRleE9mKFwiOlwiKSA8IDAgJiYgXCJvblwiICsgbSwgdCA9IHRbdy5leHBhbmRvXSA/IHQgOiBuZXcgdy5FdmVudChtLCBcIm9iamVjdFwiID09IHR5cGVvZiB0ICYmIHQpLCB0LmlzVHJpZ2dlciA9IG8gPyAyIDogMywgdC5uYW1lc3BhY2UgPSB4LmpvaW4oXCIuXCIpLCB0LnJuYW1lc3BhY2UgPSB0Lm5hbWVzcGFjZSA/IG5ldyBSZWdFeHAoXCIoXnxcXFxcLilcIiArIHguam9pbihcIlxcXFwuKD86LipcXFxcLnwpXCIpICsgXCIoXFxcXC58JClcIikgOiBudWxsLCB0LnJlc3VsdCA9IHZvaWQgMCwgdC50YXJnZXQgfHwgKHQudGFyZ2V0ID0gaSksIG4gPSBudWxsID09IG4gPyBbdF0gOiB3Lm1ha2VBcnJheShuLCBbdF0pLCBkID0gdy5ldmVudC5zcGVjaWFsW21dIHx8IHt9LCBvIHx8ICFkLnRyaWdnZXIgfHwgITEgIT09IGQudHJpZ2dlci5hcHBseShpLCBuKSkpIHtcbiAgICAgICAgaWYgKCFvICYmICFkLm5vQnViYmxlICYmICF5KGkpKSB7XG4gICAgICAgICAgZm9yIChsID0gZC5kZWxlZ2F0ZVR5cGUgfHwgbSwgd3QudGVzdChsICsgbSkgfHwgKHMgPSBzLnBhcmVudE5vZGUpOyBzOyBzID0gcy5wYXJlbnROb2RlKSB2LnB1c2gocyksIHUgPSBzO3UgPT09IChpLm93bmVyRG9jdW1lbnQgfHwgcikgJiYgdi5wdXNoKHUuZGVmYXVsdFZpZXcgfHwgdS5wYXJlbnRXaW5kb3cgfHwgZSk7XG4gICAgICAgIH1hID0gMDt3aGlsZSAoKHMgPSB2W2ErK10pICYmICF0LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpIGggPSBzLCB0LnR5cGUgPSBhID4gMSA/IGwgOiBkLmJpbmRUeXBlIHx8IG0sIChwID0gKEouZ2V0KHMsIFwiZXZlbnRzXCIpIHx8IHt9KVt0LnR5cGVdICYmIEouZ2V0KHMsIFwiaGFuZGxlXCIpKSAmJiBwLmFwcGx5KHMsIG4pLCAocCA9IGMgJiYgc1tjXSkgJiYgcC5hcHBseSAmJiBZKHMpICYmICh0LnJlc3VsdCA9IHAuYXBwbHkocywgbiksICExID09PSB0LnJlc3VsdCAmJiB0LnByZXZlbnREZWZhdWx0KCkpO3JldHVybiB0LnR5cGUgPSBtLCBvIHx8IHQuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgZC5fZGVmYXVsdCAmJiAhMSAhPT0gZC5fZGVmYXVsdC5hcHBseSh2LnBvcCgpLCBuKSB8fCAhWShpKSB8fCBjICYmIGcoaVttXSkgJiYgIXkoaSkgJiYgKCh1ID0gaVtjXSkgJiYgKGlbY10gPSBudWxsKSwgdy5ldmVudC50cmlnZ2VyZWQgPSBtLCB0LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgJiYgaC5hZGRFdmVudExpc3RlbmVyKG0sIFR0KSwgaVttXSgpLCB0LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgJiYgaC5yZW1vdmVFdmVudExpc3RlbmVyKG0sIFR0KSwgdy5ldmVudC50cmlnZ2VyZWQgPSB2b2lkIDAsIHUgJiYgKGlbY10gPSB1KSksIHQucmVzdWx0O1xuICAgICAgfVxuICAgIH0sIHNpbXVsYXRlOiBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgdmFyIHIgPSB3LmV4dGVuZChuZXcgdy5FdmVudCgpLCBuLCB7IHR5cGU6IGUsIGlzU2ltdWxhdGVkOiAhMCB9KTt3LmV2ZW50LnRyaWdnZXIociwgbnVsbCwgdCk7XG4gICAgfSB9KSwgdy5mbi5leHRlbmQoeyB0cmlnZ2VyOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHcuZXZlbnQudHJpZ2dlcihlLCB0LCB0aGlzKTtcbiAgICAgIH0pO1xuICAgIH0sIHRyaWdnZXJIYW5kbGVyOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgdmFyIG4gPSB0aGlzWzBdO2lmIChuKSByZXR1cm4gdy5ldmVudC50cmlnZ2VyKGUsIHQsIG4sICEwKTtcbiAgICB9IH0pLCBoLmZvY3VzaW4gfHwgdy5lYWNoKHsgZm9jdXM6IFwiZm9jdXNpblwiLCBibHVyOiBcImZvY3Vzb3V0XCIgfSwgZnVuY3Rpb24gKGUsIHQpIHtcbiAgICB2YXIgbiA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB3LmV2ZW50LnNpbXVsYXRlKHQsIGUudGFyZ2V0LCB3LmV2ZW50LmZpeChlKSk7XG4gICAgfTt3LmV2ZW50LnNwZWNpYWxbdF0gPSB7IHNldHVwOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByID0gdGhpcy5vd25lckRvY3VtZW50IHx8IHRoaXMsXG4gICAgICAgICAgICBpID0gSi5hY2Nlc3MociwgdCk7aSB8fCByLmFkZEV2ZW50TGlzdGVuZXIoZSwgbiwgITApLCBKLmFjY2VzcyhyLCB0LCAoaSB8fCAwKSArIDEpO1xuICAgICAgfSwgdGVhcmRvd246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHIgPSB0aGlzLm93bmVyRG9jdW1lbnQgfHwgdGhpcyxcbiAgICAgICAgICAgIGkgPSBKLmFjY2VzcyhyLCB0KSAtIDE7aSA/IEouYWNjZXNzKHIsIHQsIGkpIDogKHIucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLCBuLCAhMCksIEoucmVtb3ZlKHIsIHQpKTtcbiAgICAgIH0gfTtcbiAgfSk7dmFyIEN0ID0gZS5sb2NhdGlvbixcbiAgICAgIEV0ID0gRGF0ZS5ub3coKSxcbiAgICAgIGt0ID0gL1xcPy87dy5wYXJzZVhNTCA9IGZ1bmN0aW9uICh0KSB7XG4gICAgdmFyIG47aWYgKCF0IHx8IFwic3RyaW5nXCIgIT0gdHlwZW9mIHQpIHJldHVybiBudWxsO3RyeSB7XG4gICAgICBuID0gbmV3IGUuRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKHQsIFwidGV4dC94bWxcIik7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbiA9IHZvaWQgMDtcbiAgICB9cmV0dXJuIG4gJiYgIW4uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJwYXJzZXJlcnJvclwiKS5sZW5ndGggfHwgdy5lcnJvcihcIkludmFsaWQgWE1MOiBcIiArIHQpLCBuO1xuICB9O3ZhciBTdCA9IC9cXFtcXF0kLyxcbiAgICAgIER0ID0gL1xccj9cXG4vZyxcbiAgICAgIE50ID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLFxuICAgICAgQXQgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxrZXlnZW4pL2k7ZnVuY3Rpb24ganQoZSwgdCwgbiwgcikge1xuICAgIHZhciBpO2lmIChBcnJheS5pc0FycmF5KHQpKSB3LmVhY2godCwgZnVuY3Rpb24gKHQsIGkpIHtcbiAgICAgIG4gfHwgU3QudGVzdChlKSA/IHIoZSwgaSkgOiBqdChlICsgXCJbXCIgKyAoXCJvYmplY3RcIiA9PSB0eXBlb2YgaSAmJiBudWxsICE9IGkgPyB0IDogXCJcIikgKyBcIl1cIiwgaSwgbiwgcik7XG4gICAgfSk7ZWxzZSBpZiAobiB8fCBcIm9iamVjdFwiICE9PSB4KHQpKSByKGUsIHQpO2Vsc2UgZm9yIChpIGluIHQpIGp0KGUgKyBcIltcIiArIGkgKyBcIl1cIiwgdFtpXSwgbiwgcik7XG4gIH13LnBhcmFtID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICB2YXIgbixcbiAgICAgICAgciA9IFtdLFxuICAgICAgICBpID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIHZhciBuID0gZyh0KSA/IHQoKSA6IHQ7cltyLmxlbmd0aF0gPSBlbmNvZGVVUklDb21wb25lbnQoZSkgKyBcIj1cIiArIGVuY29kZVVSSUNvbXBvbmVudChudWxsID09IG4gPyBcIlwiIDogbik7XG4gICAgfTtpZiAoQXJyYXkuaXNBcnJheShlKSB8fCBlLmpxdWVyeSAmJiAhdy5pc1BsYWluT2JqZWN0KGUpKSB3LmVhY2goZSwgZnVuY3Rpb24gKCkge1xuICAgICAgaSh0aGlzLm5hbWUsIHRoaXMudmFsdWUpO1xuICAgIH0pO2Vsc2UgZm9yIChuIGluIGUpIGp0KG4sIGVbbl0sIHQsIGkpO3JldHVybiByLmpvaW4oXCImXCIpO1xuICB9LCB3LmZuLmV4dGVuZCh7IHNlcmlhbGl6ZTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHcucGFyYW0odGhpcy5zZXJpYWxpemVBcnJheSgpKTtcbiAgICB9LCBzZXJpYWxpemVBcnJheTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGUgPSB3LnByb3AodGhpcywgXCJlbGVtZW50c1wiKTtyZXR1cm4gZSA/IHcubWFrZUFycmF5KGUpIDogdGhpcztcbiAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlID0gdGhpcy50eXBlO3JldHVybiB0aGlzLm5hbWUgJiYgIXcodGhpcykuaXMoXCI6ZGlzYWJsZWRcIikgJiYgQXQudGVzdCh0aGlzLm5vZGVOYW1lKSAmJiAhTnQudGVzdChlKSAmJiAodGhpcy5jaGVja2VkIHx8ICFwZS50ZXN0KGUpKTtcbiAgICAgIH0pLm1hcChmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICB2YXIgbiA9IHcodGhpcykudmFsKCk7cmV0dXJuIG51bGwgPT0gbiA/IG51bGwgOiBBcnJheS5pc0FycmF5KG4pID8gdy5tYXAobiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICByZXR1cm4geyBuYW1lOiB0Lm5hbWUsIHZhbHVlOiBlLnJlcGxhY2UoRHQsIFwiXFxyXFxuXCIpIH07XG4gICAgICAgIH0pIDogeyBuYW1lOiB0Lm5hbWUsIHZhbHVlOiBuLnJlcGxhY2UoRHQsIFwiXFxyXFxuXCIpIH07XG4gICAgICB9KS5nZXQoKTtcbiAgICB9IH0pO3ZhciBxdCA9IC8lMjAvZyxcbiAgICAgIEx0ID0gLyMuKiQvLFxuICAgICAgSHQgPSAvKFs/Jl0pXz1bXiZdKi8sXG4gICAgICBPdCA9IC9eKC4qPyk6WyBcXHRdKihbXlxcclxcbl0qKSQvZ20sXG4gICAgICBQdCA9IC9eKD86YWJvdXR8YXBwfGFwcC1zdG9yYWdlfC4rLWV4dGVuc2lvbnxmaWxlfHJlc3x3aWRnZXQpOiQvLFxuICAgICAgTXQgPSAvXig/OkdFVHxIRUFEKSQvLFxuICAgICAgUnQgPSAvXlxcL1xcLy8sXG4gICAgICBJdCA9IHt9LFxuICAgICAgV3QgPSB7fSxcbiAgICAgICR0ID0gXCIqL1wiLmNvbmNhdChcIipcIiksXG4gICAgICBCdCA9IHIuY3JlYXRlRWxlbWVudChcImFcIik7QnQuaHJlZiA9IEN0LmhyZWY7ZnVuY3Rpb24gRnQoZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodCwgbikge1xuICAgICAgXCJzdHJpbmdcIiAhPSB0eXBlb2YgdCAmJiAobiA9IHQsIHQgPSBcIipcIik7dmFyIHIsXG4gICAgICAgICAgaSA9IDAsXG4gICAgICAgICAgbyA9IHQudG9Mb3dlckNhc2UoKS5tYXRjaChNKSB8fCBbXTtpZiAoZyhuKSkgd2hpbGUgKHIgPSBvW2krK10pIFwiK1wiID09PSByWzBdID8gKHIgPSByLnNsaWNlKDEpIHx8IFwiKlwiLCAoZVtyXSA9IGVbcl0gfHwgW10pLnVuc2hpZnQobikpIDogKGVbcl0gPSBlW3JdIHx8IFtdKS5wdXNoKG4pO1xuICAgIH07XG4gIH1mdW5jdGlvbiBfdChlLCB0LCBuLCByKSB7XG4gICAgdmFyIGkgPSB7fSxcbiAgICAgICAgbyA9IGUgPT09IFd0O2Z1bmN0aW9uIGEocykge1xuICAgICAgdmFyIHU7cmV0dXJuIGlbc10gPSAhMCwgdy5lYWNoKGVbc10gfHwgW10sIGZ1bmN0aW9uIChlLCBzKSB7XG4gICAgICAgIHZhciBsID0gcyh0LCBuLCByKTtyZXR1cm4gXCJzdHJpbmdcIiAhPSB0eXBlb2YgbCB8fCBvIHx8IGlbbF0gPyBvID8gISh1ID0gbCkgOiB2b2lkIDAgOiAodC5kYXRhVHlwZXMudW5zaGlmdChsKSwgYShsKSwgITEpO1xuICAgICAgfSksIHU7XG4gICAgfXJldHVybiBhKHQuZGF0YVR5cGVzWzBdKSB8fCAhaVtcIipcIl0gJiYgYShcIipcIik7XG4gIH1mdW5jdGlvbiB6dChlLCB0KSB7XG4gICAgdmFyIG4sXG4gICAgICAgIHIsXG4gICAgICAgIGkgPSB3LmFqYXhTZXR0aW5ncy5mbGF0T3B0aW9ucyB8fCB7fTtmb3IgKG4gaW4gdCkgdm9pZCAwICE9PSB0W25dICYmICgoaVtuXSA/IGUgOiByIHx8IChyID0ge30pKVtuXSA9IHRbbl0pO3JldHVybiByICYmIHcuZXh0ZW5kKCEwLCBlLCByKSwgZTtcbiAgfWZ1bmN0aW9uIFh0KGUsIHQsIG4pIHtcbiAgICB2YXIgcixcbiAgICAgICAgaSxcbiAgICAgICAgbyxcbiAgICAgICAgYSxcbiAgICAgICAgcyA9IGUuY29udGVudHMsXG4gICAgICAgIHUgPSBlLmRhdGFUeXBlczt3aGlsZSAoXCIqXCIgPT09IHVbMF0pIHUuc2hpZnQoKSwgdm9pZCAwID09PSByICYmIChyID0gZS5taW1lVHlwZSB8fCB0LmdldFJlc3BvbnNlSGVhZGVyKFwiQ29udGVudC1UeXBlXCIpKTtpZiAocikgZm9yIChpIGluIHMpIGlmIChzW2ldICYmIHNbaV0udGVzdChyKSkge1xuICAgICAgdS51bnNoaWZ0KGkpO2JyZWFrO1xuICAgIH1pZiAodVswXSBpbiBuKSBvID0gdVswXTtlbHNlIHtcbiAgICAgIGZvciAoaSBpbiBuKSB7XG4gICAgICAgIGlmICghdVswXSB8fCBlLmNvbnZlcnRlcnNbaSArIFwiIFwiICsgdVswXV0pIHtcbiAgICAgICAgICBvID0gaTticmVhaztcbiAgICAgICAgfWEgfHwgKGEgPSBpKTtcbiAgICAgIH1vID0gbyB8fCBhO1xuICAgIH1pZiAobykgcmV0dXJuIG8gIT09IHVbMF0gJiYgdS51bnNoaWZ0KG8pLCBuW29dO1xuICB9ZnVuY3Rpb24gVXQoZSwgdCwgbiwgcikge1xuICAgIHZhciBpLFxuICAgICAgICBvLFxuICAgICAgICBhLFxuICAgICAgICBzLFxuICAgICAgICB1LFxuICAgICAgICBsID0ge30sXG4gICAgICAgIGMgPSBlLmRhdGFUeXBlcy5zbGljZSgpO2lmIChjWzFdKSBmb3IgKGEgaW4gZS5jb252ZXJ0ZXJzKSBsW2EudG9Mb3dlckNhc2UoKV0gPSBlLmNvbnZlcnRlcnNbYV07byA9IGMuc2hpZnQoKTt3aGlsZSAobykgaWYgKGUucmVzcG9uc2VGaWVsZHNbb10gJiYgKG5bZS5yZXNwb25zZUZpZWxkc1tvXV0gPSB0KSwgIXUgJiYgciAmJiBlLmRhdGFGaWx0ZXIgJiYgKHQgPSBlLmRhdGFGaWx0ZXIodCwgZS5kYXRhVHlwZSkpLCB1ID0gbywgbyA9IGMuc2hpZnQoKSkgaWYgKFwiKlwiID09PSBvKSBvID0gdTtlbHNlIGlmIChcIipcIiAhPT0gdSAmJiB1ICE9PSBvKSB7XG4gICAgICBpZiAoIShhID0gbFt1ICsgXCIgXCIgKyBvXSB8fCBsW1wiKiBcIiArIG9dKSkgZm9yIChpIGluIGwpIGlmICgocyA9IGkuc3BsaXQoXCIgXCIpKVsxXSA9PT0gbyAmJiAoYSA9IGxbdSArIFwiIFwiICsgc1swXV0gfHwgbFtcIiogXCIgKyBzWzBdXSkpIHtcbiAgICAgICAgITAgPT09IGEgPyBhID0gbFtpXSA6ICEwICE9PSBsW2ldICYmIChvID0gc1swXSwgYy51bnNoaWZ0KHNbMV0pKTticmVhaztcbiAgICAgIH1pZiAoITAgIT09IGEpIGlmIChhICYmIGVbXCJ0aHJvd3NcIl0pIHQgPSBhKHQpO2Vsc2UgdHJ5IHtcbiAgICAgICAgdCA9IGEodCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiB7IHN0YXRlOiBcInBhcnNlcmVycm9yXCIsIGVycm9yOiBhID8gZSA6IFwiTm8gY29udmVyc2lvbiBmcm9tIFwiICsgdSArIFwiIHRvIFwiICsgbyB9O1xuICAgICAgfVxuICAgIH1yZXR1cm4geyBzdGF0ZTogXCJzdWNjZXNzXCIsIGRhdGE6IHQgfTtcbiAgfXcuZXh0ZW5kKHsgYWN0aXZlOiAwLCBsYXN0TW9kaWZpZWQ6IHt9LCBldGFnOiB7fSwgYWpheFNldHRpbmdzOiB7IHVybDogQ3QuaHJlZiwgdHlwZTogXCJHRVRcIiwgaXNMb2NhbDogUHQudGVzdChDdC5wcm90b2NvbCksIGdsb2JhbDogITAsIHByb2Nlc3NEYXRhOiAhMCwgYXN5bmM6ICEwLCBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLThcIiwgYWNjZXB0czogeyBcIipcIjogJHQsIHRleHQ6IFwidGV4dC9wbGFpblwiLCBodG1sOiBcInRleHQvaHRtbFwiLCB4bWw6IFwiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbFwiLCBqc29uOiBcImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdFwiIH0sIGNvbnRlbnRzOiB7IHhtbDogL1xcYnhtbFxcYi8sIGh0bWw6IC9cXGJodG1sLywganNvbjogL1xcYmpzb25cXGIvIH0sIHJlc3BvbnNlRmllbGRzOiB7IHhtbDogXCJyZXNwb25zZVhNTFwiLCB0ZXh0OiBcInJlc3BvbnNlVGV4dFwiLCBqc29uOiBcInJlc3BvbnNlSlNPTlwiIH0sIGNvbnZlcnRlcnM6IHsgXCIqIHRleHRcIjogU3RyaW5nLCBcInRleHQgaHRtbFwiOiAhMCwgXCJ0ZXh0IGpzb25cIjogSlNPTi5wYXJzZSwgXCJ0ZXh0IHhtbFwiOiB3LnBhcnNlWE1MIH0sIGZsYXRPcHRpb25zOiB7IHVybDogITAsIGNvbnRleHQ6ICEwIH0gfSwgYWpheFNldHVwOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgcmV0dXJuIHQgPyB6dCh6dChlLCB3LmFqYXhTZXR0aW5ncyksIHQpIDogenQody5hamF4U2V0dGluZ3MsIGUpO1xuICAgIH0sIGFqYXhQcmVmaWx0ZXI6IEZ0KEl0KSwgYWpheFRyYW5zcG9ydDogRnQoV3QpLCBhamF4OiBmdW5jdGlvbiAodCwgbikge1xuICAgICAgXCJvYmplY3RcIiA9PSB0eXBlb2YgdCAmJiAobiA9IHQsIHQgPSB2b2lkIDApLCBuID0gbiB8fCB7fTt2YXIgaSxcbiAgICAgICAgICBvLFxuICAgICAgICAgIGEsXG4gICAgICAgICAgcyxcbiAgICAgICAgICB1LFxuICAgICAgICAgIGwsXG4gICAgICAgICAgYyxcbiAgICAgICAgICBmLFxuICAgICAgICAgIHAsXG4gICAgICAgICAgZCxcbiAgICAgICAgICBoID0gdy5hamF4U2V0dXAoe30sIG4pLFxuICAgICAgICAgIGcgPSBoLmNvbnRleHQgfHwgaCxcbiAgICAgICAgICB5ID0gaC5jb250ZXh0ICYmIChnLm5vZGVUeXBlIHx8IGcuanF1ZXJ5KSA/IHcoZykgOiB3LmV2ZW50LFxuICAgICAgICAgIHYgPSB3LkRlZmVycmVkKCksXG4gICAgICAgICAgbSA9IHcuQ2FsbGJhY2tzKFwib25jZSBtZW1vcnlcIiksXG4gICAgICAgICAgeCA9IGguc3RhdHVzQ29kZSB8fCB7fSxcbiAgICAgICAgICBiID0ge30sXG4gICAgICAgICAgVCA9IHt9LFxuICAgICAgICAgIEMgPSBcImNhbmNlbGVkXCIsXG4gICAgICAgICAgRSA9IHsgcmVhZHlTdGF0ZTogMCwgZ2V0UmVzcG9uc2VIZWFkZXI6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgdmFyIHQ7aWYgKGMpIHtcbiAgICAgICAgICAgIGlmICghcykge1xuICAgICAgICAgICAgICBzID0ge307d2hpbGUgKHQgPSBPdC5leGVjKGEpKSBzW3RbMV0udG9Mb3dlckNhc2UoKV0gPSB0WzJdO1xuICAgICAgICAgICAgfXQgPSBzW2UudG9Mb3dlckNhc2UoKV07XG4gICAgICAgICAgfXJldHVybiBudWxsID09IHQgPyBudWxsIDogdDtcbiAgICAgICAgfSwgZ2V0QWxsUmVzcG9uc2VIZWFkZXJzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGMgPyBhIDogbnVsbDtcbiAgICAgICAgfSwgc2V0UmVxdWVzdEhlYWRlcjogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbCA9PSBjICYmIChlID0gVFtlLnRvTG93ZXJDYXNlKCldID0gVFtlLnRvTG93ZXJDYXNlKCldIHx8IGUsIGJbZV0gPSB0KSwgdGhpcztcbiAgICAgICAgfSwgb3ZlcnJpZGVNaW1lVHlwZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbCA9PSBjICYmIChoLm1pbWVUeXBlID0gZSksIHRoaXM7XG4gICAgICAgIH0sIHN0YXR1c0NvZGU6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgdmFyIHQ7aWYgKGUpIGlmIChjKSBFLmFsd2F5cyhlW0Uuc3RhdHVzXSk7ZWxzZSBmb3IgKHQgaW4gZSkgeFt0XSA9IFt4W3RdLCBlW3RdXTtyZXR1cm4gdGhpcztcbiAgICAgICAgfSwgYWJvcnQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgdmFyIHQgPSBlIHx8IEM7cmV0dXJuIGkgJiYgaS5hYm9ydCh0KSwgaygwLCB0KSwgdGhpcztcbiAgICAgICAgfSB9O2lmICh2LnByb21pc2UoRSksIGgudXJsID0gKCh0IHx8IGgudXJsIHx8IEN0LmhyZWYpICsgXCJcIikucmVwbGFjZShSdCwgQ3QucHJvdG9jb2wgKyBcIi8vXCIpLCBoLnR5cGUgPSBuLm1ldGhvZCB8fCBuLnR5cGUgfHwgaC5tZXRob2QgfHwgaC50eXBlLCBoLmRhdGFUeXBlcyA9IChoLmRhdGFUeXBlIHx8IFwiKlwiKS50b0xvd2VyQ2FzZSgpLm1hdGNoKE0pIHx8IFtcIlwiXSwgbnVsbCA9PSBoLmNyb3NzRG9tYWluKSB7XG4gICAgICAgIGwgPSByLmNyZWF0ZUVsZW1lbnQoXCJhXCIpO3RyeSB7XG4gICAgICAgICAgbC5ocmVmID0gaC51cmwsIGwuaHJlZiA9IGwuaHJlZiwgaC5jcm9zc0RvbWFpbiA9IEJ0LnByb3RvY29sICsgXCIvL1wiICsgQnQuaG9zdCAhPSBsLnByb3RvY29sICsgXCIvL1wiICsgbC5ob3N0O1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgaC5jcm9zc0RvbWFpbiA9ICEwO1xuICAgICAgICB9XG4gICAgICB9aWYgKGguZGF0YSAmJiBoLnByb2Nlc3NEYXRhICYmIFwic3RyaW5nXCIgIT0gdHlwZW9mIGguZGF0YSAmJiAoaC5kYXRhID0gdy5wYXJhbShoLmRhdGEsIGgudHJhZGl0aW9uYWwpKSwgX3QoSXQsIGgsIG4sIEUpLCBjKSByZXR1cm4gRTsoZiA9IHcuZXZlbnQgJiYgaC5nbG9iYWwpICYmIDAgPT0gdy5hY3RpdmUrKyAmJiB3LmV2ZW50LnRyaWdnZXIoXCJhamF4U3RhcnRcIiksIGgudHlwZSA9IGgudHlwZS50b1VwcGVyQ2FzZSgpLCBoLmhhc0NvbnRlbnQgPSAhTXQudGVzdChoLnR5cGUpLCBvID0gaC51cmwucmVwbGFjZShMdCwgXCJcIiksIGguaGFzQ29udGVudCA/IGguZGF0YSAmJiBoLnByb2Nlc3NEYXRhICYmIDAgPT09IChoLmNvbnRlbnRUeXBlIHx8IFwiXCIpLmluZGV4T2YoXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIikgJiYgKGguZGF0YSA9IGguZGF0YS5yZXBsYWNlKHF0LCBcIitcIikpIDogKGQgPSBoLnVybC5zbGljZShvLmxlbmd0aCksIGguZGF0YSAmJiAoaC5wcm9jZXNzRGF0YSB8fCBcInN0cmluZ1wiID09IHR5cGVvZiBoLmRhdGEpICYmIChvICs9IChrdC50ZXN0KG8pID8gXCImXCIgOiBcIj9cIikgKyBoLmRhdGEsIGRlbGV0ZSBoLmRhdGEpLCAhMSA9PT0gaC5jYWNoZSAmJiAobyA9IG8ucmVwbGFjZShIdCwgXCIkMVwiKSwgZCA9IChrdC50ZXN0KG8pID8gXCImXCIgOiBcIj9cIikgKyBcIl89XCIgKyBFdCsrICsgZCksIGgudXJsID0gbyArIGQpLCBoLmlmTW9kaWZpZWQgJiYgKHcubGFzdE1vZGlmaWVkW29dICYmIEUuc2V0UmVxdWVzdEhlYWRlcihcIklmLU1vZGlmaWVkLVNpbmNlXCIsIHcubGFzdE1vZGlmaWVkW29dKSwgdy5ldGFnW29dICYmIEUuc2V0UmVxdWVzdEhlYWRlcihcIklmLU5vbmUtTWF0Y2hcIiwgdy5ldGFnW29dKSksIChoLmRhdGEgJiYgaC5oYXNDb250ZW50ICYmICExICE9PSBoLmNvbnRlbnRUeXBlIHx8IG4uY29udGVudFR5cGUpICYmIEUuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBoLmNvbnRlbnRUeXBlKSwgRS5zZXRSZXF1ZXN0SGVhZGVyKFwiQWNjZXB0XCIsIGguZGF0YVR5cGVzWzBdICYmIGguYWNjZXB0c1toLmRhdGFUeXBlc1swXV0gPyBoLmFjY2VwdHNbaC5kYXRhVHlwZXNbMF1dICsgKFwiKlwiICE9PSBoLmRhdGFUeXBlc1swXSA/IFwiLCBcIiArICR0ICsgXCI7IHE9MC4wMVwiIDogXCJcIikgOiBoLmFjY2VwdHNbXCIqXCJdKTtmb3IgKHAgaW4gaC5oZWFkZXJzKSBFLnNldFJlcXVlc3RIZWFkZXIocCwgaC5oZWFkZXJzW3BdKTtpZiAoaC5iZWZvcmVTZW5kICYmICghMSA9PT0gaC5iZWZvcmVTZW5kLmNhbGwoZywgRSwgaCkgfHwgYykpIHJldHVybiBFLmFib3J0KCk7aWYgKEMgPSBcImFib3J0XCIsIG0uYWRkKGguY29tcGxldGUpLCBFLmRvbmUoaC5zdWNjZXNzKSwgRS5mYWlsKGguZXJyb3IpLCBpID0gX3QoV3QsIGgsIG4sIEUpKSB7XG4gICAgICAgIGlmIChFLnJlYWR5U3RhdGUgPSAxLCBmICYmIHkudHJpZ2dlcihcImFqYXhTZW5kXCIsIFtFLCBoXSksIGMpIHJldHVybiBFO2guYXN5bmMgJiYgaC50aW1lb3V0ID4gMCAmJiAodSA9IGUuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgRS5hYm9ydChcInRpbWVvdXRcIik7XG4gICAgICAgIH0sIGgudGltZW91dCkpO3RyeSB7XG4gICAgICAgICAgYyA9ICExLCBpLnNlbmQoYiwgayk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBpZiAoYykgdGhyb3cgZTtrKC0xLCBlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGsoLTEsIFwiTm8gVHJhbnNwb3J0XCIpO2Z1bmN0aW9uIGsodCwgbiwgciwgcykge1xuICAgICAgICB2YXIgbCxcbiAgICAgICAgICAgIHAsXG4gICAgICAgICAgICBkLFxuICAgICAgICAgICAgYixcbiAgICAgICAgICAgIFQsXG4gICAgICAgICAgICBDID0gbjtjIHx8IChjID0gITAsIHUgJiYgZS5jbGVhclRpbWVvdXQodSksIGkgPSB2b2lkIDAsIGEgPSBzIHx8IFwiXCIsIEUucmVhZHlTdGF0ZSA9IHQgPiAwID8gNCA6IDAsIGwgPSB0ID49IDIwMCAmJiB0IDwgMzAwIHx8IDMwNCA9PT0gdCwgciAmJiAoYiA9IFh0KGgsIEUsIHIpKSwgYiA9IFV0KGgsIGIsIEUsIGwpLCBsID8gKGguaWZNb2RpZmllZCAmJiAoKFQgPSBFLmdldFJlc3BvbnNlSGVhZGVyKFwiTGFzdC1Nb2RpZmllZFwiKSkgJiYgKHcubGFzdE1vZGlmaWVkW29dID0gVCksIChUID0gRS5nZXRSZXNwb25zZUhlYWRlcihcImV0YWdcIikpICYmICh3LmV0YWdbb10gPSBUKSksIDIwNCA9PT0gdCB8fCBcIkhFQURcIiA9PT0gaC50eXBlID8gQyA9IFwibm9jb250ZW50XCIgOiAzMDQgPT09IHQgPyBDID0gXCJub3Rtb2RpZmllZFwiIDogKEMgPSBiLnN0YXRlLCBwID0gYi5kYXRhLCBsID0gIShkID0gYi5lcnJvcikpKSA6IChkID0gQywgIXQgJiYgQyB8fCAoQyA9IFwiZXJyb3JcIiwgdCA8IDAgJiYgKHQgPSAwKSkpLCBFLnN0YXR1cyA9IHQsIEUuc3RhdHVzVGV4dCA9IChuIHx8IEMpICsgXCJcIiwgbCA/IHYucmVzb2x2ZVdpdGgoZywgW3AsIEMsIEVdKSA6IHYucmVqZWN0V2l0aChnLCBbRSwgQywgZF0pLCBFLnN0YXR1c0NvZGUoeCksIHggPSB2b2lkIDAsIGYgJiYgeS50cmlnZ2VyKGwgPyBcImFqYXhTdWNjZXNzXCIgOiBcImFqYXhFcnJvclwiLCBbRSwgaCwgbCA/IHAgOiBkXSksIG0uZmlyZVdpdGgoZywgW0UsIENdKSwgZiAmJiAoeS50cmlnZ2VyKFwiYWpheENvbXBsZXRlXCIsIFtFLCBoXSksIC0tdy5hY3RpdmUgfHwgdy5ldmVudC50cmlnZ2VyKFwiYWpheFN0b3BcIikpKTtcbiAgICAgIH1yZXR1cm4gRTtcbiAgICB9LCBnZXRKU09OOiBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgcmV0dXJuIHcuZ2V0KGUsIHQsIG4sIFwianNvblwiKTtcbiAgICB9LCBnZXRTY3JpcHQ6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICByZXR1cm4gdy5nZXQoZSwgdm9pZCAwLCB0LCBcInNjcmlwdFwiKTtcbiAgICB9IH0pLCB3LmVhY2goW1wiZ2V0XCIsIFwicG9zdFwiXSwgZnVuY3Rpb24gKGUsIHQpIHtcbiAgICB3W3RdID0gZnVuY3Rpb24gKGUsIG4sIHIsIGkpIHtcbiAgICAgIHJldHVybiBnKG4pICYmIChpID0gaSB8fCByLCByID0gbiwgbiA9IHZvaWQgMCksIHcuYWpheCh3LmV4dGVuZCh7IHVybDogZSwgdHlwZTogdCwgZGF0YVR5cGU6IGksIGRhdGE6IG4sIHN1Y2Nlc3M6IHIgfSwgdy5pc1BsYWluT2JqZWN0KGUpICYmIGUpKTtcbiAgICB9O1xuICB9KSwgdy5fZXZhbFVybCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgcmV0dXJuIHcuYWpheCh7IHVybDogZSwgdHlwZTogXCJHRVRcIiwgZGF0YVR5cGU6IFwic2NyaXB0XCIsIGNhY2hlOiAhMCwgYXN5bmM6ICExLCBnbG9iYWw6ICExLCBcInRocm93c1wiOiAhMCB9KTtcbiAgfSwgdy5mbi5leHRlbmQoeyB3cmFwQWxsOiBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHQ7cmV0dXJuIHRoaXNbMF0gJiYgKGcoZSkgJiYgKGUgPSBlLmNhbGwodGhpc1swXSkpLCB0ID0gdyhlLCB0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKSwgdGhpc1swXS5wYXJlbnROb2RlICYmIHQuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLCB0Lm1hcChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlID0gdGhpczt3aGlsZSAoZS5maXJzdEVsZW1lbnRDaGlsZCkgZSA9IGUuZmlyc3RFbGVtZW50Q2hpbGQ7cmV0dXJuIGU7XG4gICAgICB9KS5hcHBlbmQodGhpcykpLCB0aGlzO1xuICAgIH0sIHdyYXBJbm5lcjogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBnKGUpID8gdGhpcy5lYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHcodGhpcykud3JhcElubmVyKGUuY2FsbCh0aGlzLCB0KSk7XG4gICAgICB9KSA6IHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ID0gdyh0aGlzKSxcbiAgICAgICAgICAgIG4gPSB0LmNvbnRlbnRzKCk7bi5sZW5ndGggPyBuLndyYXBBbGwoZSkgOiB0LmFwcGVuZChlKTtcbiAgICAgIH0pO1xuICAgIH0sIHdyYXA6IGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgdCA9IGcoZSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAobikge1xuICAgICAgICB3KHRoaXMpLndyYXBBbGwodCA/IGUuY2FsbCh0aGlzLCBuKSA6IGUpO1xuICAgICAgfSk7XG4gICAgfSwgdW53cmFwOiBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIHRoaXMucGFyZW50KGUpLm5vdChcImJvZHlcIikuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHcodGhpcykucmVwbGFjZVdpdGgodGhpcy5jaGlsZE5vZGVzKTtcbiAgICAgIH0pLCB0aGlzO1xuICAgIH0gfSksIHcuZXhwci5wc2V1ZG9zLmhpZGRlbiA9IGZ1bmN0aW9uIChlKSB7XG4gICAgcmV0dXJuICF3LmV4cHIucHNldWRvcy52aXNpYmxlKGUpO1xuICB9LCB3LmV4cHIucHNldWRvcy52aXNpYmxlID0gZnVuY3Rpb24gKGUpIHtcbiAgICByZXR1cm4gISEoZS5vZmZzZXRXaWR0aCB8fCBlLm9mZnNldEhlaWdodCB8fCBlLmdldENsaWVudFJlY3RzKCkubGVuZ3RoKTtcbiAgfSwgdy5hamF4U2V0dGluZ3MueGhyID0gZnVuY3Rpb24gKCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gbmV3IGUuWE1MSHR0cFJlcXVlc3QoKTtcbiAgICB9IGNhdGNoIChlKSB7fVxuICB9O3ZhciBWdCA9IHsgMDogMjAwLCAxMjIzOiAyMDQgfSxcbiAgICAgIEd0ID0gdy5hamF4U2V0dGluZ3MueGhyKCk7aC5jb3JzID0gISFHdCAmJiBcIndpdGhDcmVkZW50aWFsc1wiIGluIEd0LCBoLmFqYXggPSBHdCA9ICEhR3QsIHcuYWpheFRyYW5zcG9ydChmdW5jdGlvbiAodCkge1xuICAgIHZhciBuLCByO2lmIChoLmNvcnMgfHwgR3QgJiYgIXQuY3Jvc3NEb21haW4pIHJldHVybiB7IHNlbmQ6IGZ1bmN0aW9uIChpLCBvKSB7XG4gICAgICAgIHZhciBhLFxuICAgICAgICAgICAgcyA9IHQueGhyKCk7aWYgKHMub3Blbih0LnR5cGUsIHQudXJsLCB0LmFzeW5jLCB0LnVzZXJuYW1lLCB0LnBhc3N3b3JkKSwgdC54aHJGaWVsZHMpIGZvciAoYSBpbiB0LnhockZpZWxkcykgc1thXSA9IHQueGhyRmllbGRzW2FdO3QubWltZVR5cGUgJiYgcy5vdmVycmlkZU1pbWVUeXBlICYmIHMub3ZlcnJpZGVNaW1lVHlwZSh0Lm1pbWVUeXBlKSwgdC5jcm9zc0RvbWFpbiB8fCBpW1wiWC1SZXF1ZXN0ZWQtV2l0aFwiXSB8fCAoaVtcIlgtUmVxdWVzdGVkLVdpdGhcIl0gPSBcIlhNTEh0dHBSZXF1ZXN0XCIpO2ZvciAoYSBpbiBpKSBzLnNldFJlcXVlc3RIZWFkZXIoYSwgaVthXSk7biA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG4gJiYgKG4gPSByID0gcy5vbmxvYWQgPSBzLm9uZXJyb3IgPSBzLm9uYWJvcnQgPSBzLm9udGltZW91dCA9IHMub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbCwgXCJhYm9ydFwiID09PSBlID8gcy5hYm9ydCgpIDogXCJlcnJvclwiID09PSBlID8gXCJudW1iZXJcIiAhPSB0eXBlb2Ygcy5zdGF0dXMgPyBvKDAsIFwiZXJyb3JcIikgOiBvKHMuc3RhdHVzLCBzLnN0YXR1c1RleHQpIDogbyhWdFtzLnN0YXR1c10gfHwgcy5zdGF0dXMsIHMuc3RhdHVzVGV4dCwgXCJ0ZXh0XCIgIT09IChzLnJlc3BvbnNlVHlwZSB8fCBcInRleHRcIikgfHwgXCJzdHJpbmdcIiAhPSB0eXBlb2Ygcy5yZXNwb25zZVRleHQgPyB7IGJpbmFyeTogcy5yZXNwb25zZSB9IDogeyB0ZXh0OiBzLnJlc3BvbnNlVGV4dCB9LCBzLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSwgcy5vbmxvYWQgPSBuKCksIHIgPSBzLm9uZXJyb3IgPSBzLm9udGltZW91dCA9IG4oXCJlcnJvclwiKSwgdm9pZCAwICE9PSBzLm9uYWJvcnQgPyBzLm9uYWJvcnQgPSByIDogcy5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgNCA9PT0gcy5yZWFkeVN0YXRlICYmIGUuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBuICYmIHIoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSwgbiA9IG4oXCJhYm9ydFwiKTt0cnkge1xuICAgICAgICAgIHMuc2VuZCh0Lmhhc0NvbnRlbnQgJiYgdC5kYXRhIHx8IG51bGwpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgaWYgKG4pIHRocm93IGU7XG4gICAgICAgIH1cbiAgICAgIH0sIGFib3J0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIG4gJiYgbigpO1xuICAgICAgfSB9O1xuICB9KSwgdy5hamF4UHJlZmlsdGVyKGZ1bmN0aW9uIChlKSB7XG4gICAgZS5jcm9zc0RvbWFpbiAmJiAoZS5jb250ZW50cy5zY3JpcHQgPSAhMSk7XG4gIH0pLCB3LmFqYXhTZXR1cCh7IGFjY2VwdHM6IHsgc2NyaXB0OiBcInRleHQvamF2YXNjcmlwdCwgYXBwbGljYXRpb24vamF2YXNjcmlwdCwgYXBwbGljYXRpb24vZWNtYXNjcmlwdCwgYXBwbGljYXRpb24veC1lY21hc2NyaXB0XCIgfSwgY29udGVudHM6IHsgc2NyaXB0OiAvXFxiKD86amF2YXxlY21hKXNjcmlwdFxcYi8gfSwgY29udmVydGVyczogeyBcInRleHQgc2NyaXB0XCI6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiB3Lmdsb2JhbEV2YWwoZSksIGU7XG4gICAgICB9IH0gfSksIHcuYWpheFByZWZpbHRlcihcInNjcmlwdFwiLCBmdW5jdGlvbiAoZSkge1xuICAgIHZvaWQgMCA9PT0gZS5jYWNoZSAmJiAoZS5jYWNoZSA9ICExKSwgZS5jcm9zc0RvbWFpbiAmJiAoZS50eXBlID0gXCJHRVRcIik7XG4gIH0pLCB3LmFqYXhUcmFuc3BvcnQoXCJzY3JpcHRcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS5jcm9zc0RvbWFpbikge1xuICAgICAgdmFyIHQsIG47cmV0dXJuIHsgc2VuZDogZnVuY3Rpb24gKGksIG8pIHtcbiAgICAgICAgICB0ID0gdyhcIjxzY3JpcHQ+XCIpLnByb3AoeyBjaGFyc2V0OiBlLnNjcmlwdENoYXJzZXQsIHNyYzogZS51cmwgfSkub24oXCJsb2FkIGVycm9yXCIsIG4gPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdC5yZW1vdmUoKSwgbiA9IG51bGwsIGUgJiYgbyhcImVycm9yXCIgPT09IGUudHlwZSA/IDQwNCA6IDIwMCwgZS50eXBlKTtcbiAgICAgICAgICB9KSwgci5oZWFkLmFwcGVuZENoaWxkKHRbMF0pO1xuICAgICAgICB9LCBhYm9ydDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIG4gJiYgbigpO1xuICAgICAgICB9IH07XG4gICAgfVxuICB9KTt2YXIgWXQgPSBbXSxcbiAgICAgIFF0ID0gLyg9KVxcPyg/PSZ8JCl8XFw/XFw/Lzt3LmFqYXhTZXR1cCh7IGpzb25wOiBcImNhbGxiYWNrXCIsIGpzb25wQ2FsbGJhY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlID0gWXQucG9wKCkgfHwgdy5leHBhbmRvICsgXCJfXCIgKyBFdCsrO3JldHVybiB0aGlzW2VdID0gITAsIGU7XG4gICAgfSB9KSwgdy5hamF4UHJlZmlsdGVyKFwianNvbiBqc29ucFwiLCBmdW5jdGlvbiAodCwgbiwgcikge1xuICAgIHZhciBpLFxuICAgICAgICBvLFxuICAgICAgICBhLFxuICAgICAgICBzID0gITEgIT09IHQuanNvbnAgJiYgKFF0LnRlc3QodC51cmwpID8gXCJ1cmxcIiA6IFwic3RyaW5nXCIgPT0gdHlwZW9mIHQuZGF0YSAmJiAwID09PSAodC5jb250ZW50VHlwZSB8fCBcIlwiKS5pbmRleE9mKFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIpICYmIFF0LnRlc3QodC5kYXRhKSAmJiBcImRhdGFcIik7aWYgKHMgfHwgXCJqc29ucFwiID09PSB0LmRhdGFUeXBlc1swXSkgcmV0dXJuIGkgPSB0Lmpzb25wQ2FsbGJhY2sgPSBnKHQuanNvbnBDYWxsYmFjaykgPyB0Lmpzb25wQ2FsbGJhY2soKSA6IHQuanNvbnBDYWxsYmFjaywgcyA/IHRbc10gPSB0W3NdLnJlcGxhY2UoUXQsIFwiJDFcIiArIGkpIDogITEgIT09IHQuanNvbnAgJiYgKHQudXJsICs9IChrdC50ZXN0KHQudXJsKSA/IFwiJlwiIDogXCI/XCIpICsgdC5qc29ucCArIFwiPVwiICsgaSksIHQuY29udmVydGVyc1tcInNjcmlwdCBqc29uXCJdID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGEgfHwgdy5lcnJvcihpICsgXCIgd2FzIG5vdCBjYWxsZWRcIiksIGFbMF07XG4gICAgfSwgdC5kYXRhVHlwZXNbMF0gPSBcImpzb25cIiwgbyA9IGVbaV0sIGVbaV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICBhID0gYXJndW1lbnRzO1xuICAgIH0sIHIuYWx3YXlzKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZvaWQgMCA9PT0gbyA/IHcoZSkucmVtb3ZlUHJvcChpKSA6IGVbaV0gPSBvLCB0W2ldICYmICh0Lmpzb25wQ2FsbGJhY2sgPSBuLmpzb25wQ2FsbGJhY2ssIFl0LnB1c2goaSkpLCBhICYmIGcobykgJiYgbyhhWzBdKSwgYSA9IG8gPSB2b2lkIDA7XG4gICAgfSksIFwic2NyaXB0XCI7XG4gIH0pLCBoLmNyZWF0ZUhUTUxEb2N1bWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZSA9IHIuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KFwiXCIpLmJvZHk7cmV0dXJuIGUuaW5uZXJIVE1MID0gXCI8Zm9ybT48L2Zvcm0+PGZvcm0+PC9mb3JtPlwiLCAyID09PSBlLmNoaWxkTm9kZXMubGVuZ3RoO1xuICB9KCksIHcucGFyc2VIVE1MID0gZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICBpZiAoXCJzdHJpbmdcIiAhPSB0eXBlb2YgZSkgcmV0dXJuIFtdO1wiYm9vbGVhblwiID09IHR5cGVvZiB0ICYmIChuID0gdCwgdCA9ICExKTt2YXIgaSwgbywgYTtyZXR1cm4gdCB8fCAoaC5jcmVhdGVIVE1MRG9jdW1lbnQgPyAoKGkgPSAodCA9IHIuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KFwiXCIpKS5jcmVhdGVFbGVtZW50KFwiYmFzZVwiKSkuaHJlZiA9IHIubG9jYXRpb24uaHJlZiwgdC5oZWFkLmFwcGVuZENoaWxkKGkpKSA6IHQgPSByKSwgbyA9IEEuZXhlYyhlKSwgYSA9ICFuICYmIFtdLCBvID8gW3QuY3JlYXRlRWxlbWVudChvWzFdKV0gOiAobyA9IHhlKFtlXSwgdCwgYSksIGEgJiYgYS5sZW5ndGggJiYgdyhhKS5yZW1vdmUoKSwgdy5tZXJnZShbXSwgby5jaGlsZE5vZGVzKSk7XG4gIH0sIHcuZm4ubG9hZCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7XG4gICAgdmFyIHIsXG4gICAgICAgIGksXG4gICAgICAgIG8sXG4gICAgICAgIGEgPSB0aGlzLFxuICAgICAgICBzID0gZS5pbmRleE9mKFwiIFwiKTtyZXR1cm4gcyA+IC0xICYmIChyID0gdnQoZS5zbGljZShzKSksIGUgPSBlLnNsaWNlKDAsIHMpKSwgZyh0KSA/IChuID0gdCwgdCA9IHZvaWQgMCkgOiB0ICYmIFwib2JqZWN0XCIgPT0gdHlwZW9mIHQgJiYgKGkgPSBcIlBPU1RcIiksIGEubGVuZ3RoID4gMCAmJiB3LmFqYXgoeyB1cmw6IGUsIHR5cGU6IGkgfHwgXCJHRVRcIiwgZGF0YVR5cGU6IFwiaHRtbFwiLCBkYXRhOiB0IH0pLmRvbmUoZnVuY3Rpb24gKGUpIHtcbiAgICAgIG8gPSBhcmd1bWVudHMsIGEuaHRtbChyID8gdyhcIjxkaXY+XCIpLmFwcGVuZCh3LnBhcnNlSFRNTChlKSkuZmluZChyKSA6IGUpO1xuICAgIH0pLmFsd2F5cyhuICYmIGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICBhLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICBuLmFwcGx5KHRoaXMsIG8gfHwgW2UucmVzcG9uc2VUZXh0LCB0LCBlXSk7XG4gICAgICB9KTtcbiAgICB9KSwgdGhpcztcbiAgfSwgdy5lYWNoKFtcImFqYXhTdGFydFwiLCBcImFqYXhTdG9wXCIsIFwiYWpheENvbXBsZXRlXCIsIFwiYWpheEVycm9yXCIsIFwiYWpheFN1Y2Nlc3NcIiwgXCJhamF4U2VuZFwiXSwgZnVuY3Rpb24gKGUsIHQpIHtcbiAgICB3LmZuW3RdID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiB0aGlzLm9uKHQsIGUpO1xuICAgIH07XG4gIH0pLCB3LmV4cHIucHNldWRvcy5hbmltYXRlZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgcmV0dXJuIHcuZ3JlcCh3LnRpbWVycywgZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiBlID09PSB0LmVsZW07XG4gICAgfSkubGVuZ3RoO1xuICB9LCB3Lm9mZnNldCA9IHsgc2V0T2Zmc2V0OiBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgdmFyIHIsXG4gICAgICAgICAgaSxcbiAgICAgICAgICBvLFxuICAgICAgICAgIGEsXG4gICAgICAgICAgcyxcbiAgICAgICAgICB1LFxuICAgICAgICAgIGwsXG4gICAgICAgICAgYyA9IHcuY3NzKGUsIFwicG9zaXRpb25cIiksXG4gICAgICAgICAgZiA9IHcoZSksXG4gICAgICAgICAgcCA9IHt9O1wic3RhdGljXCIgPT09IGMgJiYgKGUuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCIpLCBzID0gZi5vZmZzZXQoKSwgbyA9IHcuY3NzKGUsIFwidG9wXCIpLCB1ID0gdy5jc3MoZSwgXCJsZWZ0XCIpLCAobCA9IChcImFic29sdXRlXCIgPT09IGMgfHwgXCJmaXhlZFwiID09PSBjKSAmJiAobyArIHUpLmluZGV4T2YoXCJhdXRvXCIpID4gLTEpID8gKGEgPSAociA9IGYucG9zaXRpb24oKSkudG9wLCBpID0gci5sZWZ0KSA6IChhID0gcGFyc2VGbG9hdChvKSB8fCAwLCBpID0gcGFyc2VGbG9hdCh1KSB8fCAwKSwgZyh0KSAmJiAodCA9IHQuY2FsbChlLCBuLCB3LmV4dGVuZCh7fSwgcykpKSwgbnVsbCAhPSB0LnRvcCAmJiAocC50b3AgPSB0LnRvcCAtIHMudG9wICsgYSksIG51bGwgIT0gdC5sZWZ0ICYmIChwLmxlZnQgPSB0LmxlZnQgLSBzLmxlZnQgKyBpKSwgXCJ1c2luZ1wiIGluIHQgPyB0LnVzaW5nLmNhbGwoZSwgcCkgOiBmLmNzcyhwKTtcbiAgICB9IH0sIHcuZm4uZXh0ZW5kKHsgb2Zmc2V0OiBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB2b2lkIDAgPT09IGUgPyB0aGlzIDogdGhpcy5lYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHcub2Zmc2V0LnNldE9mZnNldCh0aGlzLCBlLCB0KTtcbiAgICAgIH0pO3ZhciB0LFxuICAgICAgICAgIG4sXG4gICAgICAgICAgciA9IHRoaXNbMF07aWYgKHIpIHJldHVybiByLmdldENsaWVudFJlY3RzKCkubGVuZ3RoID8gKHQgPSByLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLCBuID0gci5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LCB7IHRvcDogdC50b3AgKyBuLnBhZ2VZT2Zmc2V0LCBsZWZ0OiB0LmxlZnQgKyBuLnBhZ2VYT2Zmc2V0IH0pIDogeyB0b3A6IDAsIGxlZnQ6IDAgfTtcbiAgICB9LCBwb3NpdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXNbMF0pIHtcbiAgICAgICAgdmFyIGUsXG4gICAgICAgICAgICB0LFxuICAgICAgICAgICAgbixcbiAgICAgICAgICAgIHIgPSB0aGlzWzBdLFxuICAgICAgICAgICAgaSA9IHsgdG9wOiAwLCBsZWZ0OiAwIH07aWYgKFwiZml4ZWRcIiA9PT0gdy5jc3MociwgXCJwb3NpdGlvblwiKSkgdCA9IHIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7ZWxzZSB7XG4gICAgICAgICAgdCA9IHRoaXMub2Zmc2V0KCksIG4gPSByLm93bmVyRG9jdW1lbnQsIGUgPSByLm9mZnNldFBhcmVudCB8fCBuLmRvY3VtZW50RWxlbWVudDt3aGlsZSAoZSAmJiAoZSA9PT0gbi5ib2R5IHx8IGUgPT09IG4uZG9jdW1lbnRFbGVtZW50KSAmJiBcInN0YXRpY1wiID09PSB3LmNzcyhlLCBcInBvc2l0aW9uXCIpKSBlID0gZS5wYXJlbnROb2RlO2UgJiYgZSAhPT0gciAmJiAxID09PSBlLm5vZGVUeXBlICYmICgoaSA9IHcoZSkub2Zmc2V0KCkpLnRvcCArPSB3LmNzcyhlLCBcImJvcmRlclRvcFdpZHRoXCIsICEwKSwgaS5sZWZ0ICs9IHcuY3NzKGUsIFwiYm9yZGVyTGVmdFdpZHRoXCIsICEwKSk7XG4gICAgICAgIH1yZXR1cm4geyB0b3A6IHQudG9wIC0gaS50b3AgLSB3LmNzcyhyLCBcIm1hcmdpblRvcFwiLCAhMCksIGxlZnQ6IHQubGVmdCAtIGkubGVmdCAtIHcuY3NzKHIsIFwibWFyZ2luTGVmdFwiLCAhMCkgfTtcbiAgICAgIH1cbiAgICB9LCBvZmZzZXRQYXJlbnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlID0gdGhpcy5vZmZzZXRQYXJlbnQ7d2hpbGUgKGUgJiYgXCJzdGF0aWNcIiA9PT0gdy5jc3MoZSwgXCJwb3NpdGlvblwiKSkgZSA9IGUub2Zmc2V0UGFyZW50O3JldHVybiBlIHx8IGJlO1xuICAgICAgfSk7XG4gICAgfSB9KSwgdy5lYWNoKHsgc2Nyb2xsTGVmdDogXCJwYWdlWE9mZnNldFwiLCBzY3JvbGxUb3A6IFwicGFnZVlPZmZzZXRcIiB9LCBmdW5jdGlvbiAoZSwgdCkge1xuICAgIHZhciBuID0gXCJwYWdlWU9mZnNldFwiID09PSB0O3cuZm5bZV0gPSBmdW5jdGlvbiAocikge1xuICAgICAgcmV0dXJuIHoodGhpcywgZnVuY3Rpb24gKGUsIHIsIGkpIHtcbiAgICAgICAgdmFyIG87aWYgKHkoZSkgPyBvID0gZSA6IDkgPT09IGUubm9kZVR5cGUgJiYgKG8gPSBlLmRlZmF1bHRWaWV3KSwgdm9pZCAwID09PSBpKSByZXR1cm4gbyA/IG9bdF0gOiBlW3JdO28gPyBvLnNjcm9sbFRvKG4gPyBvLnBhZ2VYT2Zmc2V0IDogaSwgbiA/IGkgOiBvLnBhZ2VZT2Zmc2V0KSA6IGVbcl0gPSBpO1xuICAgICAgfSwgZSwgciwgYXJndW1lbnRzLmxlbmd0aCk7XG4gICAgfTtcbiAgfSksIHcuZWFjaChbXCJ0b3BcIiwgXCJsZWZ0XCJdLCBmdW5jdGlvbiAoZSwgdCkge1xuICAgIHcuY3NzSG9va3NbdF0gPSBfZShoLnBpeGVsUG9zaXRpb24sIGZ1bmN0aW9uIChlLCBuKSB7XG4gICAgICBpZiAobikgcmV0dXJuIG4gPSBGZShlLCB0KSwgV2UudGVzdChuKSA/IHcoZSkucG9zaXRpb24oKVt0XSArIFwicHhcIiA6IG47XG4gICAgfSk7XG4gIH0pLCB3LmVhY2goeyBIZWlnaHQ6IFwiaGVpZ2h0XCIsIFdpZHRoOiBcIndpZHRoXCIgfSwgZnVuY3Rpb24gKGUsIHQpIHtcbiAgICB3LmVhY2goeyBwYWRkaW5nOiBcImlubmVyXCIgKyBlLCBjb250ZW50OiB0LCBcIlwiOiBcIm91dGVyXCIgKyBlIH0sIGZ1bmN0aW9uIChuLCByKSB7XG4gICAgICB3LmZuW3JdID0gZnVuY3Rpb24gKGksIG8pIHtcbiAgICAgICAgdmFyIGEgPSBhcmd1bWVudHMubGVuZ3RoICYmIChuIHx8IFwiYm9vbGVhblwiICE9IHR5cGVvZiBpKSxcbiAgICAgICAgICAgIHMgPSBuIHx8ICghMCA9PT0gaSB8fCAhMCA9PT0gbyA/IFwibWFyZ2luXCIgOiBcImJvcmRlclwiKTtyZXR1cm4geih0aGlzLCBmdW5jdGlvbiAodCwgbiwgaSkge1xuICAgICAgICAgIHZhciBvO3JldHVybiB5KHQpID8gMCA9PT0gci5pbmRleE9mKFwib3V0ZXJcIikgPyB0W1wiaW5uZXJcIiArIGVdIDogdC5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbXCJjbGllbnRcIiArIGVdIDogOSA9PT0gdC5ub2RlVHlwZSA/IChvID0gdC5kb2N1bWVudEVsZW1lbnQsIE1hdGgubWF4KHQuYm9keVtcInNjcm9sbFwiICsgZV0sIG9bXCJzY3JvbGxcIiArIGVdLCB0LmJvZHlbXCJvZmZzZXRcIiArIGVdLCBvW1wib2Zmc2V0XCIgKyBlXSwgb1tcImNsaWVudFwiICsgZV0pKSA6IHZvaWQgMCA9PT0gaSA/IHcuY3NzKHQsIG4sIHMpIDogdy5zdHlsZSh0LCBuLCBpLCBzKTtcbiAgICAgICAgfSwgdCwgYSA/IGkgOiB2b2lkIDAsIGEpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSksIHcuZWFjaChcImJsdXIgZm9jdXMgZm9jdXNpbiBmb2N1c291dCByZXNpemUgc2Nyb2xsIGNsaWNrIGRibGNsaWNrIG1vdXNlZG93biBtb3VzZXVwIG1vdXNlbW92ZSBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2VlbnRlciBtb3VzZWxlYXZlIGNoYW5nZSBzZWxlY3Qgc3VibWl0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgY29udGV4dG1lbnVcIi5zcGxpdChcIiBcIiksIGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgdy5mblt0XSA9IGZ1bmN0aW9uIChlLCBuKSB7XG4gICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDAgPyB0aGlzLm9uKHQsIG51bGwsIGUsIG4pIDogdGhpcy50cmlnZ2VyKHQpO1xuICAgIH07XG4gIH0pLCB3LmZuLmV4dGVuZCh7IGhvdmVyOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgcmV0dXJuIHRoaXMubW91c2VlbnRlcihlKS5tb3VzZWxlYXZlKHQgfHwgZSk7XG4gICAgfSB9KSwgdy5mbi5leHRlbmQoeyBiaW5kOiBmdW5jdGlvbiAoZSwgdCwgbikge1xuICAgICAgcmV0dXJuIHRoaXMub24oZSwgbnVsbCwgdCwgbik7XG4gICAgfSwgdW5iaW5kOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgcmV0dXJuIHRoaXMub2ZmKGUsIG51bGwsIHQpO1xuICAgIH0sIGRlbGVnYXRlOiBmdW5jdGlvbiAoZSwgdCwgbiwgcikge1xuICAgICAgcmV0dXJuIHRoaXMub24odCwgZSwgbiwgcik7XG4gICAgfSwgdW5kZWxlZ2F0ZTogZnVuY3Rpb24gKGUsIHQsIG4pIHtcbiAgICAgIHJldHVybiAxID09PSBhcmd1bWVudHMubGVuZ3RoID8gdGhpcy5vZmYoZSwgXCIqKlwiKSA6IHRoaXMub2ZmKHQsIGUgfHwgXCIqKlwiLCBuKTtcbiAgICB9IH0pLCB3LnByb3h5ID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICB2YXIgbiwgciwgaTtpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgdCAmJiAobiA9IGVbdF0sIHQgPSBlLCBlID0gbiksIGcoZSkpIHJldHVybiByID0gby5jYWxsKGFyZ3VtZW50cywgMiksIGkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZS5hcHBseSh0IHx8IHRoaXMsIHIuY29uY2F0KG8uY2FsbChhcmd1bWVudHMpKSk7XG4gICAgfSwgaS5ndWlkID0gZS5ndWlkID0gZS5ndWlkIHx8IHcuZ3VpZCsrLCBpO1xuICB9LCB3LmhvbGRSZWFkeSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgZSA/IHcucmVhZHlXYWl0KysgOiB3LnJlYWR5KCEwKTtcbiAgfSwgdy5pc0FycmF5ID0gQXJyYXkuaXNBcnJheSwgdy5wYXJzZUpTT04gPSBKU09OLnBhcnNlLCB3Lm5vZGVOYW1lID0gTiwgdy5pc0Z1bmN0aW9uID0gZywgdy5pc1dpbmRvdyA9IHksIHcuY2FtZWxDYXNlID0gRywgdy50eXBlID0geCwgdy5ub3cgPSBEYXRlLm5vdywgdy5pc051bWVyaWMgPSBmdW5jdGlvbiAoZSkge1xuICAgIHZhciB0ID0gdy50eXBlKGUpO3JldHVybiAoXCJudW1iZXJcIiA9PT0gdCB8fCBcInN0cmluZ1wiID09PSB0KSAmJiAhaXNOYU4oZSAtIHBhcnNlRmxvYXQoZSkpO1xuICB9LCBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kICYmIGRlZmluZShcImpxdWVyeVwiLCBbXSwgZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB3O1xuICB9KTt2YXIgSnQgPSBlLmpRdWVyeSxcbiAgICAgIEt0ID0gZS4kO3JldHVybiB3Lm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAodCkge1xuICAgIHJldHVybiBlLiQgPT09IHcgJiYgKGUuJCA9IEt0KSwgdCAmJiBlLmpRdWVyeSA9PT0gdyAmJiAoZS5qUXVlcnkgPSBKdCksIHc7XG4gIH0sIHQgfHwgKGUualF1ZXJ5ID0gZS4kID0gdyksIHc7XG59KTsiLCIvKmpzaGludCBlc3ZlcnNpb246IDYgKi9cblxubGV0IHJlc3RhdXJhbnRzLCBuZWlnaGJvcmhvb2RzLCBjdWlzaW5lcztcbnZhciBtYXA7XG52YXIgbWFya2VycyA9IFtdO1xuXG4vKipcclxuICogSW5pdGlhbGl6ZSB0aGUgZGF0YWJhc2UsIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBldmVudCA9PiB7XG4gIERCSGVscGVyLmdldERCKCk7XG4gIGZldGNoTmVpZ2hib3Job29kcygpO1xuICBmZXRjaEN1aXNpbmVzKCk7XG59KTtcblxuLyoqXHJcbiAqIFJlZ2lzdGVyIFNlcnZpY2UgV29ya2VyIGFuZCBtYW5pcHVsYXRlIHRoZSBjb250ZW50IG9uIGxvYWRcclxuICovXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGV2ZW50ID0+IHtcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XG4gIGNlbnRyZURldGFpbHNCdXR0b24oKTtcblxuICAvKiBhZGQgdGhlIHRpdGxlIHRvIHRoZSBpZnJhbWUgb2YgR29vZ2xlIE1hcHMqL1xuICAkZ01hcHNJZnJhbWUgPSAkKCcjbWFwLWNvbnRhaW5lcicpLmZpbmQoJ2lmcmFtZScpO1xuXG4gIGlmICgkZ01hcHNJZnJhbWUpIHtcbiAgICAkZ01hcHNJZnJhbWUuYXR0cigndGl0bGUnLCAnR29vZ2xlIE1hcHMgaWZyYW1lJyk7XG4gIH1cbn0pO1xuXG4vKipcclxuICogUmVnaXN0ZXIgYSBzZXJ2aWNlIHdvcmtlciBcclxuICovXG5cbnJlZ2lzdGVyU2VydmljZVdvcmtlciA9ICgpID0+IHtcbiAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikgcmV0dXJuO1xuXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICBjb25zb2xlLmxvZyhcIlNlcnZpY2UgV29ya2VyIHJlZ2lzdGVyZWQhXCIpO1xuICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgY29uc29sZS5sb2coXCJSZWdpc3RyYXRpb24gb2YgdGhlIFNlcnZpY2UgV29ya2VyIGZhaWxlZFwiKTtcbiAgfSk7XG59O1xuXG4vKipcclxuICogVGhpcyBmdW5jdGlvbiBpcyBjZW50ZXJpbmcgdGhlICdWaWV3IERldGFpbHMnIGJ1dHRvblxyXG4gKi9cblxuY2VudHJlRGV0YWlsc0J1dHRvbiA9ICgpID0+IHtcbiAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG4gIGNvbnN0IGJ1dHRvbnMgPSBsaXN0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJyk7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBidXR0b25zLmxlbmd0aDsgaSsrKSB7XG4gICAgYnV0dG9uc1tpXS5zdHlsZS5sZWZ0ID0gJ2NhbGMoNTAlIC0gJyArIGJ1dHRvbnNbaV0uY2xpZW50V2lkdGggKyAncHggLyAyKSc7IC8vIGNhbGN1bGF0aW5nIHRoZSBsZWZ0IGNvb3JkaW5hdGUsIHdoZXJlIHRoZSBidXR0b24gc2hvdWxkIGxvY2F0ZSBpdHNlbGZcbiAgfVxufTtcblxuLyoqXHJcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXG5mZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHMpID0+IHtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIC8vIEdvdCBhbiBlcnJvclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xuZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnb3B0aW9uJyk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn07XG5cbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cbmZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoKGVycm9yLCBjdWlzaW5lcykgPT4ge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXHJcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxyXG4gKi9cbmZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcblxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn07XG5cbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG4gIGxldCBsb2MgPSB7XG4gICAgbGF0OiA0MC43MjIyMTYsXG4gICAgbG5nOiAtNzMuOTg3NTAxXG4gIH07XG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICB6b29tOiAxMixcbiAgICBjZW50ZXI6IGxvYyxcbiAgICBzY3JvbGx3aGVlbDogZmFsc2UsXG4gICAgbWFwVHlwZUlkOiAnaHlicmlkJ1xuICB9KTtcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcbn07XG5cbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cbnVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG5cbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xuXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXG5yZXNldFJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHMgPT4ge1xuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICB1bC5pbm5lckhUTUwgPSAnJztcblxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xuICBzZWxmLm1hcmtlcnMgPSBbXTtcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xufTtcblxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xuZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSk7XG4gIH0pO1xuICBhZGRNYXJrZXJzVG9NYXAoKTtcbn07XG5cbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cbmNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gcmVzdGF1cmFudCA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgY29uc3QgZmlndXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmlndXJlJyk7XG4gIGNvbnN0IGZpZ0NhcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWdjYXB0aW9uJyk7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgZmlndXJlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIGltYWdlLmFsdCA9ICdSZXN0YXVyYW50OiAnICsgcmVzdGF1cmFudC5uYW1lO1xuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIGltYWdlLnNyY3NldCA9IERCSGVscGVyLmltYWdlU3JjU2V0QXR0ckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIGZpZ3VyZS5hcHBlbmQoaW1hZ2UpO1xuICBmaWd1cmUuYXBwZW5kKGZpZ0NhcHRpb24pO1xuXG4gIGxpLmFwcGVuZChmaWd1cmUpO1xuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgZmlnQ2FwdGlvbi5hcHBlbmQobmFtZSk7XG5cbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XG4gIGZpZ0NhcHRpb24uYXBwZW5kKG5laWdoYm9yaG9vZCk7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG4gIGZpZ0NhcHRpb24uYXBwZW5kKGFkZHJlc3MpO1xuXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gIG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgRGV0YWlscyc7XG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIGZpZ0NhcHRpb24uYXBwZW5kKG1vcmUpO1xuXG4gIHJldHVybiBsaTtcbn07XG5cbi8qKlxyXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxyXG4gKi9cbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybDtcbiAgICB9KTtcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xuICB9KTtcbn07Il19
